machine:
    services:
        - docker
    python:
        version: 2.7.6
    environment:
        PYEJABBERD_TESTS_HOST: 127.0.0.1
        PYEJABBERD_TESTS_PORT: 4560
        PYEJABBERD_TESTS_USERNAME: admin
        PYEJABBERD_TESTS_PASSWORD: admin
        PYEJABBERD_TESTS_XMPP_DOMAIN: example.com
        PYEJABBERD_TESTS_MUC_SERVICE: conference
        PYEJABBERD_TESTS_PROTOCOL: http
        PYEJABBERD_TESTS_VERBOSE: 0
dependencies:
    cache_directories:
        - "~/docker"
    override:
        - pip install tox
        - docker info
        - if [[ -e ~/docker/image.tar ]]; then docker load --input ~/docker/image.tar; fi
        - docker pull dirkmoors/ejabberd
        - mkdir -p ~/docker; docker save dirkmoors/ejabberd > ~/docker/image.tar
test:
    override:
        - ./ejabberd.sh; sleep 10
        - tox
