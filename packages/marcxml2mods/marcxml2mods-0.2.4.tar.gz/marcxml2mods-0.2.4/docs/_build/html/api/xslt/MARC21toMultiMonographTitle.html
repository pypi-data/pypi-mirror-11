<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MARC21toMultiMonographTitle.xsl &mdash; marcxml2mods 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="marcxml2mods 0.2.0 documentation" href="../../index.html" />
    <link rel="next" title="MARC21toPeriodicalTitle.xsl" href="MARC21toPeriodicalTitle.html" />
    <link rel="prev" title="MARC21slim2MODS3-4-NDK.xsl" href="MARC21slim2MODS3-4-NDK.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="MARC21toPeriodicalTitle.html" title="MARC21toPeriodicalTitle.xsl"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="MARC21slim2MODS3-4-NDK.html" title="MARC21slim2MODS3-4-NDK.xsl"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">marcxml2mods 0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="marc21tomultimonographtitle-xsl">
<h1>MARC21toMultiMonographTitle.xsl<a class="headerlink" href="#marc21tomultimonographtitle-xsl" title="Permalink to this headline">¶</a></h1>
<p>This file is used to transform <strong>multi monographic</strong> publications.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;xsl:stylesheet xmlns:mods=&quot;http://www.loc.gov/mods/v3&quot; xmlns:marc=&quot;http://www.loc.gov/MARC21/slim&quot;
	xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
	exclude-result-prefixes=&quot;xlink marc&quot; version=&quot;1.0&quot;&gt;
	&lt;xsl:output encoding=&quot;UTF-8&quot; indent=&quot;yes&quot; method=&quot;xml&quot;/&gt;
	&lt;xsl:strip-space elements=&quot;*&quot;/&gt;
	&lt;xsl:namespace-alias stylesheet-prefix=&quot;mods&quot; result-prefix=&quot;mods&quot;/&gt;

	&lt;!-- Clone for generating multipart monograph TITLE element --&gt;
	&lt;!-- Author: Filip Majda, 2013 --&gt;

	&lt;!-- Maintenance note: For each revision, change the content of &lt;mods:recordInfo&gt;&lt;mods:recordOrigin&gt; to reflect the new revision number.
	MARC21slim2MODS3-4 (Revision 1.76) 20120201

REvision 1.77.NDK - Added full qualification mods: elements
Revision 1.76.NDK - Field 015 as CCNB
Revision 1.76 - Fixed 242 - 2012/02/01 tmee
Revision 1.75 - Fixed 653 - 2012/01/31 tmee
Revision 1.74 - Fixed 510 note - 2011/07/15 tmee
Revision 1.73 - Fixed 506 540 - 2011/07/11 tmee
Revision 1.72 - Fixed frequency error - 2011/07/07 and 2011/07/14 tmee
Revision 1.71 - Fixed subject titles for subfields t - 2011/04/26 tmee 
Revision 1.70 - Added mapping for OCLC numbers in 035s to go into &lt;mods:identifier type=&quot;oclc&quot;&gt; 2011/02/27 - tmee 	
Revision 1.69 - Added mapping for untyped identifiers for 024 - 2011/02/27 tmee 
Revision 1.68 - Added &lt;mods:subject&gt;&lt;mods:titleInfo&gt; mapping for 600/610/611 subfields t,p,n - 2010/12/22 tmee
Revision 1.67 - Added frequency values and authority=&quot;marcfrequency&quot; for 008/18 - 2010/12/09 tmee
Revision 1.66 - Fixed 008/06=c,d,i,m,k,u, from dateCreated to dateIssued - 2010/12/06 tmee
Revision 1.65 - Added back marcsmd and marccategory for 007 cr- 2010/12/06 tmee
Revision 1.64 - Fixed identifiers - removed isInvalid template - 2010/12/06 tmee
Revision 1.63 - Fixed descriptiveStandard value from aacr2 to aacr - 2010/12/06 tmee
Revision 1.62 - Fixed date mapping for 008/06=e,p,r,s,t - 2010/12/01 tmee
Revision 1.61 - Added 007 mappings for marccategory - 2010/11/12 tmee
Revision 1.60 - Added altRepGroups and 880 linkages for relevant fields, see mapping - 2010/11/26 tmee
Revision 1.59 - Added scriptTerm type=text to language for 546b and 066c - 2010/09/23 tmee
Revision 1.58 - Expanded script template to include code conversions for extended scripts - 2010/09/22 tmee
Revision 1.57 - Added Ldr/07 and Ldr/19 mappings - 2010/09/17 tmee
Revision 1.56 - Mapped 1xx usage=&quot;primary&quot; - 2010/09/17 tmee
Revision 1.55 - Mapped UT 240/1xx nameTitleGroup - 2010/09/17 tmee
MODS 3.4
Revision 1.54 - Fixed 086 redundancy - 2010/07/27 tmee
Revision 1.53 - Added direct href for MARC21slimUtils - 2010/07/27 tmee
Revision 1.52 - Mapped 046 subfields c,e,k,l - 2010/04/09 tmee
Revision 1.51 - Corrected 856 transform - 2010/01/29 tmee
Revision 1.50 - Added 210 $2 authority attribute in &lt;mods:titleInfo type=”abbreviated”&gt; 2009/11/23 tmee
Revision 1.49 - Aquifer revision 1.14 - Added 240s (version) data to &lt;mods:titleInfo type=&quot;uniform&quot;&gt;&lt;mods:title&gt; 2009/11/23 tmee
Revision 1.48 - Aquifer revision 1.27 - Added mapping of 242 second indicator (for nonfiling characters) to &lt;mods:titleInfo&gt;&lt;mods:nonSort &gt; subelement  2007/08/08 tmee/dlf
Revision 1.47 - Aquifer revision 1.26 - Mapped 300 subfield f (type of unit) - and g (size of unit) 2009 ntra
Revision 1.46 - Aquifer revision 1.25 - Changed mapping of 767 so that &lt;type=&quot;otherVersion&gt;  2009/11/20  tmee
Revision 1.45 - Aquifer revision 1.24 - Changed mapping of 765 so that &lt;type=&quot;otherVersion&gt;  2009/11/20  tmee 
Revision 1.44 - Added &lt;mods:recordInfo&gt;&lt;mods:recordOrigin&gt; canned text about the version of this stylesheet 2009 ntra
Revision 1.43 - Mapped 351 subfields a,b,c 2009/11/20 tmee
Revision 1.42 - Changed 856 second indicator=1 to go to &lt;mods:location&gt;&lt;mods:url displayLabel=”electronic resource”&gt; instead of to &lt;mods:relatedItem type=”otherVersion”&gt;&lt;mods:url&gt; 2009/11/20 tmee
Revision 1.41 - Aquifer revision 1.9 Added variable and choice protocol for adding usage=”primary display” 2009/11/19 tmee 
Revision 1.40 - Dropped &lt;mods:note&gt; for 510 and added &lt;mods:relatedItem type=&quot;isReferencedBy&quot;&gt; for 510 2009/11/19 tmee
Revision 1.39 - Aquifer revision 1.23 Changed mapping for 762 (Subseries Entry) from &lt;mods:relatedItem type=&quot;series&quot;&gt; to &lt;mods:relatedItem type=&quot;constituent&quot;&gt; 2009/11/19 tmee
Revision 1.38 - Aquifer revision 1.29 Dropped 007s for electronic versions 2009/11/18 tmee
Revision 1.37 - Fixed date redundancy in output (with questionable dates) 2009/11/16 tmee
Revision 1.36 - If mss material (Ldr/06=d,p,f,t) map 008 dates and 260$c/$g dates to dateCreated 2009/11/24, otherwise map 008 and 260$c/$g to dateIssued 2010/01/08 tmee
Revision 1.35 - Mapped appended detailed dates from 008/07-10 and 008/11-14 to dateIssued or DateCreated w/encoding=&quot;marc&quot; 2010/01/12 tmee
Revision 1.34 - Mapped 045b B.C. and C.E. date range info to iso8601-compliant dates in &lt;mods:subject&gt;&lt;mods:temporal&gt; 2009/01/08 ntra
Revision 1.33 - Mapped Ldr/06 &quot;o&quot; to &lt;mods:typeOfResource&gt;kit 2009/11/16 tmee
Revision 1.32 - Mapped specific note types from the MODS Note Type list &lt;http://www.loc.gov/standards/mods/mods-notes.html&gt; tmee 2009/11/17
Revision 1.31 - Mapped 540 to &lt;mods:accessCondition type=&quot;use and reproduction&quot;&gt; and 506 to &lt;mods:accessCondition type=&quot;restriction on access&quot;&gt; and delete mappings of 540 and 506 to &lt;mods:note&gt;
Revision 1.30 - Mapped 037c to &lt;mods:identifier displayLabel=&quot;&quot;&gt; 2009/11/13 tmee
Revision 1.29 - Corrected schemaLocation to 3.3 2009/11/13 tmee
Revision 1.28 - Changed mapping from 752,662 g going to mods:hierarchicalGeographic/area instead of &quot;region&quot; 2009/07/30 ntra
Revision 1.27 - Mapped 648 to &lt;mods:subject&gt; 2009/03/13 tmee
Revision 1.26 - Added subfield $s mapping for 130/240/730  2008/10/16 tmee
Revision 1.25 - Mapped 040e to &lt;mods:descriptiveStandard&gt; and Leader/18 to &lt;mods:descriptive standard&gt;aacr2  2008/09/18 tmee
Revision 1.24 - Mapped 852 subfields $h, $i, $j, $k, $l, $m, $t to &lt;mods:shelfLocation&gt; and 852 subfield $u to &lt;mods:physicalLocation&gt; with @xlink 2008/09/17 tmee
Revision 1.23 - Commented out xlink/uri for subfield 0 for 130/240/730, 100/700, 110/710, 111/711 as these are currently unactionable  2008/09/17 tmee
Revision 1.22 - Mapped 022 subfield $l to type &quot;issn-l&quot; subfield $m to output identifier element with corresponding @type and @invalid eq &#39;yes&#39;2008/09/17 tmee
Revision 1.21 - Mapped 856 ind2=1 or ind2=2 to &lt;mods:relatedItem&gt;&lt;mods:location&gt;&lt;mods:url&gt;  2008/07/03 tmee
Revision 1.20 - Added genre w/@auth=&quot;contents of 2&quot; and type= &quot;musical composition&quot;  2008/07/01 tmee
Revision 1.19 - Added genre offprint for 008/24+ BK code 2  2008/07/01  tmee
Revision 1.18 - Added xlink/uri for subfield 0 for 130/240/730, 100/700, 110/710, 111/711  2008/06/26 tmee
Revision 1.17 - Added mapping of 662 2008/05/14 tmee	
Revision 1.16 - Changed @authority from &quot;marc&quot; to &quot;marcgt&quot; for 007 and 008 codes mapped to a term in &lt;mods:genre&gt; 2007/07/10 tmee
Revision 1.15 - For field 630, moved call to part template outside title element  2007/07/10 tmee
Revision 1.14 - Fixed template isValid and fields 010, 020, 022, 024, 028, and 037 to output additional identifier elements with corresponding @type and @invalid eq &#39;yes&#39; when subfields z or y (in the case of 022) exist in the MARCXML ::: 2007/01/04 17:35:20 cred
Revision 1.13 - Changed order of output under cartographics to reflect schema  2006/11/28 tmee
Revision 1.12 - Updated to reflect MODS 3.2 Mapping  2006/10/11 tmee
Revision 1.11 - The attribute objectPart moved from &lt;mods:languageTerm&gt; to &lt;mods:language&gt;  2006/04/08  jrad
Revision 1.10 - MODS 3.1 revisions to language and classification elements (plus ability to find marc:collection embedded in wrapper elements such as SRU zs: wrappers)  2006/02/06  ggar
Revision 1.09 - Subfield $y was added to field 242 2004/09/02 10:57 jrad
Revision 1.08 - Subject chopPunctuation expanded and attribute fixes 2004/08/12 jrad
Revision 1.07 - 2004/03/25 08:29 jrad
Revision 1.06 - Various validation fixes 2004/02/20 ntra
Revision 1.05 - MODS2 to MODS3 updates, language unstacking and de-duping, chopPunctuation expanded  2003/10/02 16:18:58  ntra
Revision 1.03 - Additional Changes not related to MODS Version 2.0 by ntra
Revision 1.02 - Added Log Comment  2003/03/24 19:37:42  ckeith
	--&gt;

	&lt;xsl:template match=&quot;/&quot;&gt;
		&lt;!-- &lt;mods:mods xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; version=&quot;3.4&quot;
			xsi:schemaLocation=&quot;http://www.loc.gov/mods/v3 http://www.loc.gov/standards/mods/v3/mods-3-4.xsd&quot;&gt; --&gt;
		&lt;mods:mods&gt;	
			&lt;xsl:for-each select=&quot;//marc:record&quot;&gt;
			&lt;xsl:call-template name=&quot;marcRecord&quot;/&gt;
			&lt;/xsl:for-each&gt;
		&lt;/mods:mods&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;marcRecord&quot;&gt;
		&lt;xsl:variable name=&quot;leader&quot; select=&quot;marc:leader&quot;/&gt;
		&lt;xsl:variable name=&quot;leader6&quot; select=&quot;substring($leader,7,1)&quot;/&gt;
		&lt;xsl:variable name=&quot;leader7&quot; select=&quot;substring($leader,8,1)&quot;/&gt;
		&lt;xsl:variable name=&quot;leader19&quot; select=&quot;substring($leader,20,1)&quot;/&gt;
		&lt;xsl:variable name=&quot;controlField008&quot; select=&quot;marc:controlfield[@tag=&#39;008&#39;]&quot;/&gt;
		&lt;xsl:variable name=&quot;typeOf008&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;$leader6=&#39;a&#39;&quot;&gt;
					&lt;xsl:choose&gt;
						&lt;xsl:when
							test=&quot;$leader7=&#39;a&#39; or $leader7=&#39;c&#39; or $leader7=&#39;d&#39; or $leader7=&#39;m&#39;&quot;
							&gt;BK&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$leader7=&#39;b&#39; or $leader7=&#39;i&#39; or $leader7=&#39;s&#39;&quot;&gt;SE&lt;/xsl:when&gt;
					&lt;/xsl:choose&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$leader6=&#39;t&#39;&quot;&gt;BK&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$leader6=&#39;p&#39;&quot;&gt;MM&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$leader6=&#39;m&#39;&quot;&gt;CF&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$leader6=&#39;e&#39; or $leader6=&#39;f&#39;&quot;&gt;MP&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$leader6=&#39;g&#39; or $leader6=&#39;k&#39; or $leader6=&#39;o&#39; or $leader6=&#39;r&#39;&quot;
					&gt;VM&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$leader6=&#39;c&#39; or $leader6=&#39;d&#39; or $leader6=&#39;i&#39; or $leader6=&#39;j&#39;&quot;
					&gt;MU&lt;/xsl:when&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;

		&lt;!-- titleInfo --&gt;

		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;245&#39;]&quot;&gt;
			&lt;xsl:call-template name=&quot;createTitleInfoFrom245&quot;/&gt;
		&lt;/xsl:for-each&gt;
		
		&lt;!-- Genre --&gt;

		&lt;mods:genre&gt;title&lt;/mods:genre&gt;

		&lt;!-- Origin Info --&gt;
		
		&lt;mods:originInfo&gt;

			&lt;xsl:for-each
				select=&quot;marc:datafield[@tag=260]/marc:subfield[@code=&#39;b&#39; or @code=&#39;c&#39; or @code=&#39;g&#39;]&quot;&gt;
				&lt;xsl:choose&gt;
					&lt;xsl:when test=&quot;@code=&#39;b&#39;&quot;&gt;
						&lt;mods:publisher&gt;
							&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
								&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
								&lt;xsl:with-param name=&quot;punctuation&quot;&gt;
									&lt;xsl:text&gt;:,;/ &lt;/xsl:text&gt;
								&lt;/xsl:with-param&gt;
							&lt;/xsl:call-template&gt;
						&lt;/mods:publisher&gt;
					&lt;/xsl:when&gt;
				&lt;/xsl:choose&gt;
			&lt;/xsl:for-each&gt;


			&lt;xsl:for-each select=&quot;marc:datafield[@tag=250]/marc:subfield[@code=&#39;a&#39;]&quot;&gt;
				&lt;mods:edition&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:edition&gt;
			&lt;/xsl:for-each&gt;

		&lt;/mods:originInfo&gt;
		
		
		&lt;!-- Identifiers --&gt;
		
		&lt;!-- 015, 856, 020, 024, 022, 028, 010, 035, 037 --&gt;

		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;015&#39;]&quot;&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=&#39;a&#39;]&quot;&gt;
	            &lt;mods:identifier type=&quot;ccnb&quot;&gt;
	               &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
	            &lt;/mods:identifier&gt;
	        &lt;/xsl:if&gt;
         	&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;z&#39;]&quot;&gt;
            	&lt;mods:identifier type=&quot;ccnb&quot; invalid=&quot;yes&quot;&gt;
               		&lt;xsl:value-of select=&quot;.&quot;/&gt;
            	&lt;/mods:identifier&gt;
         	&lt;/xsl:for-each&gt;
		&lt;/xsl:for-each&gt;
		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;020&#39;]&quot;&gt;
         &lt;xsl:if test=&quot;marc:subfield[@code=&#39;a&#39;] and not(starts-with(marc:subfield[@code=&#39;a&#39;],&#39;(&#39;))&quot;&gt;
            &lt;mods:identifier type=&quot;isbn&quot;&gt;
               &lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
                  &lt;xsl:with-param name=&quot;chopString&quot; select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
               &lt;/xsl:call-template&gt;
            &lt;/mods:identifier&gt;
         &lt;/xsl:if&gt;
         &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;z&#39;]&quot;&gt;
            &lt;xsl:if test=&quot;not(starts-with(.,&#39;(&#39;))&quot;&gt;
               &lt;mods:identifier type=&quot;isbn&quot; invalid=&quot;yes&quot;&gt;
                  &lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
                     &lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
                  &lt;/xsl:call-template&gt;
               &lt;/mods:identifier&gt;
            &lt;/xsl:if&gt;
         &lt;/xsl:for-each&gt;
      &lt;/xsl:for-each&gt;

      &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;024&#39;][@ind1=&#39;0&#39;]&quot;&gt;
         &lt;xsl:if test=&quot;marc:subfield[@code=&#39;a&#39;]&quot;&gt;
            &lt;mods:identifier type=&quot;isrc&quot;&gt;
               &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
            &lt;/mods:identifier&gt;
         &lt;/xsl:if&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;024&#39;][@ind1=&#39;2&#39;]&quot;&gt;
         &lt;xsl:if test=&quot;marc:subfield[@code=&#39;a&#39;] and not(starts-with(marc:subfield[@code=&#39;a&#39;],&#39;(&#39;))&quot;&gt;
            &lt;mods:identifier type=&quot;ismn&quot;&gt;
               &lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
                  &lt;xsl:with-param name=&quot;chopString&quot; select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
               &lt;/xsl:call-template&gt;
            &lt;/mods:identifier&gt;
         &lt;/xsl:if&gt;
         &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;z&#39;]&quot;&gt;
            &lt;xsl:if test=&quot;not(starts-with(.,&#39;(&#39;))&quot;&gt;
               &lt;mods:identifier type=&quot;ismn&quot; invalid=&quot;yes&quot;&gt;
                  &lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
                     &lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
                  &lt;/xsl:call-template&gt;
               &lt;/mods:identifier&gt;
            &lt;/xsl:if&gt;
         &lt;/xsl:for-each&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;024&#39;][@ind1=&#39;4&#39;]&quot;&gt;
         &lt;mods:identifier type=&quot;sici&quot;&gt;
            &lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
               &lt;xsl:with-param name=&quot;codes&quot;&gt;ab&lt;/xsl:with-param&gt;
            &lt;/xsl:call-template&gt;
         &lt;/mods:identifier&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;024&#39;][@ind1=&#39;8&#39;]&quot;&gt;
         &lt;mods:identifier&gt;
            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
         &lt;/mods:identifier&gt;
      &lt;/xsl:for-each&gt;

      &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;022&#39;]&quot;&gt;
         &lt;xsl:if test=&quot;marc:subfield[@code=&#39;a&#39;]&quot;&gt;
            &lt;mods:identifier type=&quot;issn&quot;&gt;
               &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
            &lt;/mods:identifier&gt;
         &lt;/xsl:if&gt;
         &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;z&#39;]&quot;&gt;
            &lt;mods:identifier type=&quot;issn&quot; invalid=&quot;yes&quot;&gt;
               &lt;xsl:value-of select=&quot;.&quot;/&gt;
            &lt;/mods:identifier&gt;
         &lt;/xsl:for-each&gt;
         &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;y&#39;]&quot;&gt;
            &lt;mods:identifier type=&quot;issn&quot; invalid=&quot;yes&quot;&gt;
               &lt;xsl:value-of select=&quot;.&quot;/&gt;
            &lt;/mods:identifier&gt;
         &lt;/xsl:for-each&gt;
         &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;l&#39;]&quot;&gt;
            &lt;mods:identifier type=&quot;issn-l&quot;&gt;
               &lt;xsl:value-of select=&quot;.&quot;/&gt;
            &lt;/mods:identifier&gt;
         &lt;/xsl:for-each&gt;
         &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;m&#39;]&quot;&gt;
            &lt;mods:identifier type=&quot;issn-l&quot; invalid=&quot;yes&quot;&gt;
               &lt;xsl:value-of select=&quot;.&quot;/&gt;
            &lt;/mods:identifier&gt;
         &lt;/xsl:for-each&gt;
      &lt;/xsl:for-each&gt;

		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;010&#39;][marc:subfield[@code=&#39;a&#39;]]&quot;&gt;
			&lt;mods:identifier type=&quot;lccn&quot;&gt;
				&lt;xsl:value-of select=&quot;normalize-space(marc:subfield[@code=&#39;a&#39;])&quot;/&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:for-each&gt;
		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;010&#39;][marc:subfield[@code=&#39;z&#39;]]&quot;&gt;
			&lt;mods:identifier type=&quot;lccn&quot; invalid=&quot;yes&quot;&gt;
				&lt;xsl:value-of select=&quot;normalize-space(marc:subfield[@code=&#39;z&#39;])&quot;/&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:for-each&gt;

		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;028&#39;]&quot;&gt;
			&lt;mods:identifier&gt;
				&lt;xsl:attribute name=&quot;type&quot;&gt;
					&lt;xsl:choose&gt;
						&lt;xsl:when test=&quot;@ind1=&#39;0&#39;&quot;&gt;issue number&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;@ind1=&#39;1&#39;&quot;&gt;matrix number&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;@ind1=&#39;2&#39;&quot;&gt;music plate&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;@ind1=&#39;3&#39;&quot;&gt;music publisher&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;@ind1=&#39;4&#39;&quot;&gt;videorecording identifier&lt;/xsl:when&gt;
					&lt;/xsl:choose&gt;
				&lt;/xsl:attribute&gt;
				&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
					&lt;xsl:with-param name=&quot;codes&quot;&gt;
						&lt;xsl:choose&gt;
							&lt;xsl:when test=&quot;@ind1=&#39;0&#39;&quot;&gt;ba&lt;/xsl:when&gt;
							&lt;xsl:otherwise&gt;ab&lt;/xsl:otherwise&gt;
						&lt;/xsl:choose&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:for-each&gt;

		&lt;xsl:for-each
			select=&quot;marc:datafield[@tag=&#39;035&#39;][marc:subfield[@code=&#39;a&#39;][contains(text(), &#39;(OCoLC)&#39;)]]&quot;&gt;
			&lt;mods:identifier type=&quot;oclc&quot;&gt;
				&lt;xsl:value-of
					select=&quot;normalize-space(substring-after(marc:subfield[@code=&#39;a&#39;], &#39;(OCoLC)&#39;))&quot;/&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:for-each&gt;

		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;037&#39;]&quot;&gt;
			&lt;mods:identifier type=&quot;stock number&quot;&gt;
				&lt;xsl:if test=&quot;marc:subfield[@code=&#39;c&#39;]&quot;&gt;
					&lt;xsl:attribute name=&quot;displayLabel&quot;&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;c&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/xsl:attribute&gt;
				&lt;/xsl:if&gt;
				&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
					&lt;xsl:with-param name=&quot;codes&quot;&gt;ab&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:for-each&gt;


		&lt;!-- 1.51 tmee 20100129--&gt;
		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;856&#39;][marc:subfield[@code=&#39;u&#39;]]&quot;&gt;
			&lt;xsl:if
				test=&quot;starts-with(marc:subfield[@code=&#39;u&#39;],&#39;urn:hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;http://hdl.loc.gov&#39;) &quot;&gt;
				&lt;mods:identifier&gt;
					&lt;xsl:attribute name=&quot;type&quot;&gt;
						&lt;xsl:if
							test=&quot;starts-with(marc:subfield[@code=&#39;u&#39;],&#39;urn:doi&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;doi&#39;)&quot;
							&gt;doi&lt;/xsl:if&gt;
						&lt;xsl:if
							test=&quot;starts-with(marc:subfield[@code=&#39;u&#39;],&#39;urn:hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;http://hdl.loc.gov&#39;)&quot;
							&gt;hdl&lt;/xsl:if&gt;
					&lt;/xsl:attribute&gt;
					&lt;xsl:value-of
						select=&quot;concat(&#39;hdl:&#39;,substring-after(marc:subfield[@code=&#39;u&#39;],&#39;http://hdl.loc.gov/&#39;))&quot;
					/&gt;
				&lt;/mods:identifier&gt;
			&lt;/xsl:if&gt;


			&lt;xsl:if
				test=&quot;starts-with(marc:subfield[@code=&#39;u&#39;],&#39;urn:hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;hdl&#39;)&quot;&gt;
				&lt;mods:identifier type=&quot;hdl&quot;&gt;
					&lt;xsl:if test=&quot;marc:subfield[@code=&#39;y&#39; or @code=&#39;3&#39; or @code=&#39;z&#39;]&quot;&gt;
						&lt;xsl:attribute name=&quot;displayLabel&quot;&gt;
							&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
								&lt;xsl:with-param name=&quot;codes&quot;&gt;y3z&lt;/xsl:with-param&gt;
							&lt;/xsl:call-template&gt;
						&lt;/xsl:attribute&gt;
					&lt;/xsl:if&gt;
					&lt;xsl:value-of
						select=&quot;concat(&#39;hdl:&#39;,substring-after(marc:subfield[@code=&#39;u&#39;],&#39;http://hdl.loc.gov/&#39;))&quot;
					/&gt;
				&lt;/mods:identifier&gt;
			&lt;/xsl:if&gt;
		&lt;/xsl:for-each&gt;

		&lt;xsl:for-each select=&quot;marc:datafield[@tag=024][@ind1=1]&quot;&gt;
			&lt;mods:identifier type=&quot;upc&quot;&gt;
				&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:for-each&gt;


		&lt;!-- 1.51 tmee 20100129--&gt;
		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;856&#39;][marc:subfield[@code=&#39;u&#39;]]&quot;&gt;
			&lt;xsl:if
				test=&quot;starts-with(marc:subfield[@code=&#39;u&#39;],&#39;urn:hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;http://hdl.loc.gov&#39;) &quot;&gt;
				&lt;mods:identifier&gt;
					&lt;xsl:attribute name=&quot;type&quot;&gt;
						&lt;xsl:if
							test=&quot;starts-with(marc:subfield[@code=&#39;u&#39;],&#39;urn:doi&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;doi&#39;)&quot;
							&gt;doi&lt;/xsl:if&gt;
						&lt;xsl:if
							test=&quot;starts-with(marc:subfield[@code=&#39;u&#39;],&#39;urn:hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;http://hdl.loc.gov&#39;)&quot;
							&gt;hdl&lt;/xsl:if&gt;
					&lt;/xsl:attribute&gt;
					&lt;xsl:value-of
						select=&quot;concat(&#39;hdl:&#39;,substring-after(marc:subfield[@code=&#39;u&#39;],&#39;http://hdl.loc.gov/&#39;))&quot;
					/&gt;
				&lt;/mods:identifier&gt;
			&lt;/xsl:if&gt;

			&lt;xsl:if
				test=&quot;starts-with(marc:subfield[@code=&#39;u&#39;],&#39;urn:hdl&#39;) or starts-with(marc:subfield[@code=&#39;u&#39;],&#39;hdl&#39;)&quot;&gt;
				&lt;mods:identifier type=&quot;hdl&quot;&gt;
					&lt;xsl:if test=&quot;marc:subfield[@code=&#39;y&#39; or @code=&#39;3&#39; or @code=&#39;z&#39;]&quot;&gt;
						&lt;xsl:attribute name=&quot;displayLabel&quot;&gt;
							&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
								&lt;xsl:with-param name=&quot;codes&quot;&gt;y3z&lt;/xsl:with-param&gt;
							&lt;/xsl:call-template&gt;
						&lt;/xsl:attribute&gt;
					&lt;/xsl:if&gt;
					&lt;xsl:value-of
						select=&quot;concat(&#39;hdl:&#39;,substring-after(marc:subfield[@code=&#39;u&#39;],&#39;http://hdl.loc.gov/&#39;))&quot;
					/&gt;
				&lt;/mods:identifier&gt;
			&lt;/xsl:if&gt;
		&lt;/xsl:for-each&gt;

	&lt;/xsl:template&gt;
	
	&lt;!-- The rest is completely duplicite with MARC21slim2MODS3-4-NDK.xsl --&gt;

	&lt;xsl:template name=&quot;displayForm&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;c&#39;]&quot;&gt;
			&lt;mods:displayForm&gt;
				&lt;xsl:value-of select=&quot;.&quot;/&gt;
			&lt;/mods:displayForm&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;affiliation&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;u&#39;]&quot;&gt;
			&lt;mods:affiliation&gt;
				&lt;xsl:value-of select=&quot;.&quot;/&gt;
			&lt;/mods:affiliation&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;uri&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;u&#39;]|marc:subfield[@code=&#39;0&#39;]&quot;&gt;
			&lt;xsl:attribute name=&quot;xlink:href&quot;&gt;
				&lt;xsl:value-of select=&quot;.&quot;/&gt;
			&lt;/xsl:attribute&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;role&quot;&gt;
		&lt;!-- Not used in NK/MZK 
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;e&#39;]&quot;&gt;
			&lt;mods:role&gt;
				&lt;mods:roleTerm type=&quot;text&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:roleTerm&gt;
			&lt;/mods:role&gt;
		&lt;/xsl:for-each&gt;
		 --&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;4&#39;]&quot;&gt;
			&lt;mods:role&gt;
				&lt;mods:roleTerm authority=&quot;marcrelator&quot; type=&quot;code&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:roleTerm&gt;
			&lt;/mods:role&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;part&quot;&gt;
		&lt;xsl:variable name=&quot;partNumber&quot;&gt;
			&lt;xsl:call-template name=&quot;specialSubfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;axis&quot;&gt;n&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;anyCodes&quot;&gt;n&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;afterCodes&quot;&gt;fgkdlmor&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:variable name=&quot;partName&quot;&gt;
			&lt;xsl:call-template name=&quot;specialSubfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;axis&quot;&gt;p&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;anyCodes&quot;&gt;p&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;afterCodes&quot;&gt;fgkdlmor&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:if test=&quot;string-length(normalize-space($partNumber))&quot;&gt;
			&lt;mods:partNumber&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;$partNumber&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:partNumber&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;string-length(normalize-space($partName))&quot;&gt;
			&lt;mods:partName&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;$partName&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:partName&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedPart&quot;&gt;
		&lt;xsl:if test=&quot;@tag=773&quot;&gt;
			&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;g&#39;]&quot;&gt;
				&lt;mods:part&gt;
					&lt;mods:text&gt;
						&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;/mods:text&gt;
				&lt;/mods:part&gt;
			&lt;/xsl:for-each&gt;
			&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;q&#39;]&quot;&gt;
				&lt;mods:part&gt;
					&lt;xsl:call-template name=&quot;parsePart&quot;/&gt;
				&lt;/mods:part&gt;
			&lt;/xsl:for-each&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedPartNumName&quot;&gt;
		&lt;xsl:variable name=&quot;partNumber&quot;&gt;
			&lt;xsl:call-template name=&quot;specialSubfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;axis&quot;&gt;g&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;anyCodes&quot;&gt;g&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;afterCodes&quot;&gt;pst&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:variable name=&quot;partName&quot;&gt;
			&lt;xsl:call-template name=&quot;specialSubfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;axis&quot;&gt;p&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;anyCodes&quot;&gt;p&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;afterCodes&quot;&gt;fgkdlmor&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:if test=&quot;string-length(normalize-space($partNumber))&quot;&gt;
			&lt;mods:partNumber&gt;
				&lt;xsl:value-of select=&quot;$partNumber&quot;/&gt;
			&lt;/mods:partNumber&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;string-length(normalize-space($partName))&quot;&gt;
			&lt;mods:partName&gt;
				&lt;xsl:value-of select=&quot;$partName&quot;/&gt;
			&lt;/mods:partName&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedName&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;&gt;
			&lt;mods:name&gt;
				&lt;mods:namePart&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:namePart&gt;
			&lt;/mods:name&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedForm&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;h&#39;]&quot;&gt;
			&lt;mods:physicalDescription&gt;
				&lt;mods:form&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:form&gt;
			&lt;/mods:physicalDescription&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedExtent&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;h&#39;]&quot;&gt;
			&lt;mods:physicalDescription&gt;
				&lt;mods:extent&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:extent&gt;
			&lt;/mods:physicalDescription&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedNote&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;n&#39;]&quot;&gt;
			&lt;mods:note&gt;
				&lt;xsl:value-of select=&quot;.&quot;/&gt;
			&lt;/mods:note&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedSubject&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;j&#39;]&quot;&gt;
			&lt;mods:subject&gt;
				&lt;mods:temporal encoding=&quot;iso8601&quot;&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:temporal&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedIdentifierISSN&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;x&#39;]&quot;&gt;
			&lt;mods:identifier type=&quot;issn&quot;&gt;
				&lt;xsl:value-of select=&quot;.&quot;/&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedIdentifierLocal&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;w&#39;]&quot;&gt;
			&lt;mods:identifier type=&quot;local&quot;&gt;
				&lt;xsl:value-of select=&quot;.&quot;/&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedIdentifier&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;o&#39;]&quot;&gt;
			&lt;mods:identifier&gt;
				&lt;xsl:value-of select=&quot;.&quot;/&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;!--tmee 1.40 510 isReferencedBy --&gt;
	&lt;xsl:template name=&quot;relatedItem510&quot;&gt;
		&lt;xsl:call-template name=&quot;displayLabel&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedTitle76X-78X&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedName&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedOriginInfo510&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedLanguage&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedExtent&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedNote&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedSubject&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedIdentifier&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedIdentifierISSN&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedIdentifierLocal&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedPart&quot;/&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedItem76X-78X&quot;&gt;
		&lt;xsl:call-template name=&quot;displayLabel&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedTitle76X-78X&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedName&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedOriginInfo&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedLanguage&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedExtent&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedNote&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedSubject&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedIdentifier&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedIdentifierISSN&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedIdentifierLocal&quot;/&gt;
		&lt;xsl:call-template name=&quot;relatedPart&quot;/&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;subjectGeographicZ&quot;&gt;
		&lt;mods:geographic&gt;
			&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
				&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:geographic&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;subjectTemporalY&quot;&gt;
		&lt;mods:temporal&gt;
			&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
				&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:temporal&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;subjectTopic&quot;&gt;
		&lt;mods:topic&gt;
			&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
				&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:topic&gt;
	&lt;/xsl:template&gt;
	&lt;!-- 3.2 change tmee 6xx $v genre --&gt;
	&lt;xsl:template name=&quot;subjectGenre&quot;&gt;
		&lt;mods:genre&gt;
			&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
				&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:genre&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;nameABCDN&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;&gt;
			&lt;mods:namePart&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:namePart&gt;
		&lt;/xsl:for-each&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;
			&lt;mods:namePart&gt;
				&lt;xsl:value-of select=&quot;.&quot;/&gt;
			&lt;/mods:namePart&gt;
		&lt;/xsl:for-each&gt;
		&lt;xsl:if
			test=&quot;marc:subfield[@code=&#39;c&#39;] or marc:subfield[@code=&#39;d&#39;] or marc:subfield[@code=&#39;n&#39;]&quot;&gt;
			&lt;mods:namePart&gt;
				&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
					&lt;xsl:with-param name=&quot;codes&quot;&gt;cdn&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:namePart&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;nameABCDQ&quot;&gt;
		&lt;mods:namePart&gt;
			&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
				&lt;xsl:with-param name=&quot;chopString&quot;&gt;
					&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
						&lt;xsl:with-param name=&quot;codes&quot;&gt;aq&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;punctuation&quot;&gt;
					&lt;xsl:text&gt;:,;/ &lt;/xsl:text&gt;
				&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:namePart&gt;
		&lt;xsl:call-template name=&quot;termsOfAddress&quot;/&gt;
		&lt;xsl:call-template name=&quot;nameDate&quot;/&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;nameACDEQ&quot;&gt;
		&lt;mods:namePart&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;acdneq&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:namePart&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;constituentOrRelatedType&quot;&gt;
		&lt;xsl:if test=&quot;@ind2=2&quot;&gt;
			&lt;xsl:attribute name=&quot;type&quot;&gt;constituent&lt;/xsl:attribute&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedTitle&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;t&#39;]&quot;&gt;
			&lt;mods:titleInfo&gt;
				&lt;mods:title&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot;&gt;
							&lt;xsl:value-of select=&quot;.&quot;/&gt;
						&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:title&gt;
			&lt;/mods:titleInfo&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedTitle76X-78X&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;t&#39;]&quot;&gt;
			&lt;mods:titleInfo&gt;
				&lt;mods:title&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot;&gt;
							&lt;xsl:value-of select=&quot;.&quot;/&gt;
						&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:title&gt;
				&lt;xsl:if test=&quot;marc:datafield[@tag!=773]and marc:subfield[@code=&#39;g&#39;]&quot;&gt;
					&lt;xsl:call-template name=&quot;relatedPartNumName&quot;/&gt;
				&lt;/xsl:if&gt;
			&lt;/mods:titleInfo&gt;
		&lt;/xsl:for-each&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;p&#39;]&quot;&gt;
			&lt;mods:titleInfo type=&quot;abbreviated&quot;&gt;
				&lt;mods:title&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot;&gt;
							&lt;xsl:value-of select=&quot;.&quot;/&gt;
						&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:title&gt;
				&lt;xsl:if test=&quot;marc:datafield[@tag!=773]and marc:subfield[@code=&#39;g&#39;]&quot;&gt;
					&lt;xsl:call-template name=&quot;relatedPartNumName&quot;/&gt;
				&lt;/xsl:if&gt;
			&lt;/mods:titleInfo&gt;
		&lt;/xsl:for-each&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;s&#39;]&quot;&gt;
			&lt;mods:titleInfo type=&quot;uniform&quot;&gt;
				&lt;mods:title&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot;&gt;
							&lt;xsl:value-of select=&quot;.&quot;/&gt;
						&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:title&gt;
				&lt;xsl:if test=&quot;marc:datafield[@tag!=773]and marc:subfield[@code=&#39;g&#39;]&quot;&gt;
					&lt;xsl:call-template name=&quot;relatedPartNumName&quot;/&gt;
				&lt;/xsl:if&gt;
			&lt;/mods:titleInfo&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedOriginInfo&quot;&gt;
		&lt;xsl:if test=&quot;marc:subfield[@code=&#39;b&#39; or @code=&#39;d&#39;] or marc:subfield[@code=&#39;f&#39;]&quot;&gt;
			&lt;mods:originInfo&gt;
				&lt;xsl:if test=&quot;@tag=775&quot;&gt;
					&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;f&#39;]&quot;&gt;
						&lt;mods:place&gt;
							&lt;mods:placeTerm&gt;
								&lt;xsl:attribute name=&quot;type&quot;&gt;text&lt;/xsl:attribute&gt;
								&lt;xsl:attribute name=&quot;authority&quot;&gt;marcgac&lt;/xsl:attribute&gt;
								&lt;xsl:value-of select=&quot;.&quot;/&gt;
							&lt;/mods:placeTerm&gt;
						&lt;/mods:place&gt;
					&lt;/xsl:for-each&gt;
				&lt;/xsl:if&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;d&#39;]&quot;&gt;
					&lt;mods:publisher&gt;
						&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;/mods:publisher&gt;
				&lt;/xsl:for-each&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;
					&lt;mods:edition&gt;
						&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;/mods:edition&gt;
				&lt;/xsl:for-each&gt;
			&lt;/mods:originInfo&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;!-- tmee 1.40 --&gt;

	&lt;xsl:template name=&quot;relatedOriginInfo510&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;
			&lt;mods:originInfo&gt;
				&lt;mods:dateOther type=&quot;coverage&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:dateOther&gt;
			&lt;/mods:originInfo&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;relatedLanguage&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;e&#39;]&quot;&gt;
			&lt;xsl:call-template name=&quot;getLanguage&quot;&gt;
				&lt;xsl:with-param name=&quot;langString&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;nameDate&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;d&#39;]&quot;&gt;
			&lt;mods:namePart type=&quot;date&quot;&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:namePart&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;subjectAuthority&quot;&gt;
		&lt;xsl:if test=&quot;@ind2!=4&quot;&gt;
			&lt;xsl:if test=&quot;@ind2!=&#39; &#39;&quot;&gt;
				&lt;xsl:if test=&quot;@ind2!=8&quot;&gt;
					&lt;xsl:if test=&quot;@ind2!=9 or marc:subfield[@code=&#39;2&#39;] != &#39;&#39;&quot;&gt;
						&lt;xsl:attribute name=&quot;authority&quot;&gt;
							&lt;xsl:choose&gt;
								&lt;xsl:when test=&quot;@ind2=0&quot;&gt;lcsh&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@ind2=1&quot;&gt;lcshac&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@ind2=2&quot;&gt;mesh&lt;/xsl:when&gt;
								&lt;!-- 1/04 fix --&gt;
								&lt;xsl:when test=&quot;@ind2=3&quot;&gt;nal&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@ind2=5&quot;&gt;csh&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@ind2=6&quot;&gt;rvm&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@ind2=7 or @ind2=9&quot;&gt;
									&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;2&#39;]&quot;/&gt;
								&lt;/xsl:when&gt;
							&lt;/xsl:choose&gt;
						&lt;/xsl:attribute&gt;
					&lt;/xsl:if&gt;
				&lt;/xsl:if&gt;
			&lt;/xsl:if&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;!-- 1.75 
		fix --&gt;
	&lt;xsl:template name=&quot;subject653Type&quot;&gt;
		&lt;xsl:if test=&quot;@ind2!=&#39; &#39;&quot;&gt;
			&lt;xsl:if test=&quot;@ind2!=&#39;0&#39;&quot;&gt;
				&lt;xsl:if test=&quot;@ind2!=&#39;4&#39;&quot;&gt;
					&lt;xsl:if test=&quot;@ind2!=&#39;5&#39;&quot;&gt;
						&lt;xsl:if test=&quot;@ind2!=&#39;6&#39;&quot;&gt;
							&lt;xsl:if test=&quot;@ind2!=&#39;7&#39;&quot;&gt;
								&lt;xsl:if test=&quot;@ind2!=&#39;8&#39;&quot;&gt;
									&lt;xsl:if test=&quot;@ind2!=&#39;7&#39;&quot;&gt;
										&lt;xsl:if test=&quot;@ind2!=&#39;8&#39;&quot;&gt;
											&lt;xsl:if test=&quot;@ind2!=&#39;9&#39;&quot;&gt;
												&lt;xsl:attribute name=&quot;type&quot;&gt;
												&lt;xsl:choose&gt;
												&lt;xsl:when test=&quot;@ind2=1&quot;&gt;personal&lt;/xsl:when&gt;
												&lt;xsl:when test=&quot;@ind2=2&quot;&gt;corporate&lt;/xsl:when&gt;
												&lt;xsl:when test=&quot;@ind2=3&quot;&gt;conference&lt;/xsl:when&gt;
												&lt;/xsl:choose&gt;
												&lt;/xsl:attribute&gt;
											&lt;/xsl:if&gt;
										&lt;/xsl:if&gt;
									&lt;/xsl:if&gt;
								&lt;/xsl:if&gt;
							&lt;/xsl:if&gt;
						&lt;/xsl:if&gt;
					&lt;/xsl:if&gt;
				&lt;/xsl:if&gt;
			&lt;/xsl:if&gt;
		&lt;/xsl:if&gt;


	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;subjectAnyOrder&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;v&#39; or @code=&#39;x&#39; or @code=&#39;y&#39; or @code=&#39;z&#39;]&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;@code=&#39;v&#39;&quot;&gt;
					&lt;xsl:call-template name=&quot;subjectGenre&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;@code=&#39;x&#39;&quot;&gt;
					&lt;xsl:call-template name=&quot;subjectTopic&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;@code=&#39;y&#39;&quot;&gt;
					&lt;xsl:call-template name=&quot;subjectTemporalY&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;@code=&#39;z&#39;&quot;&gt;
					&lt;xsl:call-template name=&quot;subjectGeographicZ&quot;/&gt;
				&lt;/xsl:when&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;specialSubfieldSelect&quot;&gt;
		&lt;xsl:param name=&quot;anyCodes&quot;/&gt;
		&lt;xsl:param name=&quot;axis&quot;/&gt;
		&lt;xsl:param name=&quot;beforeCodes&quot;/&gt;
		&lt;xsl:param name=&quot;afterCodes&quot;/&gt;
		&lt;xsl:variable name=&quot;str&quot;&gt;
			&lt;xsl:for-each select=&quot;marc:subfield&quot;&gt;
				&lt;xsl:if
					test=&quot;contains($anyCodes, @code) or (contains($beforeCodes,@code) and following-sibling::marc:subfield[@code=$axis])      or (contains($afterCodes,@code) and preceding-sibling::marc:subfield[@code=$axis])&quot;&gt;
					&lt;xsl:value-of select=&quot;text()&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:if&gt;
			&lt;/xsl:for-each&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
	&lt;/xsl:template&gt;



	&lt;xsl:template match=&quot;marc:datafield[@tag=656]&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=2]&quot;&gt;
				&lt;xsl:attribute name=&quot;authority&quot;&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=2]&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
			&lt;mods:occupation&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:occupation&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;termsOfAddress&quot;&gt;
		&lt;xsl:if test=&quot;marc:subfield[@code=&#39;b&#39; or @code=&#39;c&#39;]&quot;&gt;
			&lt;mods:namePart type=&quot;termsOfAddress&quot;&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;bc&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:namePart&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;displayLabel&quot;&gt;
		&lt;xsl:if test=&quot;marc:subfield[@code=&#39;i&#39;]&quot;&gt;
			&lt;xsl:attribute name=&quot;displayLabel&quot;&gt;
				&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;i&#39;]&quot;/&gt;
			&lt;/xsl:attribute&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;marc:subfield[@code=&#39;3&#39;]&quot;&gt;
			&lt;xsl:attribute name=&quot;displayLabel&quot;&gt;
				&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;3&#39;]&quot;/&gt;
			&lt;/xsl:attribute&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;!-- isInvalid
	&lt;xsl:template name=&quot;isInvalid&quot;&gt;
		&lt;xsl:param name=&quot;type&quot;/&gt;
		&lt;xsl:if
			test=&quot;marc:subfield[@code=&#39;z&#39;] or marc:subfield[@code=&#39;y&#39;] or marc:subfield[@code=&#39;m&#39;]&quot;&gt;
			&lt;mods:identifier&gt;
				&lt;xsl:attribute name=&quot;type&quot;&gt;
					&lt;xsl:value-of select=&quot;$type&quot;/&gt;
				&lt;/xsl:attribute&gt;
				&lt;xsl:attribute name=&quot;invalid&quot;&gt;
					&lt;xsl:text&gt;yes&lt;/xsl:text&gt;
				&lt;/xsl:attribute&gt;
				&lt;xsl:if test=&quot;marc:subfield[@code=&#39;z&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;z&#39;]&quot;/&gt;
				&lt;/xsl:if&gt;
				&lt;xsl:if test=&quot;marc:subfield[@code=&#39;y&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;y&#39;]&quot;/&gt;
				&lt;/xsl:if&gt;
				&lt;xsl:if test=&quot;marc:subfield[@code=&#39;m&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;m&#39;]&quot;/&gt;
				&lt;/xsl:if&gt;
			&lt;/mods:identifier&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	--&gt;
	&lt;xsl:template name=&quot;subtitle&quot;&gt;
		&lt;xsl:if test=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;
			&lt;mods:subTitle&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;b&#39;]&quot;/&gt;
						&lt;!--&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;b&lt;/xsl:with-param&gt;									
						&lt;/xsl:call-template&gt;--&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:subTitle&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;script&quot;&gt;
		&lt;xsl:param name=&quot;scriptCode&quot;/&gt;
		&lt;xsl:attribute name=&quot;script&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;!-- ISO 15924	and CJK is a local code	20101123--&gt;
				&lt;xsl:when test=&quot;$scriptCode=&#39;(3&#39;&quot;&gt;Arab&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$scriptCode=&#39;(4&#39;&quot;&gt;Arab&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$scriptCode=&#39;(B&#39;&quot;&gt;Latn&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$scriptCode=&#39;!E&#39;&quot;&gt;Latn&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$scriptCode=&#39;$1&#39;&quot;&gt;CJK&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$scriptCode=&#39;(N&#39;&quot;&gt;Cyrl&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$scriptCode=&#39;(Q&#39;&quot;&gt;Cyrl&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$scriptCode=&#39;(2&#39;&quot;&gt;Hebr&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;$scriptCode=&#39;(S&#39;&quot;&gt;Grek&lt;/xsl:when&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:attribute&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;parsePart&quot;&gt;
		&lt;!-- assumes 773$q= 1:2:3&lt;4
		     with up to 3 levels and one optional start page
		--&gt;
		&lt;xsl:variable name=&quot;level1&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;contains(text(),&#39;:&#39;)&quot;&gt;
					&lt;!-- 1:2 --&gt;
					&lt;xsl:value-of select=&quot;substring-before(text(),&#39;:&#39;)&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;not(contains(text(),&#39;:&#39;))&quot;&gt;
					&lt;!-- 1 or 1&lt;3 --&gt;
					&lt;xsl:if test=&quot;contains(text(),&#39;&amp;lt;&#39;)&quot;&gt;
						&lt;!-- 1&lt;3 --&gt;
						&lt;xsl:value-of select=&quot;substring-before(text(),&#39;&amp;lt;&#39;)&quot;/&gt;
					&lt;/xsl:if&gt;
					&lt;xsl:if test=&quot;not(contains(text(),&#39;&amp;lt;&#39;))&quot;&gt;
						&lt;!-- 1 --&gt;
						&lt;xsl:value-of select=&quot;text()&quot;/&gt;
					&lt;/xsl:if&gt;
				&lt;/xsl:when&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:variable name=&quot;sici2&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;starts-with(substring-after(text(),$level1),&#39;:&#39;)&quot;&gt;
					&lt;xsl:value-of select=&quot;substring(substring-after(text(),$level1),2)&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:otherwise&gt;
					&lt;xsl:value-of select=&quot;substring-after(text(),$level1)&quot;/&gt;
				&lt;/xsl:otherwise&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:variable name=&quot;level2&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;contains($sici2,&#39;:&#39;)&quot;&gt;
					&lt;!--  2:3&lt;4  --&gt;
					&lt;xsl:value-of select=&quot;substring-before($sici2,&#39;:&#39;)&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when test=&quot;contains($sici2,&#39;&amp;lt;&#39;)&quot;&gt;
					&lt;!-- 1: 2&lt;4 --&gt;
					&lt;xsl:value-of select=&quot;substring-before($sici2,&#39;&amp;lt;&#39;)&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:otherwise&gt;
					&lt;xsl:value-of select=&quot;$sici2&quot;/&gt;
					&lt;!-- 1:2 --&gt;
				&lt;/xsl:otherwise&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:variable name=&quot;sici3&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;starts-with(substring-after($sici2,$level2),&#39;:&#39;)&quot;&gt;
					&lt;xsl:value-of select=&quot;substring(substring-after($sici2,$level2),2)&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:otherwise&gt;
					&lt;xsl:value-of select=&quot;substring-after($sici2,$level2)&quot;/&gt;
				&lt;/xsl:otherwise&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:variable name=&quot;level3&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;contains($sici3,&#39;&amp;lt;&#39;)&quot;&gt;
					&lt;!-- 2&lt;4 --&gt;
					&lt;xsl:value-of select=&quot;substring-before($sici3,&#39;&amp;lt;&#39;)&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:otherwise&gt;
					&lt;xsl:value-of select=&quot;$sici3&quot;/&gt;
					&lt;!-- 3 --&gt;
				&lt;/xsl:otherwise&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:variable name=&quot;page&quot;&gt;
			&lt;xsl:if test=&quot;contains(text(),&#39;&amp;lt;&#39;)&quot;&gt;
				&lt;xsl:value-of select=&quot;substring-after(text(),&#39;&amp;lt;&#39;)&quot;/&gt;
			&lt;/xsl:if&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:if test=&quot;$level1&quot;&gt;
			&lt;mods:detail level=&quot;1&quot;&gt;
				&lt;mods:number&gt;
					&lt;xsl:value-of select=&quot;$level1&quot;/&gt;
				&lt;/mods:number&gt;
			&lt;/mods:detail&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;$level2&quot;&gt;
			&lt;mods:detail level=&quot;2&quot;&gt;
				&lt;mods:number&gt;
					&lt;xsl:value-of select=&quot;$level2&quot;/&gt;
				&lt;/mods:number&gt;
			&lt;/mods:detail&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;$level3&quot;&gt;
			&lt;mods:detail level=&quot;3&quot;&gt;
				&lt;mods:number&gt;
					&lt;xsl:value-of select=&quot;$level3&quot;/&gt;
				&lt;/mods:number&gt;
			&lt;/mods:detail&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;$page&quot;&gt;
			&lt;mods:extent unit=&quot;page&quot;&gt;
				&lt;mods:start&gt;
					&lt;xsl:value-of select=&quot;$page&quot;/&gt;
				&lt;/mods:start&gt;
			&lt;/mods:extent&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;getLanguage&quot;&gt;
		&lt;xsl:param name=&quot;langString&quot;/&gt;
		&lt;xsl:param name=&quot;controlField008-35-37&quot;/&gt;
		&lt;xsl:variable name=&quot;length&quot; select=&quot;string-length($langString)&quot;/&gt;
		&lt;xsl:choose&gt;
			&lt;xsl:when test=&quot;$length=0&quot;/&gt;
			&lt;xsl:when test=&quot;$controlField008-35-37=substring($langString,1,3)&quot;&gt;
				&lt;xsl:call-template name=&quot;getLanguage&quot;&gt;
					&lt;xsl:with-param name=&quot;langString&quot; select=&quot;substring($langString,4,$length)&quot;/&gt;
					&lt;xsl:with-param name=&quot;controlField008-35-37&quot; select=&quot;$controlField008-35-37&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:otherwise&gt;
				&lt;mods:language&gt;
					&lt;mods:languageTerm authority=&quot;iso639-2b&quot; type=&quot;code&quot;&gt;
						&lt;xsl:value-of select=&quot;substring($langString,1,3)&quot;/&gt;
					&lt;/mods:languageTerm&gt;
				&lt;/mods:language&gt;
				&lt;xsl:call-template name=&quot;getLanguage&quot;&gt;
					&lt;xsl:with-param name=&quot;langString&quot; select=&quot;substring($langString,4,$length)&quot;/&gt;
					&lt;xsl:with-param name=&quot;controlField008-35-37&quot; select=&quot;$controlField008-35-37&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/xsl:otherwise&gt;
		&lt;/xsl:choose&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;isoLanguage&quot;&gt;
		&lt;xsl:param name=&quot;currentLanguage&quot;/&gt;
		&lt;xsl:param name=&quot;usedLanguages&quot;/&gt;
		&lt;xsl:param name=&quot;remainingLanguages&quot;/&gt;
		&lt;xsl:choose&gt;
			&lt;xsl:when test=&quot;string-length($currentLanguage)=0&quot;/&gt;
			&lt;xsl:when test=&quot;not(contains($usedLanguages, $currentLanguage))&quot;&gt;
				&lt;mods:language&gt;
					&lt;xsl:if test=&quot;@code!=&#39;a&#39;&quot;&gt;
						&lt;xsl:attribute name=&quot;objectPart&quot;&gt;
							&lt;xsl:choose&gt;
								&lt;xsl:when test=&quot;@code=&#39;b&#39;&quot;&gt;summary or subtitle&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@code=&#39;d&#39;&quot;&gt;sung or spoken text&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@code=&#39;e&#39;&quot;&gt;libretto&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@code=&#39;f&#39;&quot;&gt;table of contents&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@code=&#39;g&#39;&quot;&gt;accompanying material&lt;/xsl:when&gt;
								&lt;xsl:when test=&quot;@code=&#39;h&#39;&quot;&gt;translation&lt;/xsl:when&gt;
							&lt;/xsl:choose&gt;
						&lt;/xsl:attribute&gt;
					&lt;/xsl:if&gt;
					&lt;mods:languageTerm authority=&quot;iso639-2b&quot; type=&quot;code&quot;&gt;
						&lt;xsl:value-of select=&quot;$currentLanguage&quot;/&gt;
					&lt;/mods:languageTerm&gt;
				&lt;/mods:language&gt;
				&lt;xsl:call-template name=&quot;isoLanguage&quot;&gt;
					&lt;xsl:with-param name=&quot;currentLanguage&quot;&gt;
						&lt;xsl:value-of select=&quot;substring($remainingLanguages,1,3)&quot;/&gt;
					&lt;/xsl:with-param&gt;
					&lt;xsl:with-param name=&quot;usedLanguages&quot;&gt;
						&lt;xsl:value-of select=&quot;concat($usedLanguages,$currentLanguage)&quot;/&gt;
					&lt;/xsl:with-param&gt;
					&lt;xsl:with-param name=&quot;remainingLanguages&quot;&gt;
						&lt;xsl:value-of
							select=&quot;substring($remainingLanguages,4,string-length($remainingLanguages))&quot;
						/&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:otherwise&gt;
				&lt;xsl:call-template name=&quot;isoLanguage&quot;&gt;
					&lt;xsl:with-param name=&quot;currentLanguage&quot;&gt;
						&lt;xsl:value-of select=&quot;substring($remainingLanguages,1,3)&quot;/&gt;
					&lt;/xsl:with-param&gt;
					&lt;xsl:with-param name=&quot;usedLanguages&quot;&gt;
						&lt;xsl:value-of select=&quot;concat($usedLanguages,$currentLanguage)&quot;/&gt;
					&lt;/xsl:with-param&gt;
					&lt;xsl:with-param name=&quot;remainingLanguages&quot;&gt;
						&lt;xsl:value-of
							select=&quot;substring($remainingLanguages,4,string-length($remainingLanguages))&quot;
						/&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/xsl:otherwise&gt;
		&lt;/xsl:choose&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;chopBrackets&quot;&gt;
		&lt;xsl:param name=&quot;chopString&quot;/&gt;
		&lt;xsl:variable name=&quot;string&quot;&gt;
			&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
				&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;$chopString&quot;/&gt;
			&lt;/xsl:call-template&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:if test=&quot;substring($string, 1,1)=&#39;[&#39;&quot;&gt;
			&lt;xsl:value-of select=&quot;substring($string,2, string-length($string)-2)&quot;/&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;substring($string, 1,1)!=&#39;[&#39;&quot;&gt;
			&lt;xsl:value-of select=&quot;$string&quot;/&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;rfcLanguages&quot;&gt;
		&lt;xsl:param name=&quot;nodeNum&quot;/&gt;
		&lt;xsl:param name=&quot;usedLanguages&quot;/&gt;
		&lt;xsl:param name=&quot;controlField008-35-37&quot;/&gt;
		&lt;xsl:variable name=&quot;currentLanguage&quot; select=&quot;.&quot;/&gt;
		&lt;xsl:choose&gt;
			&lt;xsl:when test=&quot;not($currentLanguage)&quot;/&gt;
			&lt;xsl:when
				test=&quot;$currentLanguage!=$controlField008-35-37 and $currentLanguage!=&#39;rfc3066&#39;&quot;&gt;
				&lt;xsl:if test=&quot;not(contains($usedLanguages,$currentLanguage))&quot;&gt;
					&lt;mods:language&gt;
						&lt;xsl:if test=&quot;@code!=&#39;a&#39;&quot;&gt;
							&lt;xsl:attribute name=&quot;objectPart&quot;&gt;
								&lt;xsl:choose&gt;
									&lt;xsl:when test=&quot;@code=&#39;b&#39;&quot;&gt;summary or subtitle&lt;/xsl:when&gt;
									&lt;xsl:when test=&quot;@code=&#39;d&#39;&quot;&gt;sung or spoken text&lt;/xsl:when&gt;
									&lt;xsl:when test=&quot;@code=&#39;e&#39;&quot;&gt;libretto&lt;/xsl:when&gt;
									&lt;xsl:when test=&quot;@code=&#39;f&#39;&quot;&gt;table of contents&lt;/xsl:when&gt;
									&lt;xsl:when test=&quot;@code=&#39;g&#39;&quot;&gt;accompanying material&lt;/xsl:when&gt;
									&lt;xsl:when test=&quot;@code=&#39;h&#39;&quot;&gt;translation&lt;/xsl:when&gt;
								&lt;/xsl:choose&gt;
							&lt;/xsl:attribute&gt;
						&lt;/xsl:if&gt;
						&lt;mods:languageTerm authority=&quot;rfc3066&quot; type=&quot;code&quot;&gt;
							&lt;xsl:value-of select=&quot;$currentLanguage&quot;/&gt;
						&lt;/mods:languageTerm&gt;
					&lt;/mods:language&gt;
				&lt;/xsl:if&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:otherwise&gt; &lt;/xsl:otherwise&gt;
		&lt;/xsl:choose&gt;
	&lt;/xsl:template&gt;

	&lt;!-- tmee added 20100106 for 045$b BC and CE date range info --&gt;
	&lt;xsl:template name=&quot;dates045b&quot;&gt;
		&lt;xsl:param name=&quot;str&quot;/&gt;
		&lt;xsl:variable name=&quot;first-char&quot; select=&quot;substring($str,1,1)&quot;/&gt;
		&lt;xsl:choose&gt;
			&lt;xsl:when test=&quot;$first-char =&#39;c&#39;&quot;&gt;
				&lt;xsl:value-of select=&quot;concat (&#39;-&#39;, substring($str, 2))&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$first-char =&#39;d&#39;&quot;&gt;
				&lt;xsl:value-of select=&quot;substring($str, 2)&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:otherwise&gt;
				&lt;xsl:value-of select=&quot;$str&quot;/&gt;
			&lt;/xsl:otherwise&gt;
		&lt;/xsl:choose&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;scriptCode&quot;&gt;
		&lt;xsl:variable name=&quot;sf06&quot; select=&quot;normalize-space(child::marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
		&lt;xsl:variable name=&quot;sf06a&quot; select=&quot;substring($sf06, 1, 3)&quot;/&gt;
		&lt;xsl:variable name=&quot;sf06b&quot; select=&quot;substring($sf06, 5, 2)&quot;/&gt;
		&lt;xsl:variable name=&quot;sf06c&quot; select=&quot;substring($sf06, 7)&quot;/&gt;
		&lt;xsl:variable name=&quot;scriptCode&quot; select=&quot;substring($sf06, 8, 2)&quot;/&gt;
		&lt;xsl:if test=&quot;//marc:datafield/marc:subfield[@code=&#39;6&#39;]&quot;&gt;
			&lt;xsl:attribute name=&quot;script&quot;&gt;
				&lt;xsl:choose&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;&#39;&quot;&gt;Latn&lt;/xsl:when&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;(3&#39;&quot;&gt;Arab&lt;/xsl:when&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;(4&#39;&quot;&gt;Arab&lt;/xsl:when&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;(B&#39;&quot;&gt;Latn&lt;/xsl:when&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;!E&#39;&quot;&gt;Latn&lt;/xsl:when&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;$1&#39;&quot;&gt;CJK&lt;/xsl:when&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;(N&#39;&quot;&gt;Cyrl&lt;/xsl:when&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;(Q&#39;&quot;&gt;Cyrl&lt;/xsl:when&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;(2&#39;&quot;&gt;Hebr&lt;/xsl:when&gt;
					&lt;xsl:when test=&quot;$scriptCode=&#39;(S&#39;&quot;&gt;Grek&lt;/xsl:when&gt;
				&lt;/xsl:choose&gt;
			&lt;/xsl:attribute&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;!-- tmee 20100927 for 880s &amp; corresponding fields  20101123 scriptCode --&gt;

	&lt;xsl:template name=&quot;xxx880&quot;&gt;
		&lt;xsl:if test=&quot;child::marc:subfield[@code=&#39;6&#39;]&quot;&gt;
			&lt;xsl:variable name=&quot;sf06&quot; select=&quot;normalize-space(child::marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
			&lt;xsl:variable name=&quot;sf06a&quot; select=&quot;substring($sf06, 1, 3)&quot;/&gt;
			&lt;xsl:variable name=&quot;sf06b&quot; select=&quot;substring($sf06, 5, 2)&quot;/&gt;
			&lt;xsl:variable name=&quot;sf06c&quot; select=&quot;substring($sf06, 7)&quot;/&gt;
			&lt;xsl:variable name=&quot;scriptCode&quot; select=&quot;substring($sf06, 8, 2)&quot;/&gt;
			&lt;xsl:if test=&quot;//marc:datafield/marc:subfield[@code=&#39;6&#39;]&quot;&gt;
				&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
					&lt;xsl:value-of select=&quot;$sf06b&quot;/&gt;
				&lt;/xsl:attribute&gt;
				&lt;xsl:attribute name=&quot;script&quot;&gt;
					&lt;xsl:choose&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;&#39;&quot;&gt;Latn&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;(3&#39;&quot;&gt;Arab&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;(4&#39;&quot;&gt;Arab&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;(B&#39;&quot;&gt;Latn&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;!E&#39;&quot;&gt;Latn&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;$1&#39;&quot;&gt;CJK&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;(N&#39;&quot;&gt;Cyrl&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;(Q&#39;&quot;&gt;Cyrl&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;(2&#39;&quot;&gt;Hebr&lt;/xsl:when&gt;
						&lt;xsl:when test=&quot;$scriptCode=&#39;(S&#39;&quot;&gt;Grek&lt;/xsl:when&gt;
					&lt;/xsl:choose&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;yyy880&quot;&gt;
		&lt;xsl:if test=&quot;preceding-sibling::marc:subfield[@code=&#39;6&#39;]&quot;&gt;
			&lt;xsl:variable name=&quot;sf06&quot;
				select=&quot;normalize-space(preceding-sibling::marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
			&lt;xsl:variable name=&quot;sf06a&quot; select=&quot;substring($sf06, 1, 3)&quot;/&gt;
			&lt;xsl:variable name=&quot;sf06b&quot; select=&quot;substring($sf06, 5, 2)&quot;/&gt;
			&lt;xsl:variable name=&quot;sf06c&quot; select=&quot;substring($sf06, 7)&quot;/&gt;
			&lt;xsl:if test=&quot;//marc:datafield/marc:subfield[@code=&#39;6&#39;]&quot;&gt;
				&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
					&lt;xsl:value-of select=&quot;$sf06b&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;z2xx880&quot;&gt;
		&lt;!-- Evaluating the 260 field --&gt;
		&lt;xsl:variable name=&quot;x260&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;@tag=&#39;260&#39; and marc:subfield[@code=&#39;6&#39;]&quot;&gt;
					&lt;xsl:variable name=&quot;sf06260&quot;
						select=&quot;normalize-space(child::marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06260a&quot; select=&quot;substring($sf06260, 1, 3)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06260b&quot; select=&quot;substring($sf06260, 5, 2)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06260c&quot; select=&quot;substring($sf06260, 7)&quot;/&gt;
					&lt;xsl:value-of select=&quot;$sf06260b&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when
					test=&quot;@tag=&#39;250&#39; and ../marc:datafield[@tag=&#39;260&#39;]/marc:subfield[@code=&#39;6&#39;]&quot;&gt;
					&lt;xsl:variable name=&quot;sf06260&quot;
						select=&quot;normalize-space(../marc:datafield[@tag=&#39;260&#39;]/marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06260a&quot; select=&quot;substring($sf06260, 1, 3)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06260b&quot; select=&quot;substring($sf06260, 5, 2)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06260c&quot; select=&quot;substring($sf06260, 7)&quot;/&gt;
					&lt;xsl:value-of select=&quot;$sf06260b&quot;/&gt;
				&lt;/xsl:when&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;

		&lt;xsl:variable name=&quot;x250&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;@tag=&#39;250&#39; and marc:subfield[@code=&#39;6&#39;]&quot;&gt;
					&lt;xsl:variable name=&quot;sf06250&quot;
						select=&quot;normalize-space(../marc:datafield[@tag=&#39;250&#39;]/marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06250a&quot; select=&quot;substring($sf06250, 1, 3)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06250b&quot; select=&quot;substring($sf06250, 5, 2)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06250c&quot; select=&quot;substring($sf06250, 7)&quot;/&gt;
					&lt;xsl:value-of select=&quot;$sf06250b&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when
					test=&quot;@tag=&#39;260&#39; and ../marc:datafield[@tag=&#39;250&#39;]/marc:subfield[@code=&#39;6&#39;]&quot;&gt;
					&lt;xsl:variable name=&quot;sf06250&quot;
						select=&quot;normalize-space(../marc:datafield[@tag=&#39;250&#39;]/marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06250a&quot; select=&quot;substring($sf06250, 1, 3)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06250b&quot; select=&quot;substring($sf06250, 5, 2)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06250c&quot; select=&quot;substring($sf06250, 7)&quot;/&gt;
					&lt;xsl:value-of select=&quot;$sf06250b&quot;/&gt;
				&lt;/xsl:when&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;

		&lt;xsl:choose&gt;
			&lt;xsl:when test=&quot;$x250!=&#39;&#39; and $x260!=&#39;&#39;&quot;&gt;
				&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
					&lt;xsl:value-of select=&quot;concat($x250, $x260)&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$x250!=&#39;&#39;&quot;&gt;
				&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
					&lt;xsl:value-of select=&quot;$x250&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$x260!=&#39;&#39;&quot;&gt;
				&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
					&lt;xsl:value-of select=&quot;$x260&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:when&gt;
		&lt;/xsl:choose&gt;
		&lt;xsl:if test=&quot;//marc:datafield/marc:subfield[@code=&#39;6&#39;]&quot;&gt; &lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;z3xx880&quot;&gt;
		&lt;!-- Evaluating the 300 field --&gt;
		&lt;xsl:variable name=&quot;x300&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;@tag=&#39;300&#39; and marc:subfield[@code=&#39;6&#39;]&quot;&gt;
					&lt;xsl:variable name=&quot;sf06300&quot;
						select=&quot;normalize-space(child::marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06300a&quot; select=&quot;substring($sf06300, 1, 3)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06300b&quot; select=&quot;substring($sf06300, 5, 2)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06300c&quot; select=&quot;substring($sf06300, 7)&quot;/&gt;
					&lt;xsl:value-of select=&quot;$sf06300b&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when
					test=&quot;@tag=&#39;351&#39; and ../marc:datafield[@tag=&#39;300&#39;]/marc:subfield[@code=&#39;6&#39;]&quot;&gt;
					&lt;xsl:variable name=&quot;sf06300&quot;
						select=&quot;normalize-space(../marc:datafield[@tag=&#39;300&#39;]/marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06300a&quot; select=&quot;substring($sf06300, 1, 3)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06300b&quot; select=&quot;substring($sf06300, 5, 2)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06300c&quot; select=&quot;substring($sf06300, 7)&quot;/&gt;
					&lt;xsl:value-of select=&quot;$sf06300b&quot;/&gt;
				&lt;/xsl:when&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;

		&lt;xsl:variable name=&quot;x351&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;@tag=&#39;351&#39; and marc:subfield[@code=&#39;6&#39;]&quot;&gt;
					&lt;xsl:variable name=&quot;sf06351&quot;
						select=&quot;normalize-space(../marc:datafield[@tag=&#39;351&#39;]/marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06351a&quot; select=&quot;substring($sf06351, 1, 3)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06351b&quot; select=&quot;substring($sf06351, 5, 2)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06351c&quot; select=&quot;substring($sf06351, 7)&quot;/&gt;
					&lt;xsl:value-of select=&quot;$sf06351b&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:when
					test=&quot;@tag=&#39;300&#39; and ../marc:datafield[@tag=&#39;351&#39;]/marc:subfield[@code=&#39;6&#39;]&quot;&gt;
					&lt;xsl:variable name=&quot;sf06351&quot;
						select=&quot;normalize-space(../marc:datafield[@tag=&#39;351&#39;]/marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06351a&quot; select=&quot;substring($sf06351, 1, 3)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06351b&quot; select=&quot;substring($sf06351, 5, 2)&quot;/&gt;
					&lt;xsl:variable name=&quot;sf06351c&quot; select=&quot;substring($sf06351, 7)&quot;/&gt;
					&lt;xsl:value-of select=&quot;$sf06351b&quot;/&gt;
				&lt;/xsl:when&gt;
			&lt;/xsl:choose&gt;
		&lt;/xsl:variable&gt;

		&lt;xsl:choose&gt;
			&lt;xsl:when test=&quot;$x351!=&#39;&#39; and $x300!=&#39;&#39;&quot;&gt;
				&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
					&lt;xsl:value-of select=&quot;concat($x351, $x300)&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$x351!=&#39;&#39;&quot;&gt;
				&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
					&lt;xsl:value-of select=&quot;$x351&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$x300!=&#39;&#39;&quot;&gt;
				&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
					&lt;xsl:value-of select=&quot;$x300&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:when&gt;
		&lt;/xsl:choose&gt;
		&lt;xsl:if test=&quot;//marc:datafield/marc:subfield[@code=&#39;6&#39;]&quot;&gt; &lt;/xsl:if&gt;
	&lt;/xsl:template&gt;



	&lt;xsl:template name=&quot;true880&quot;&gt;
		&lt;xsl:variable name=&quot;sf06&quot; select=&quot;normalize-space(marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
		&lt;xsl:variable name=&quot;sf06a&quot; select=&quot;substring($sf06, 1, 3)&quot;/&gt;
		&lt;xsl:variable name=&quot;sf06b&quot; select=&quot;substring($sf06, 5, 2)&quot;/&gt;
		&lt;xsl:variable name=&quot;sf06c&quot; select=&quot;substring($sf06, 7)&quot;/&gt;
		&lt;xsl:if test=&quot;//marc:datafield/marc:subfield[@code=&#39;6&#39;]&quot;&gt;
			&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
				&lt;xsl:value-of select=&quot;$sf06b&quot;/&gt;
			&lt;/xsl:attribute&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template match=&quot;marc:datafield&quot; mode=&quot;trans880&quot;&gt;
		&lt;xsl:variable name=&quot;dataField880&quot; select=&quot;//marc:datafield&quot;/&gt;
		&lt;xsl:variable name=&quot;sf06&quot; select=&quot;normalize-space(marc:subfield[@code=&#39;6&#39;])&quot;/&gt;
		&lt;xsl:variable name=&quot;sf06a&quot; select=&quot;substring($sf06, 1, 3)&quot;/&gt;
		&lt;xsl:variable name=&quot;sf06b&quot; select=&quot;substring($sf06, 4)&quot;/&gt;
		&lt;xsl:choose&gt;

			&lt;!--tranforms 880 equiv--&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;047&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createGenreFrom047&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;655&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createGenreFrom655&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;050&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createClassificationFrom050&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;060&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createClassificationFrom060&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;080&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createClassificationFrom080&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;082&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createClassificationFrom082&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;084&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createClassificationFrom080&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;086&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createClassificationFrom082&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;100&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNameFrom100&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;110&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNameFrom110&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;111&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNameFrom110&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;700&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNameFrom700&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;710&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNameFrom710&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;711&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNameFrom710&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;210&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createTitleInfoFrom210&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;245&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createTitleInfoFrom245&quot;/&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom245c&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;246&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createTitleInfoFrom246&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;240&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createTitleInfoFrom240&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;740&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createTitleInfoFrom740&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;130&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createTitleInfoFrom130&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;730&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createTitleInfoFrom730&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;505&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createTOCFrom505&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;520&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createAbstractFrom520&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;521&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createTargetAudienceFrom521&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;506&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createAccessConditionFrom506&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;540&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createAccessConditionFrom540&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;!-- note 245 362 etc	--&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;245&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom245c&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;362&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom362&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;502&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom502&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;504&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom504&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;508&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom508&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;511&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom511&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;515&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom515&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;518&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom518&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;524&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom524&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;530&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom530&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;533&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom533&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;534&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom534&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;535&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom535&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;536&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom536&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;538&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom538&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;541&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom541&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;545&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom545&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;546&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom546&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;561&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom561&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;562&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom562&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;581&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom581&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;583&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom583&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;585&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom585&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;!--	note 5XX	--&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;501&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;507&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;513&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;514&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;516&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;522&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;525&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;526&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;544&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;552&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;555&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;556&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;565&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;567&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;580&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;584&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;586&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createNoteFrom5XX&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;!--  subject 034 043 045 255 656 662 752 	--&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;034&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubGeoFrom034&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;043&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubGeoFrom043&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;045&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubTemFrom045&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;255&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubGeoFrom255&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;600&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubNameFrom600&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;610&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubNameFrom610&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;611&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubNameFrom611&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;630&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubTitleFrom630&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;648&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubChronFrom648&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;650&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubTopFrom650&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;651&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubGeoFrom651&quot;/&gt;
			&lt;/xsl:when&gt;


			&lt;xsl:when test=&quot;$sf06a=&#39;653&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubFrom653&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;656&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubFrom656&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;662&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubGeoFrom662752&quot;/&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;752&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createSubGeoFrom662752&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;!--  location  852 856 --&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;852&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createLocationFrom852&quot;/&gt;
			&lt;/xsl:when&gt;			
      		&lt;xsl:when test=&quot;$sf06a=&#39;910&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createLocationFrom910&quot; /&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;$sf06a=&#39;856&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createLocationFrom856&quot;/&gt;
			&lt;/xsl:when&gt;

			&lt;xsl:when test=&quot;$sf06a=&#39;490&#39;&quot;&gt;
				&lt;xsl:call-template name=&quot;createRelatedItemFrom490&quot;/&gt;
			&lt;/xsl:when&gt;
		&lt;/xsl:choose&gt;
	&lt;/xsl:template&gt;

	&lt;!-- titleInfo 130 730 245 246 240 740 210 --&gt;

	&lt;!-- 130 --&gt;
	&lt;xsl:template name=&quot;createTitleInfoFrom130&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;130&#39;][@ind2!=&#39;2&#39;]&quot;&gt;
			&lt;mods:titleInfo type=&quot;uniform&quot;&gt;
				&lt;mods:title&gt;
					&lt;xsl:variable name=&quot;str&quot;&gt;
						&lt;xsl:for-each select=&quot;marc:subfield&quot;&gt;
							&lt;xsl:if test=&quot;(contains(&#39;s&#39;,@code))&quot;&gt;
								&lt;xsl:value-of select=&quot;text()&quot;/&gt;
								&lt;xsl:text&gt; &lt;/xsl:text&gt;
							&lt;/xsl:if&gt;
							&lt;xsl:if
								test=&quot;(contains(&#39;adfklmors&#39;,@code) and (not(../marc:subfield[@code=&#39;n&#39; or @code=&#39;p&#39;]) or (following-sibling::marc:subfield[@code=&#39;n&#39; or @code=&#39;p&#39;])))&quot;&gt;
								&lt;xsl:value-of select=&quot;text()&quot;/&gt;
								&lt;xsl:text&gt; &lt;/xsl:text&gt;
							&lt;/xsl:if&gt;
						&lt;/xsl:for-each&gt;
					&lt;/xsl:variable&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot;&gt;
							&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
						&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:title&gt;
				&lt;xsl:call-template name=&quot;part&quot;/&gt;
			&lt;/mods:titleInfo&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;createTitleInfoFrom730&quot;&gt;
		&lt;mods:titleInfo type=&quot;uniform&quot;&gt;
			&lt;mods:title&gt;
				&lt;xsl:variable name=&quot;str&quot;&gt;
					&lt;xsl:for-each select=&quot;marc:subfield&quot;&gt;
						&lt;xsl:if test=&quot;(contains(&#39;s&#39;,@code))&quot;&gt;
							&lt;xsl:value-of select=&quot;text()&quot;/&gt;
							&lt;xsl:text&gt; &lt;/xsl:text&gt;
						&lt;/xsl:if&gt;
						&lt;xsl:if
							test=&quot;(contains(&#39;adfklmors&#39;,@code) and (not(../marc:subfield[@code=&#39;n&#39; or @code=&#39;p&#39;]) or (following-sibling::marc:subfield[@code=&#39;n&#39; or @code=&#39;p&#39;])))&quot;&gt;
							&lt;xsl:value-of select=&quot;text()&quot;/&gt;
							&lt;xsl:text&gt; &lt;/xsl:text&gt;
						&lt;/xsl:if&gt;
					&lt;/xsl:for-each&gt;
				&lt;/xsl:variable&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;

			&lt;/mods:title&gt;
			&lt;xsl:call-template name=&quot;part&quot;/&gt;
		&lt;/mods:titleInfo&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createTitleInfoFrom210&quot;&gt;
		&lt;mods:titleInfo type=&quot;abbreviated&quot;&gt;
			&lt;xsl:if test=&quot;marc:datafield[@tag=&#39;210&#39;][@ind2=&#39;2&#39;]&quot;&gt;
				&lt;xsl:attribute name=&quot;authority&quot;&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;2&#39;]&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;mods:title&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;a&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:title&gt;
			&lt;xsl:call-template name=&quot;subtitle&quot;/&gt;
		&lt;/mods:titleInfo&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createTitleInfoFrom245&quot;&gt;
		&lt;mods:titleInfo&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:variable name=&quot;title&quot;&gt;
				&lt;xsl:choose&gt;
					&lt;xsl:when test=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;
						&lt;xsl:call-template name=&quot;specialSubfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;axis&quot;&gt;b&lt;/xsl:with-param&gt;
							&lt;xsl:with-param name=&quot;beforeCodes&quot;&gt;afgk&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/xsl:when&gt;
					&lt;xsl:otherwise&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;abfgk&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/xsl:otherwise&gt;
				&lt;/xsl:choose&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:variable name=&quot;titleChop&quot;&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:value-of select=&quot;$title&quot;/&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;@ind2&amp;gt;0&quot;&gt;
					&lt;xsl:if test=&quot;@tag!=&#39;880&#39;&quot;&gt;
						&lt;mods:nonSort&gt;
							&lt;xsl:value-of select=&quot;substring($titleChop,1,@ind2)&quot;/&gt;
						&lt;/mods:nonSort&gt;
					&lt;/xsl:if&gt;
					&lt;mods:title&gt;
						&lt;xsl:value-of select=&quot;substring($titleChop,@ind2+1)&quot;/&gt;
					&lt;/mods:title&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:otherwise&gt;
					&lt;mods:title&gt;
						&lt;xsl:value-of select=&quot;$titleChop&quot;/&gt;
					&lt;/mods:title&gt;
				&lt;/xsl:otherwise&gt;
			&lt;/xsl:choose&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;
				&lt;mods:subTitle&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot;&gt;
							&lt;xsl:call-template name=&quot;specialSubfieldSelect&quot;&gt;
								&lt;xsl:with-param name=&quot;axis&quot;&gt;b&lt;/xsl:with-param&gt;
								&lt;xsl:with-param name=&quot;anyCodes&quot;&gt;b&lt;/xsl:with-param&gt;
								&lt;xsl:with-param name=&quot;afterCodes&quot;&gt;afgk&lt;/xsl:with-param&gt;
							&lt;/xsl:call-template&gt;
						&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:subTitle&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;part&quot;/&gt;
		&lt;/mods:titleInfo&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createTitleInfoFrom246&quot;&gt;
		&lt;mods:titleInfo type=&quot;alternative&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;i&#39;]&quot;&gt;
				&lt;xsl:attribute name=&quot;displayLabel&quot;&gt;
					&lt;xsl:value-of select=&quot;text()&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:for-each&gt;
			&lt;mods:title&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;!-- 1/04 removed $h, $b --&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;af&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:title&gt;
			&lt;xsl:call-template name=&quot;subtitle&quot;/&gt;
			&lt;xsl:call-template name=&quot;part&quot;/&gt;
		&lt;/mods:titleInfo&gt;
	&lt;/xsl:template&gt;

	&lt;!-- 240 nameTitleGroup--&gt;

	&lt;xsl:template name=&quot;createTitleInfoFrom240&quot;&gt;
		&lt;mods:titleInfo type=&quot;uniform&quot;&gt;
			&lt;xsl:if
				test=&quot;//marc:datafield[@tag=&#39;100&#39;]|//marc:datafield[@tag=&#39;110&#39;]|//marc:datafield[@tag=&#39;111&#39;]&quot;&gt;
				&lt;xsl:attribute name=&quot;nameTitleGroup&quot;&gt;
					&lt;xsl:text&gt;1&lt;/xsl:text&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;mods:title&gt;
				&lt;xsl:variable name=&quot;str&quot;&gt;
					&lt;xsl:for-each select=&quot;marc:subfield&quot;&gt;
						&lt;xsl:if test=&quot;(contains(&#39;s&#39;,@code))&quot;&gt;
							&lt;xsl:value-of select=&quot;text()&quot;/&gt;
							&lt;xsl:text&gt; &lt;/xsl:text&gt;
						&lt;/xsl:if&gt;
						&lt;xsl:if
							test=&quot;(contains(&#39;adfklmors&#39;,@code) and (not(../marc:subfield[@code=&#39;n&#39; or @code=&#39;p&#39;]) or (following-sibling::marc:subfield[@code=&#39;n&#39; or @code=&#39;p&#39;])))&quot;&gt;
							&lt;xsl:value-of select=&quot;text()&quot;/&gt;
							&lt;xsl:text&gt; &lt;/xsl:text&gt;
						&lt;/xsl:if&gt;
					&lt;/xsl:for-each&gt;
				&lt;/xsl:variable&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:title&gt;
			&lt;xsl:call-template name=&quot;part&quot;/&gt;
		&lt;/mods:titleInfo&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createTitleInfoFrom740&quot;&gt;
		&lt;mods:titleInfo type=&quot;alternative&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;mods:title&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;ah&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:title&gt;
			&lt;xsl:call-template name=&quot;part&quot;/&gt;
		&lt;/mods:titleInfo&gt;
	&lt;/xsl:template&gt;

	&lt;!-- name 100 110 111 --&gt;

	&lt;xsl:template name=&quot;createNameFrom100&quot;&gt;
		&lt;mods:name type=&quot;personal&quot;&gt;
			&lt;xsl:attribute name=&quot;usage&quot;&gt;
				&lt;xsl:text&gt;primary&lt;/xsl:text&gt;
			&lt;/xsl:attribute&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:if test=&quot;//marc:datafield[@tag=&#39;240&#39;]&quot;&gt;
				&lt;xsl:attribute name=&quot;nameTitleGroup&quot;&gt;
					&lt;xsl:text&gt;1&lt;/xsl:text&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;nameABCDQ&quot;/&gt;
			&lt;xsl:call-template name=&quot;affiliation&quot;/&gt;
			&lt;xsl:call-template name=&quot;role&quot;/&gt;
		&lt;/mods:name&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNameFrom110&quot;&gt;
		&lt;mods:name type=&quot;corporate&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:if test=&quot;//marc:datafield[@tag=&#39;240&#39;]&quot;&gt;
				&lt;xsl:attribute name=&quot;nameTitleGroup&quot;&gt;
					&lt;xsl:text&gt;1&lt;/xsl:text&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;nameABCDN&quot;/&gt;
			&lt;xsl:call-template name=&quot;role&quot;/&gt;
		&lt;/mods:name&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNameFrom111&quot;&gt;
		&lt;mods:name type=&quot;conference&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:if test=&quot;//marc:datafield[@tag=&#39;240&#39;]&quot;&gt;
				&lt;xsl:attribute name=&quot;nameTitleGroup&quot;&gt;
					&lt;xsl:text&gt;1&lt;/xsl:text&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;nameACDEQ&quot;/&gt;
			&lt;xsl:call-template name=&quot;role&quot;/&gt;
		&lt;/mods:name&gt;
	&lt;/xsl:template&gt;

	&lt;!-- name 700 710 711 720 --&gt;

	&lt;xsl:template name=&quot;createNameFrom700&quot;&gt;
		&lt;mods:name type=&quot;personal&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;nameABCDQ&quot;/&gt;
			&lt;xsl:call-template name=&quot;affiliation&quot;/&gt;
			&lt;xsl:call-template name=&quot;role&quot;/&gt;
		&lt;/mods:name&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNameFrom710&quot;&gt;
		&lt;mods:name type=&quot;corporate&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;nameABCDN&quot;/&gt;
			&lt;xsl:call-template name=&quot;role&quot;/&gt;
		&lt;/mods:name&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNameFrom711&quot;&gt;
		&lt;mods:name type=&quot;conference&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;nameACDEQ&quot;/&gt;
			&lt;xsl:call-template name=&quot;role&quot;/&gt;
		&lt;/mods:name&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNameFrom720&quot;&gt;
		&lt;xsl:if test=&quot;marc:datafield[@tag=&#39;720&#39;][not(marc:subfield[@code=&#39;t&#39;])]&quot;&gt;
			&lt;mods:name&gt;
				&lt;xsl:if test=&quot;@ind1=1&quot;&gt;
					&lt;xsl:attribute name=&quot;type&quot;&gt;
						&lt;xsl:text&gt;personal&lt;/xsl:text&gt;
					&lt;/xsl:attribute&gt;
				&lt;/xsl:if&gt;
				&lt;mods:namePart&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
				&lt;/mods:namePart&gt;
				&lt;xsl:call-template name=&quot;role&quot;/&gt;
			&lt;/mods:name&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;!-- genre 047 655	--&gt;

	&lt;xsl:template name=&quot;createGenreFrom047&quot;&gt;
		&lt;mods:genre authority=&quot;marcgt&quot;&gt;
			&lt;xsl:attribute name=&quot;authority&quot;&gt;
				&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;2&#39;]&quot;/&gt;
			&lt;/xsl:attribute&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;abcdef&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;delimeter&quot;&gt;-&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:genre&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;createGenreFrom655&quot;&gt;
		&lt;mods:genre authority=&quot;marcgt&quot;&gt;
			&lt;xsl:attribute name=&quot;authority&quot;&gt;
				&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;2&#39;]&quot;/&gt;
			&lt;/xsl:attribute&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;abvxyz&lt;/xsl:with-param&gt;
				&lt;xsl:with-param name=&quot;delimeter&quot;&gt;-&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:genre&gt;
	&lt;/xsl:template&gt;

	&lt;!-- tOC 505 --&gt;

	&lt;xsl:template name=&quot;createTOCFrom505&quot;&gt;
		&lt;mods:tableOfContents&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;agrt&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:tableOfContents&gt;
	&lt;/xsl:template&gt;

	&lt;!-- abstract 520 --&gt;

	&lt;xsl:template name=&quot;createAbstractFrom520&quot;&gt;
		&lt;mods:abstract&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;ab&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:abstract&gt;
	&lt;/xsl:template&gt;

	&lt;!-- targetAudience 521 --&gt;

	&lt;xsl:template name=&quot;createTargetAudienceFrom521&quot;&gt;
		&lt;mods:targetAudience&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;ab&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:targetAudience&gt;
	&lt;/xsl:template&gt;

	&lt;!-- note 245c thru 585 --&gt;

	&lt;xsl:template name=&quot;createNoteFrom245c&quot;&gt;
		&lt;xsl:choose&gt;
			&lt;xsl:when
				test=&quot;//marc:datafield[@tag=&#39;245&#39;] and //marc:datafield[@tag=880]/marc:subfield[@code=6][contains(text(),&#39;245&#39;)]&quot;&gt;
				&lt;mods:note type=&quot;statement of responsibility&quot;&gt;
					&lt;xsl:attribute name=&quot;altRepGroup&quot;&gt;
						&lt;xsl:text&gt;00&lt;/xsl:text&gt;
					&lt;/xsl:attribute&gt;
					&lt;xsl:call-template name=&quot;scriptCode&quot;/&gt;
					&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
						&lt;xsl:with-param name=&quot;codes&quot;&gt;c&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:note&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;//marc:datafield[@tag=&#39;245&#39;]/marc:subfield[@code=&#39;c&#39;]&quot;&gt;
				&lt;mods:note type=&quot;statement of responsibility&quot;&gt;
					&lt;xsl:call-template name=&quot;scriptCode&quot;/&gt;
					&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
						&lt;xsl:with-param name=&quot;codes&quot;&gt;c&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:note&gt;
			&lt;/xsl:when&gt;
		&lt;/xsl:choose&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom362&quot;&gt;
		&lt;mods:note type=&quot;date/sequential designation&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom500&quot;&gt;
		&lt;mods:note&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom502&quot;&gt;
		&lt;mods:note type=&quot;thesis&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom504&quot;&gt;
		&lt;mods:note type=&quot;bibliography&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom508&quot;&gt;
		&lt;mods:note type=&quot;creation/production credits&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each
					select=&quot;marc:subfield[@code!=&#39;u&#39; and @code!=&#39;3&#39; and @code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom511&quot;&gt;
		&lt;mods:note type=&quot;performers&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom515&quot;&gt;
		&lt;mods:note type=&quot;numbering&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom518&quot;&gt;
		&lt;mods:note type=&quot;venue&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;3&#39; and @code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom524&quot;&gt;
		&lt;mods:note type=&quot;preferred citation&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom530&quot;&gt;
		&lt;mods:note type=&quot;additional physical form&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each
					select=&quot;marc:subfield[@code!=&#39;u&#39; and @code!=&#39;3&#39; and @code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom533&quot;&gt;
		&lt;mods:note type=&quot;reproduction&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom534&quot;&gt;
		&lt;mods:note type=&quot;original version&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom535&quot;&gt;
		&lt;mods:note type=&quot;original location&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom536&quot;&gt;
		&lt;mods:note type=&quot;funding&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom538&quot;&gt;
		&lt;mods:note type=&quot;system details&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom541&quot;&gt;
		&lt;mods:note type=&quot;acquisition&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom545&quot;&gt;
		&lt;mods:note type=&quot;biographical/historical&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom546&quot;&gt;
		&lt;mods:note type=&quot;language&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom561&quot;&gt;
		&lt;mods:note type=&quot;ownership&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom562&quot;&gt;
		&lt;mods:note type=&quot;version identification&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom581&quot;&gt;
		&lt;mods:note type=&quot;publications&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom583&quot;&gt;
		&lt;mods:note type=&quot;action&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom585&quot;&gt;
		&lt;mods:note type=&quot;exhibitions&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createNoteFrom5XX&quot;&gt;
		&lt;mods:note&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:variable name=&quot;str&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code!=&#39;6&#39; and @code!=&#39;8&#39;]&quot;&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;/xsl:for-each&gt;
			&lt;/xsl:variable&gt;
			&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-1)&quot;/&gt;
		&lt;/mods:note&gt;
	&lt;/xsl:template&gt;

	&lt;!-- subject Geo 034 043 045 255 656 662 752 --&gt;

	&lt;xsl:template name=&quot;createSubGeoFrom034&quot;&gt;
		&lt;xsl:if
			test=&quot;marc:datafield[@tag=034][marc:subfield[@code=&#39;d&#39; or @code=&#39;e&#39; or @code=&#39;f&#39; or @code=&#39;g&#39;]]&quot;&gt;
			&lt;mods:subject&gt;
				&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
				&lt;mods:cartographics&gt;
					&lt;mods:coordinates&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;defg&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:coordinates&gt;
				&lt;/mods:cartographics&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubGeoFrom043&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39; or @code=&#39;b&#39; or @code=&#39;c&#39;]&quot;&gt;
				&lt;mods:geographicCode&gt;
					&lt;xsl:attribute name=&quot;authority&quot;&gt;
						&lt;xsl:if test=&quot;@code=&#39;a&#39;&quot;&gt;
							&lt;xsl:text&gt;marcgac&lt;/xsl:text&gt;
						&lt;/xsl:if&gt;
						&lt;xsl:if test=&quot;@code=&#39;b&#39;&quot;&gt;
							&lt;xsl:value-of select=&quot;following-sibling::marc:subfield[@code=2]&quot;/&gt;
						&lt;/xsl:if&gt;
						&lt;xsl:if test=&quot;@code=&#39;c&#39;&quot;&gt;
							&lt;xsl:text&gt;iso3166&lt;/xsl:text&gt;
						&lt;/xsl:if&gt;
					&lt;/xsl:attribute&gt;
					&lt;xsl:value-of select=&quot;self::marc:subfield&quot;/&gt;
				&lt;/mods:geographicCode&gt;
			&lt;/xsl:for-each&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubGeoFrom255&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39; or @code=&#39;b&#39; or @code=&#39;c&#39;]&quot;&gt;
				&lt;mods:cartographics&gt;
					&lt;xsl:if test=&quot;@code=&#39;a&#39;&quot;&gt;
						&lt;mods:scale&gt;
							&lt;xsl:value-of select=&quot;.&quot;/&gt;
						&lt;/mods:scale&gt;
					&lt;/xsl:if&gt;
					&lt;xsl:if test=&quot;@code=&#39;b&#39;&quot;&gt;
						&lt;mods:projection&gt;
							&lt;xsl:value-of select=&quot;.&quot;/&gt;
						&lt;/mods:projection&gt;
					&lt;/xsl:if&gt;
					&lt;xsl:if test=&quot;@code=&#39;c&#39;&quot;&gt;
						&lt;mods:coordinates&gt;
							&lt;xsl:value-of select=&quot;.&quot;/&gt;
						&lt;/mods:coordinates&gt;
					&lt;/xsl:if&gt;
				&lt;/mods:cartographics&gt;
			&lt;/xsl:for-each&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubNameFrom600&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subjectAuthority&quot;/&gt;
			&lt;mods:name type=&quot;personal&quot;&gt;
				&lt;xsl:call-template name=&quot;termsOfAddress&quot;/&gt;
				&lt;mods:namePart&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot;&gt;
							&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
								&lt;xsl:with-param name=&quot;codes&quot;&gt;aq&lt;/xsl:with-param&gt;
							&lt;/xsl:call-template&gt;
						&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:namePart&gt;
				&lt;xsl:call-template name=&quot;nameDate&quot;/&gt;
				&lt;xsl:call-template name=&quot;affiliation&quot;/&gt;
				&lt;xsl:call-template name=&quot;role&quot;/&gt;
			&lt;/mods:name&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=&#39;t&#39;]&quot;&gt;
				&lt;mods:titleInfo&gt;
					&lt;mods:title&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot;&gt;
								&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
									&lt;xsl:with-param name=&quot;codes&quot;&gt;t&lt;/xsl:with-param&gt;
								&lt;/xsl:call-template&gt;
							&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:title&gt;
					&lt;xsl:call-template name=&quot;part&quot;/&gt;
				&lt;/mods:titleInfo&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;subjectAnyOrder&quot;/&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubNameFrom610&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subjectAuthority&quot;/&gt;
			&lt;mods:name type=&quot;corporate&quot;&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;&gt;
					&lt;mods:namePart&gt;
						&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;/mods:namePart&gt;
				&lt;/xsl:for-each&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;
					&lt;mods:namePart&gt;
						&lt;xsl:value-of select=&quot;.&quot;/&gt;
					&lt;/mods:namePart&gt;
				&lt;/xsl:for-each&gt;
				&lt;xsl:if test=&quot;marc:subfield[@code=&#39;c&#39; or @code=&#39;d&#39; or @code=&#39;n&#39; or @code=&#39;p&#39;]&quot;&gt;
					&lt;mods:namePart&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;cdnp&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:namePart&gt;
				&lt;/xsl:if&gt;
				&lt;xsl:call-template name=&quot;role&quot;/&gt;
			&lt;/mods:name&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=&#39;t&#39;]&quot;&gt;
				&lt;mods:titleInfo&gt;
					&lt;mods:title&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot;&gt;
								&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
									&lt;xsl:with-param name=&quot;codes&quot;&gt;t&lt;/xsl:with-param&gt;
								&lt;/xsl:call-template&gt;
							&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:title&gt;
					&lt;xsl:call-template name=&quot;part&quot;/&gt;
				&lt;/mods:titleInfo&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;subjectAnyOrder&quot;/&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubNameFrom611&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subjectAuthority&quot;/&gt;
			&lt;mods:name type=&quot;conference&quot;&gt;
				&lt;mods:namePart&gt;
					&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
						&lt;xsl:with-param name=&quot;codes&quot;&gt;abcdeqnp&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:namePart&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;4&#39;]&quot;&gt;
					&lt;mods:role&gt;
						&lt;mods:roleTerm authority=&quot;marcrelator&quot; type=&quot;code&quot;&gt;
							&lt;xsl:value-of select=&quot;.&quot;/&gt;
						&lt;/mods:roleTerm&gt;
					&lt;/mods:role&gt;
				&lt;/xsl:for-each&gt;
			&lt;/mods:name&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=&#39;t&#39;]&quot;&gt;
				&lt;mods:titleInfo&gt;
					&lt;mods:title&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot;&gt;
								&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
									&lt;xsl:with-param name=&quot;codes&quot;&gt;tpn&lt;/xsl:with-param&gt;
								&lt;/xsl:call-template&gt;
							&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:title&gt;
					&lt;xsl:call-template name=&quot;part&quot;/&gt;
				&lt;/mods:titleInfo&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;subjectAnyOrder&quot;/&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubTitleFrom630&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subjectAuthority&quot;/&gt;
			&lt;mods:titleInfo&gt;
				&lt;mods:title&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot;&gt;
							&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
								&lt;xsl:with-param name=&quot;codes&quot;&gt;adfhklor&lt;/xsl:with-param&gt;
							&lt;/xsl:call-template&gt;
						&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:title&gt;
				&lt;xsl:call-template name=&quot;part&quot;/&gt;
			&lt;/mods:titleInfo&gt;
			&lt;xsl:call-template name=&quot;subjectAnyOrder&quot;/&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubChronFrom648&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=2]&quot;&gt;
				&lt;xsl:attribute name=&quot;authority&quot;&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=2]&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;uri&quot;/&gt;
			&lt;xsl:call-template name=&quot;subjectAuthority&quot;/&gt;
			&lt;mods:temporal&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;abcd&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:temporal&gt;
			&lt;xsl:call-template name=&quot;subjectAnyOrder&quot;/&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubTopFrom650&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subjectAuthority&quot;/&gt;
			&lt;mods:topic&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
							&lt;xsl:with-param name=&quot;codes&quot;&gt;abcd&lt;/xsl:with-param&gt;
						&lt;/xsl:call-template&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:topic&gt;
			&lt;xsl:call-template name=&quot;subjectAnyOrder&quot;/&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubGeoFrom651&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subjectAuthority&quot;/&gt;
			&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;&gt;
				&lt;mods:geographic&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:geographic&gt;
			&lt;/xsl:for-each&gt;
			&lt;xsl:call-template name=&quot;subjectAnyOrder&quot;/&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubFrom653&quot;&gt;

		&lt;xsl:if test=&quot;@ind2=&#39; &#39;&quot;&gt;
			&lt;mods:subject&gt;
				&lt;mods:topic&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:topic&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;@ind2=&#39;0&#39;&quot;&gt;
			&lt;mods:subject&gt;
				&lt;mods:topic&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:topic&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;

		&lt;xsl:if test=&quot;@ind2=&#39;1&#39;&quot;&gt;
			&lt;mods:subject&gt;
				&lt;mods:name type=&quot;personal&quot;&gt;
				&lt;mods:namePart&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:namePart&gt;
				&lt;/mods:name&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;@ind2=&#39;2&#39;&quot;&gt;
			&lt;mods:subject&gt;
				&lt;mods:name type=&quot;corporate&quot;&gt;
				&lt;mods:namePart&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:namePart&gt;
				&lt;/mods:name&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;@ind2=&#39;3&#39;&quot;&gt;
			&lt;mods:subject&gt;
				&lt;mods:name type=&quot;conference&quot;&gt;
				&lt;mods:namePart&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:namePart&gt;
				&lt;/mods:name&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;@ind2=4&quot;&gt;
			&lt;mods:subject&gt;
				&lt;mods:temporal&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:temporal&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;
		&lt;xsl:if test=&quot;@ind2=5&quot;&gt;
			&lt;mods:subject&gt;
				&lt;mods:geographic&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:geographic&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;

		&lt;xsl:if test=&quot;@ind2=6&quot;&gt;
			&lt;mods:subject&gt;
				&lt;mods:genre&gt;
					&lt;xsl:value-of select=&quot;.&quot;/&gt;
				&lt;/mods:genre&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubFrom656&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=2]&quot;&gt;
				&lt;xsl:attribute name=&quot;authority&quot;&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=2]&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
			&lt;mods:occupation&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot;&gt;
						&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
					&lt;/xsl:with-param&gt;
				&lt;/xsl:call-template&gt;
			&lt;/mods:occupation&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubGeoFrom662752&quot;&gt;
		&lt;mods:subject&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;mods:hierarchicalGeographic&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;&gt;
					&lt;mods:country&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:country&gt;
				&lt;/xsl:for-each&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;
					&lt;mods:state&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:state&gt;
				&lt;/xsl:for-each&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;c&#39;]&quot;&gt;
					&lt;mods:county&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:county&gt;
				&lt;/xsl:for-each&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;d&#39;]&quot;&gt;
					&lt;mods:city&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:city&gt;
				&lt;/xsl:for-each&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;e&#39;]&quot;&gt;
					&lt;mods:citySection&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:citySection&gt;
				&lt;/xsl:for-each&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;g&#39;]&quot;&gt;
					&lt;mods:area&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:area&gt;
				&lt;/xsl:for-each&gt;
				&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;h&#39;]&quot;&gt;
					&lt;mods:extraterrestrialArea&gt;
						&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
							&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;.&quot;/&gt;
						&lt;/xsl:call-template&gt;
					&lt;/mods:extraterrestrialArea&gt;
				&lt;/xsl:for-each&gt;
			&lt;/mods:hierarchicalGeographic&gt;
		&lt;/mods:subject&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createSubTemFrom045&quot;&gt;
		&lt;xsl:if
			test=&quot;//marc:datafield[@tag=045 and @ind1=&#39;2&#39;][marc:subfield[@code=&#39;b&#39; or @code=&#39;c&#39;]]&quot;&gt;
			&lt;mods:subject&gt;
				&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
				&lt;mods:temporal encoding=&quot;iso8601&quot; point=&quot;start&quot;&gt;
					&lt;xsl:call-template name=&quot;dates045b&quot;&gt;
						&lt;xsl:with-param name=&quot;str&quot; select=&quot;marc:subfield[@code=&#39;b&#39; or @code=&#39;c&#39;][1]&quot;
						/&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:temporal&gt;
				&lt;mods:temporal encoding=&quot;iso8601&quot; point=&quot;end&quot;&gt;
					&lt;xsl:call-template name=&quot;dates045b&quot;&gt;
						&lt;xsl:with-param name=&quot;str&quot; select=&quot;marc:subfield[@code=&#39;b&#39; or @code=&#39;c&#39;][2]&quot;
						/&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:temporal&gt;
			&lt;/mods:subject&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;!-- classification 050 060 080 082 084 086 --&gt;

	&lt;xsl:template name=&quot;createClassificationFrom050&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;
			&lt;mods:classification authority=&quot;lcc&quot;&gt;
				&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
				&lt;xsl:if test=&quot;../marc:subfield[@code=&#39;3&#39;]&quot;&gt;
					&lt;xsl:attribute name=&quot;displayLabel&quot;&gt;
						&lt;xsl:value-of select=&quot;../marc:subfield[@code=&#39;3&#39;]&quot;/&gt;
					&lt;/xsl:attribute&gt;
				&lt;/xsl:if&gt;
				&lt;xsl:value-of select=&quot;preceding-sibling::marc:subfield[@code=&#39;a&#39;][1]&quot;/&gt;
				&lt;xsl:text&gt; &lt;/xsl:text&gt;
				&lt;xsl:value-of select=&quot;text()&quot;/&gt;
			&lt;/mods:classification&gt;
		&lt;/xsl:for-each&gt;
		&lt;xsl:for-each
			select=&quot;marc:subfield[@code=&#39;a&#39;][not(following-sibling::marc:subfield[@code=&#39;b&#39;])]&quot;&gt;
			&lt;mods:classification authority=&quot;lcc&quot;&gt;
				&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
				&lt;xsl:if test=&quot;../marc:subfield[@code=&#39;3&#39;]&quot;&gt;
					&lt;xsl:attribute name=&quot;displayLabel&quot;&gt;
						&lt;xsl:value-of select=&quot;../marc:subfield[@code=&#39;3&#39;]&quot;/&gt;
					&lt;/xsl:attribute&gt;
				&lt;/xsl:if&gt;
				&lt;xsl:value-of select=&quot;text()&quot;/&gt;
			&lt;/mods:classification&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;createClassificationFrom060&quot;&gt;
		&lt;mods:classification authority=&quot;nlm&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;ab&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:classification&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;createClassificationFrom080&quot;&gt;
		&lt;mods:classification authority=&quot;udc&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;abx&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:classification&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;createClassificationFrom082&quot;&gt;
		&lt;mods:classification authority=&quot;ddc&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=&#39;2&#39;]&quot;&gt;
				&lt;xsl:attribute name=&quot;edition&quot;&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;2&#39;]&quot;/&gt;
				&lt;/xsl:attribute&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;ab&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:classification&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;createClassificationFrom084&quot;&gt;
		&lt;mods:classification&gt;
			&lt;xsl:attribute name=&quot;authority&quot;&gt;
				&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;2&#39;]&quot;/&gt;
			&lt;/xsl:attribute&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;ab&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:classification&gt;
	&lt;/xsl:template&gt;
	&lt;xsl:template name=&quot;createClassificationFrom086&quot;&gt;
		&lt;xsl:for-each select=&quot;marc:datafield[@tag=086][@ind1=0]&quot;&gt;
			&lt;mods:classification authority=&quot;sudocs&quot;&gt;
				&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
				&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
			&lt;/mods:classification&gt;
		&lt;/xsl:for-each&gt;
		&lt;xsl:for-each select=&quot;marc:datafield[@tag=086][@ind1=1]&quot;&gt;
			&lt;mods:classification authority=&quot;candoc&quot;&gt;
				&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
				&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
			&lt;/mods:classification&gt;
		&lt;/xsl:for-each&gt;
		&lt;xsl:for-each select=&quot;marc:datafield[@tag=086][@ind1!=1 and @ind1!=0]&quot;&gt;
			&lt;mods:classification&gt;
				&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
				&lt;xsl:attribute name=&quot;authority&quot;&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;2&#39;]&quot;/&gt;
				&lt;/xsl:attribute&gt;
				&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;
			&lt;/mods:classification&gt;
		&lt;/xsl:for-each&gt;
	&lt;/xsl:template&gt;

	&lt;!-- identifier 020 024 022 028 010 037 UNDO Nov 23 2010 RG SM--&gt;

	&lt;!-- createRelatedItemFrom490 &lt;xsl:for-each select=&quot;marc:datafield[@tag=490][@ind1=0]&quot;&gt; --&gt;

	&lt;xsl:template name=&quot;createRelatedItemFrom490&quot;&gt;
		&lt;mods:relatedItem type=&quot;series&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;mods:titleInfo&gt;
				&lt;mods:title&gt;
					&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
						&lt;xsl:with-param name=&quot;chopString&quot;&gt;
							&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
								&lt;xsl:with-param name=&quot;codes&quot;&gt;av&lt;/xsl:with-param&gt;
							&lt;/xsl:call-template&gt;
						&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:title&gt;
				&lt;xsl:call-template name=&quot;part&quot;/&gt;
			&lt;/mods:titleInfo&gt;
		&lt;/mods:relatedItem&gt;
	&lt;/xsl:template&gt;


	&lt;!-- location 852 856 --&gt;

	&lt;xsl:template name=&quot;createLocationFrom852&quot;&gt;		
			&lt;xsl:if test=&quot;marc:subfield[@code=&#39;a&#39; or @code=&#39;b&#39; or @code=&#39;e&#39;]&quot;&gt;
				&lt;mods:physicalLocation&gt;
					&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
						&lt;xsl:with-param name=&quot;codes&quot;&gt;abe&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:physicalLocation&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:if test=&quot;marc:subfield[@code=&#39;u&#39;]&quot;&gt;
				&lt;mods:physicalLocation&gt;
					&lt;xsl:call-template name=&quot;uri&quot;/&gt;
					&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
						&lt;xsl:with-param name=&quot;codes&quot;&gt;u&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:physicalLocation&gt;
			&lt;/xsl:if&gt;
			&lt;xsl:if
				test=&quot;marc:subfield[@code=&#39;h&#39; or @code=&#39;i&#39; or @code=&#39;j&#39; or @code=&#39;k&#39; or @code=&#39;l&#39; or @code=&#39;m&#39; or @code=&#39;t&#39;]&quot;&gt;
				&lt;mods:shelfLocator&gt;
					&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
						&lt;xsl:with-param name=&quot;codes&quot;&gt;hijklmt&lt;/xsl:with-param&gt;
					&lt;/xsl:call-template&gt;
				&lt;/mods:shelfLocator&gt;
			&lt;/xsl:if&gt;		
	&lt;/xsl:template&gt;
	
	&lt;xsl:template name=&quot;createLocationFrom910&quot;&gt;      
         &lt;xsl:if test=&quot;marc:subfield[@code=&#39;a&#39;]&quot;&gt;
            &lt;mods:physicalLocation authority=&quot;siglaADR&quot;&gt;
              &lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
                 &lt;xsl:with-param name=&quot;codes&quot;&gt;a&lt;/xsl:with-param&gt;
              &lt;/xsl:call-template&gt;           
          &lt;/mods:physicalLocation&gt;
         &lt;/xsl:if&gt;
   	   &lt;xsl:if test=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt; 
              &lt;xsl:call-template name=&quot;createShelfLocatorsFor910&quot;&gt;
                 &lt;xsl:with-param name=&quot;list&quot;&gt;&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;b&#39;]&quot; /&gt;&lt;/xsl:with-param&gt;
                 &lt;xsl:with-param name=&quot;delimiter&quot;&gt;,&lt;/xsl:with-param&gt;
              &lt;/xsl:call-template&gt;           
       &lt;/xsl:if&gt;                  
   &lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createLocationFrom856&quot;&gt;
		&lt;xsl:if test=&quot;//marc:datafield[@tag=856][@ind2!=2][marc:subfield[@code=&#39;u&#39;]]&quot;&gt;			
				&lt;mods:url displayLabel=&quot;electronic resource&quot;&gt;
					&lt;!-- 1.41 tmee AQ1.9 added choice protocol for @usage=&quot;primary display&quot; --&gt;
					&lt;xsl:variable name=&quot;primary&quot;&gt;
						&lt;xsl:choose&gt;
							&lt;xsl:when
								test=&quot;@ind2=0 and count(preceding-sibling::marc:datafield[@tag=856] [@ind2=0])=0&quot;
								&gt;true&lt;/xsl:when&gt;

							&lt;xsl:when
								test=&quot;@ind2=1 and 
							count(ancestor::marc:record//marc:datafield[@tag=856][@ind2=0])=0 and 
							count(preceding-sibling::marc:datafield[@tag=856][@ind2=1])=0&quot;
								&gt;true&lt;/xsl:when&gt;

							&lt;xsl:when
								test=&quot;@ind2!=1 and @ind2!=0 and 
							@ind2!=2 and count(ancestor::marc:record//marc:datafield[@tag=856 and 
							@ind2=0])=0 and count(ancestor::marc:record//marc:datafield[@tag=856 and 
							@ind2=1])=0 and 
							count(preceding-sibling::marc:datafield[@tag=856][@ind2])=0&quot;
								&gt;true&lt;/xsl:when&gt;
							&lt;xsl:otherwise&gt;false&lt;/xsl:otherwise&gt;
						&lt;/xsl:choose&gt;
					&lt;/xsl:variable&gt;
					&lt;xsl:if test=&quot;$primary=&#39;true&#39;&quot;&gt;
						&lt;xsl:attribute name=&quot;usage&quot;&gt;primary display&lt;/xsl:attribute&gt;
					&lt;/xsl:if&gt;

					&lt;xsl:if test=&quot;marc:subfield[@code=&#39;y&#39; or @code=&#39;3&#39;]&quot;&gt;
						&lt;xsl:attribute name=&quot;displayLabel&quot;&gt;
							&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
								&lt;xsl:with-param name=&quot;codes&quot;&gt;y3&lt;/xsl:with-param&gt;
							&lt;/xsl:call-template&gt;
						&lt;/xsl:attribute&gt;
					&lt;/xsl:if&gt;
					&lt;xsl:if test=&quot;marc:subfield[@code=&#39;z&#39;]&quot;&gt;
						&lt;xsl:attribute name=&quot;note&quot;&gt;
							&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
								&lt;xsl:with-param name=&quot;codes&quot;&gt;z&lt;/xsl:with-param&gt;
							&lt;/xsl:call-template&gt;
						&lt;/xsl:attribute&gt;
					&lt;/xsl:if&gt;
					&lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;u&#39;]&quot;/&gt;
				&lt;/mods:url&gt;			
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;
    
	&lt;!-- accessCondition 506 540 --&gt;

	&lt;xsl:template name=&quot;createAccessConditionFrom506&quot;&gt;
		&lt;mods:accessCondition type=&quot;restrictionOnAccess&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;abcd35&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:accessCondition&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createAccessConditionFrom540&quot;&gt;
		&lt;mods:accessCondition type=&quot;useAndReproduction&quot;&gt;
			&lt;xsl:call-template name=&quot;xxx880&quot;/&gt;
			&lt;xsl:call-template name=&quot;subfieldSelect&quot;&gt;
				&lt;xsl:with-param name=&quot;codes&quot;&gt;abcde35&lt;/xsl:with-param&gt;
			&lt;/xsl:call-template&gt;
		&lt;/mods:accessCondition&gt;
	&lt;/xsl:template&gt; 
  
	&lt;!-- recordInfo 040 005 001 003 --&gt;

	&lt;!-- 880 global copy template --&gt;
	&lt;xsl:template match=&quot;* | @*&quot; mode=&quot;global_copy&quot;&gt;
		&lt;xsl:copy&gt;
			&lt;xsl:apply-templates select=&quot;* | @* | text()&quot; mode=&quot;global_copy&quot;/&gt;
		&lt;/xsl:copy&gt;
	&lt;/xsl:template&gt;


  	&lt;xsl:variable name=&quot;ascii&quot;&gt;
		&lt;xsl:text&gt; !&quot;#$%&amp;amp;&#39;()*+,-./0123456789:;&amp;lt;=&amp;gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~&lt;/xsl:text&gt;
	&lt;/xsl:variable&gt;

	&lt;xsl:variable name=&quot;latin1&quot;&gt;
		&lt;xsl:text&gt; ¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿ&lt;/xsl:text&gt;
	&lt;/xsl:variable&gt;
	&lt;!-- Characters that usually don&#39;t need to be escaped --&gt;
	&lt;xsl:variable name=&quot;safe&quot;&gt;
		&lt;xsl:text&gt;!&#39;()*-.0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~&lt;/xsl:text&gt;
	&lt;/xsl:variable&gt;

	&lt;xsl:variable name=&quot;hex&quot;&gt;0123456789ABCDEF&lt;/xsl:variable&gt;


	&lt;xsl:template name=&quot;datafield&quot;&gt;
		&lt;xsl:param name=&quot;tag&quot;/&gt;
		&lt;xsl:param name=&quot;ind1&quot;&gt;
			&lt;xsl:text&gt; &lt;/xsl:text&gt;
		&lt;/xsl:param&gt;
		&lt;xsl:param name=&quot;ind2&quot;&gt;
			&lt;xsl:text&gt; &lt;/xsl:text&gt;
		&lt;/xsl:param&gt;
		&lt;xsl:param name=&quot;subfields&quot;/&gt;
		&lt;xsl:element name=&quot;marc:datafield&quot;&gt;
			&lt;xsl:attribute name=&quot;tag&quot;&gt;
				&lt;xsl:value-of select=&quot;$tag&quot;/&gt;
			&lt;/xsl:attribute&gt;
			&lt;xsl:attribute name=&quot;ind1&quot;&gt;
				&lt;xsl:value-of select=&quot;$ind1&quot;/&gt;
			&lt;/xsl:attribute&gt;
			&lt;xsl:attribute name=&quot;ind2&quot;&gt;
				&lt;xsl:value-of select=&quot;$ind2&quot;/&gt;
			&lt;/xsl:attribute&gt;
			&lt;xsl:copy-of select=&quot;$subfields&quot;/&gt;
		&lt;/xsl:element&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;subfieldSelect&quot;&gt;
		&lt;xsl:param name=&quot;codes&quot;&gt;abcdefghijklmnopqrstuvwxyz&lt;/xsl:param&gt;
		&lt;xsl:param name=&quot;delimeter&quot;&gt;
			&lt;xsl:text&gt; &lt;/xsl:text&gt;
		&lt;/xsl:param&gt;
		&lt;xsl:variable name=&quot;str&quot;&gt;
			&lt;xsl:for-each select=&quot;marc:subfield&quot;&gt;
				&lt;xsl:if test=&quot;contains($codes, @code)&quot;&gt;
					&lt;xsl:value-of select=&quot;text()&quot;/&gt;
					&lt;xsl:value-of select=&quot;$delimeter&quot;/&gt;
				&lt;/xsl:if&gt;
			&lt;/xsl:for-each&gt;
		&lt;/xsl:variable&gt;
		&lt;xsl:value-of select=&quot;substring($str,1,string-length($str)-string-length($delimeter))&quot;/&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;createShelfLocatorsFor910&quot;&gt;
		&lt;xsl:param name=&quot;list&quot; /&gt;
		&lt;xsl:param name=&quot;delimiter&quot; /&gt;
		&lt;xsl:variable name=&quot;newlist&quot;&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;contains($list, $delimiter)&quot;&gt;&lt;xsl:value-of select=&quot;normalize-space($list)&quot; /&gt;&lt;/xsl:when&gt;
				&lt;xsl:otherwise&gt;&lt;xsl:value-of select=&quot;concat(normalize-space($list), $delimiter)&quot;/&gt;&lt;/xsl:otherwise&gt;
			&lt;/xsl:choose&gt;
     &lt;/xsl:variable&gt;
       &lt;xsl:variable name=&quot;first&quot; select=&quot;substring-before($newlist, $delimiter)&quot; /&gt;
       &lt;xsl:variable name=&quot;remaining&quot; select=&quot;substring-after($newlist, $delimiter)&quot; /&gt;
       &lt;mods:shelfLocator&gt;       
       &lt;xsl:value-of select=&quot;$first&quot; /&gt;
       &lt;/mods:shelfLocator&gt;
       &lt;xsl:if test=&quot;$remaining&quot;&gt;
           &lt;xsl:call-template name=&quot;createShelfLocatorsFor910&quot;&gt;
               &lt;xsl:with-param name=&quot;list&quot; select=&quot;$remaining&quot; /&gt;
         		&lt;xsl:with-param name=&quot;delimiter&quot;&gt;&lt;xsl:value-of select=&quot;$delimiter&quot;/&gt;&lt;/xsl:with-param&gt;
           &lt;/xsl:call-template&gt;
       &lt;/xsl:if&gt;
   &lt;/xsl:template&gt;
   
	&lt;xsl:template name=&quot;buildSpaces&quot;&gt;
		&lt;xsl:param name=&quot;spaces&quot;/&gt;
		&lt;xsl:param name=&quot;char&quot;&gt;
			&lt;xsl:text&gt; &lt;/xsl:text&gt;
		&lt;/xsl:param&gt;
		&lt;xsl:if test=&quot;$spaces&amp;gt;0&quot;&gt;
			&lt;xsl:value-of select=&quot;$char&quot;/&gt;
			&lt;xsl:call-template name=&quot;buildSpaces&quot;&gt;
				&lt;xsl:with-param name=&quot;spaces&quot; select=&quot;$spaces - 1&quot;/&gt;
				&lt;xsl:with-param name=&quot;char&quot; select=&quot;$char&quot;/&gt;
			&lt;/xsl:call-template&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;chopPunctuation&quot;&gt;
		&lt;xsl:param name=&quot;chopString&quot;/&gt;
		&lt;xsl:param name=&quot;punctuation&quot;&gt;
			&lt;xsl:text&gt;.:,;/ &lt;/xsl:text&gt;
		&lt;/xsl:param&gt;
		&lt;xsl:variable name=&quot;length&quot; select=&quot;string-length($chopString)&quot;/&gt;
		&lt;xsl:choose&gt;
			&lt;xsl:when test=&quot;$length=0&quot;/&gt;
			&lt;xsl:when test=&quot;contains($punctuation, substring($chopString,$length,1))&quot;&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;substring($chopString,1,$length - 1)&quot;/&gt;
					&lt;xsl:with-param name=&quot;punctuation&quot; select=&quot;$punctuation&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;not($chopString)&quot;/&gt;
			&lt;xsl:otherwise&gt;
				&lt;xsl:value-of select=&quot;$chopString&quot;/&gt;
			&lt;/xsl:otherwise&gt;
		&lt;/xsl:choose&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;chopPunctuationFront&quot;&gt;
		&lt;xsl:param name=&quot;chopString&quot;/&gt;
		&lt;xsl:variable name=&quot;length&quot; select=&quot;string-length($chopString)&quot;/&gt;
		&lt;xsl:choose&gt;
			&lt;xsl:when test=&quot;$length=0&quot;/&gt;
			&lt;xsl:when test=&quot;contains(&#39;.:,;/[ &#39;, substring($chopString,1,1))&quot;&gt;
				&lt;xsl:call-template name=&quot;chopPunctuationFront&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;substring($chopString,2,$length - 1)&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;not($chopString)&quot;/&gt;
			&lt;xsl:otherwise&gt;
				&lt;xsl:value-of select=&quot;$chopString&quot;/&gt;
			&lt;/xsl:otherwise&gt;
		&lt;/xsl:choose&gt;
	&lt;/xsl:template&gt;

	&lt;xsl:template name=&quot;chopPunctuationBack&quot;&gt;
		&lt;xsl:param name=&quot;chopString&quot;/&gt;
		&lt;xsl:param name=&quot;punctuation&quot;&gt;
			&lt;xsl:text&gt;.:,;/] &lt;/xsl:text&gt;
		&lt;/xsl:param&gt;
		&lt;xsl:variable name=&quot;length&quot; select=&quot;string-length($chopString)&quot;/&gt;
		&lt;xsl:choose&gt;
			&lt;xsl:when test=&quot;$length=0&quot;/&gt;
			&lt;xsl:when test=&quot;contains($punctuation, substring($chopString,$length,1))&quot;&gt;
				&lt;xsl:call-template name=&quot;chopPunctuation&quot;&gt;
					&lt;xsl:with-param name=&quot;chopString&quot; select=&quot;substring($chopString,1,$length - 1)&quot;/&gt;
					&lt;xsl:with-param name=&quot;punctuation&quot; select=&quot;$punctuation&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/xsl:when&gt;
			&lt;xsl:when test=&quot;not($chopString)&quot;/&gt;
			&lt;xsl:otherwise&gt;
				&lt;xsl:value-of select=&quot;$chopString&quot;/&gt;
			&lt;/xsl:otherwise&gt;
		&lt;/xsl:choose&gt;
	&lt;/xsl:template&gt;

	&lt;!-- nate added 12/14/2007 for lccn.loc.gov: url encode ampersand, etc. --&gt;
	&lt;xsl:template name=&quot;url-encode&quot;&gt;

		&lt;xsl:param name=&quot;str&quot;/&gt;

		&lt;xsl:if test=&quot;$str&quot;&gt;
			&lt;xsl:variable name=&quot;first-char&quot; select=&quot;substring($str,1,1)&quot;/&gt;
			&lt;xsl:choose&gt;
				&lt;xsl:when test=&quot;contains($safe,$first-char)&quot;&gt;
					&lt;xsl:value-of select=&quot;$first-char&quot;/&gt;
				&lt;/xsl:when&gt;
				&lt;xsl:otherwise&gt;
					&lt;xsl:variable name=&quot;codepoint&quot;&gt;
						&lt;xsl:choose&gt;
							&lt;xsl:when test=&quot;contains($ascii,$first-char)&quot;&gt;
								&lt;xsl:value-of select=&quot;string-length(substring-before($ascii,$first-char)) + 32&quot;/&gt;
							&lt;/xsl:when&gt;
							&lt;xsl:when test=&quot;contains($latin1,$first-char)&quot;&gt;
								&lt;xsl:value-of select=&quot;string-length(substring-before($latin1,$first-char)) + 160&quot;/&gt;
								&lt;!-- was 160 --&gt;
							&lt;/xsl:when&gt;
							&lt;xsl:otherwise&gt;
								&lt;xsl:message terminate=&quot;no&quot;&gt;Warning: string contains a character
									that is out of range! Substituting &quot;?&quot;.&lt;/xsl:message&gt;
								&lt;xsl:text&gt;63&lt;/xsl:text&gt;
							&lt;/xsl:otherwise&gt;
						&lt;/xsl:choose&gt;
					&lt;/xsl:variable&gt;
					&lt;xsl:variable name=&quot;hex-digit1&quot; select=&quot;substring($hex,floor($codepoint div 16) + 1,1)&quot;/&gt;
					&lt;xsl:variable name=&quot;hex-digit2&quot; select=&quot;substring($hex,$codepoint mod 16 + 1,1)&quot;/&gt;
					&lt;!-- &lt;xsl:value-of select=&quot;concat(&#39;%&#39;,$hex-digit2)&quot;/&gt; --&gt;
					&lt;xsl:value-of select=&quot;concat(&#39;%&#39;,$hex-digit1,$hex-digit2)&quot;/&gt;
				&lt;/xsl:otherwise&gt;
			&lt;/xsl:choose&gt;
			&lt;xsl:if test=&quot;string-length($str) &amp;gt; 1&quot;&gt;
				&lt;xsl:call-template name=&quot;url-encode&quot;&gt;
					&lt;xsl:with-param name=&quot;str&quot; select=&quot;substring($str,2)&quot;/&gt;
				&lt;/xsl:call-template&gt;
			&lt;/xsl:if&gt;
		&lt;/xsl:if&gt;
	&lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="MARC21slim2MODS3-4-NDK.html"
                        title="previous chapter">MARC21slim2MODS3-4-NDK.xsl</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="MARC21toPeriodicalTitle.html"
                        title="next chapter">MARC21toPeriodicalTitle.xsl</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/api/xslt/MARC21toMultiMonographTitle.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="MARC21toPeriodicalTitle.html" title="MARC21toPeriodicalTitle.xsl"
             >next</a> |</li>
        <li class="right" >
          <a href="MARC21slim2MODS3-4-NDK.html" title="MARC21slim2MODS3-4-NDK.xsl"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">marcxml2mods 0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015 E-deposit team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>