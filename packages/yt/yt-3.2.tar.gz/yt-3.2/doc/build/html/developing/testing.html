<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Testing &mdash; The yt Project 3.2-dev documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.4/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.2-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="The yt Project 3.2-dev documentation" href="../index.html" />
    <link rel="up" title="Developing in yt" href="index.html" />
    <link rel="next" title="Debugging yt" href="debugdrive.html" />
    <link rel="prev" title="Documentation" href="building_the_docs.html" />
    
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-391373-2']);
      _gaq.push(['_setDomainName', 'yt-project.org']);
      _gaq.push(['_setAllowHash', false]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/yt_icon.png">
          The yt Project</a>
        <span class="navbar-text navbar-version pull-left"><b>3.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../help/index.html">How to get help</a></li>
                <li><a href="../quickstart/index.html">Quickstart notebooks</a></li>
                <li><a href="../cookbook/index.html">Cookbook</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Getting and Installing yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#getting-yt">Getting yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#testing-your-installation">Testing Your Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#switching-between-yt-2-x-and-yt-3-x">Switching between yt-2.x and yt-3.x</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">yt Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/data_inspection.html">Data Inspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/simple_visualization.html">Simple Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/data_objects_and_time_series.html">Data Objects and Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/derived_fields_and_profiles.html">Derived Fields and Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/volume_rendering.html">Volume Rendering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../yt3differences.html">What&#8217;s New and Different in yt 3.0?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#updating-to-yt-3-0-from-old-versions-and-going-back">Updating to yt 3.0 from Old Versions (and going back)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#converting-old-scripts-to-work-with-yt-3-0">Converting Old Scripts to Work with yt 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#cool-new-things">Cool New Things</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#api-changes">API Changes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/index.html">The Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/index.html#getting-the-sample-data">Getting the Sample Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/index.html#example-scripts">Example Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/index.html#example-notebooks">Example Notebooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visualizing/index.html">Visualizing Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/plots.html">How to Make Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/callbacks.html">Plot Modifications: Overplotting Contours, Velocities, Particles, and More</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/manual_plotting.html">Using the Manual Plotting Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/volume_rendering.html">Volume Rendering: Making 3D Photorealistic Isocontoured Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/hardware_volume_rendering.html">Hardware Volume Rendering on NVidia Graphics cards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/sketchfab.html">3D Surfaces and Sketchfab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/mapserver.html">Mapserver - A Google-Maps-like Interface to your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/streamlines.html">Streamlines: Tracking the Trajectories of Tracers in your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/colormaps/index.html">Colormaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/writing_fits_images.html">Writing FITS Images</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing/index.html">General Data Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/fields.html">Fields in yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/objects.html">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/units/index.html">Symbolic Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/filtering.html">Filtering your Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/generating_processed_data.html">Generating Processed Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/time_series_analysis.html">Time Series Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/parallel_computation.html">Parallel Computation With yt</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing/analysis_modules/index.html">Topic-Specific Analysis Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/halo_analysis.html">Halo Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/synthetic_observation.html">Synthetic Observation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/exporting.html">Exporting to External Radiation Transport Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/two_point_functions.html">Two Point Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/clump_finding.html">Clump Finding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/particle_trajectories.html">Particle Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/ellipsoid_analysis.html">Halo Ellipsoid Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examining/index.html">Loading and Examining Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examining/loading_data.html">Loading Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/generic_array_data.html">Loading Generic Array Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/generic_particle_data.html">Loading Generic Particle Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/spherical_data.html">Loading Spherical Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/low_level_inspection.html">Low-Level Data Inspection: Accessing Raw Data</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developing in yt</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Getting Involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing.html">How to Develop yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_the_docs.html">Documentation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugdrive.html">Debugging yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating_datatypes.html">Creating Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating_derived_quantities.html">Creating Derived Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating_frontend.html">Creating A New Code Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_analysis.html">Using yt with External Analysis Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Materials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/code_support.html">Code Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/command-line.html">Command-Line Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/api/api.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration.html">Customizing yt: The Configuration and Plugin Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/field_list.html">Field List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/changelog.html">ChangeLog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#version-installation">Version &amp; Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#code-errors-and-failures">Code Errors and Failures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#units">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#fields">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#data-objects">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#developing">Developing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">Getting Help</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#don-t-panic-and-don-t-give-up">Don&#8217;t panic and don&#8217;t give up</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#update-to-the-latest-version">Update to the latest version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#search-the-documentation-faq-and-mailing-lists">Search the documentation, FAQ, and mailing lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#look-at-the-source-code">Look at the source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#isolate-and-document-your-problem">Isolate and document your problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#go-on-irc-to-ask-a-question">Go on IRC to ask a question</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#ask-the-mailing-list">Ask the mailing list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#submit-a-bug-report">Submit a bug report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#special-issues">Special Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#what-is-yt">What is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#who-is-yt">Who is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#history-of-yt">History of yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#how-do-i-contact-yt">How do I contact yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#how-do-i-cite-yt">How do I cite yt?</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#unit-testing">Unit Testing</a><ul>
<li><a class="reference internal" href="#what-do-unit-tests-do">What do Unit Tests Do</a></li>
<li><a class="reference internal" href="#how-to-run-the-unit-tests">How to Run the Unit Tests</a></li>
<li><a class="reference internal" href="#how-to-write-unit-tests">How to Write Unit Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#answer-testing">Answer Testing</a><ul>
<li><a class="reference internal" href="#what-do-answer-tests-do">What do Answer Tests Do</a></li>
<li><a class="reference internal" href="#how-to-run-the-answer-tests">How to Run the Answer Tests</a></li>
<li><a class="reference internal" href="#how-to-write-answer-tests">How to Write Answer Tests</a></li>
<li><a class="reference internal" href="#how-to-add-data-to-the-testing-suite">How to Add Data to the Testing Suite</a></li>
<li><a class="reference internal" href="#how-to-upload-answers">How to Upload Answers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="testing">
<span id="id1"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>yt includes a testing suite which one can run on the codebase to assure that no
breaks in functionality have occurred.  This testing suite is based on the <a class="reference external" href="http://nose.readthedocs.org/en/latest/">Nose</a>
testing framework.  The suite consists of two components, unit tests and answer
tests. Unit tests confirm that an isolated piece of functionality runs without
failure for inputs with known correct outputs.  Answer tests verify the
integration and compatibility of the individual code unit by generating output
from user-visible yt functions and comparing and matching the results against
outputs of the same function produced using older versions of the yt codebase.
This ensures consistency in results as development proceeds.</p>
<p id="nosetests">The testing suite should be run locally by developers to make sure they aren&#8217;t
checking in any code that breaks existing functionality.  To further this goal,
an automatic buildbot runs the test suite after each code commit to confirm
that yt hasn&#8217;t broken recently.  To supplement this effort, we also maintain a
<a class="reference external" href="http://tests.yt-project.org">continuous integration server</a> that runs the
tests with each commit to the yt version control repository.</p>
<div class="section" id="unit-testing">
<span id="id2"></span><h2>Unit Testing<a class="headerlink" href="#unit-testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-do-unit-tests-do">
<h3>What do Unit Tests Do<a class="headerlink" href="#what-do-unit-tests-do" title="Permalink to this headline">¶</a></h3>
<p>Unit tests are tests that operate on some small set of machinery, and verify
that the machinery works.  yt uses the <a class="reference external" href="http://nose.readthedocs.org/en/latest/">Nose</a> framework for running unit tests.
In practice, what this means is that we write scripts that <code class="docutils literal"><span class="pre">yield</span></code>
assertions, and Nose identifies those scripts, runs them, and verifies that the
assertions are true.</p>
</div>
<div class="section" id="how-to-run-the-unit-tests">
<h3>How to Run the Unit Tests<a class="headerlink" href="#how-to-run-the-unit-tests" title="Permalink to this headline">¶</a></h3>
<p>One can run the unit tests very straightforwardly from any python interpreter
that can import the yt module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="n">yt</span><span class="o">.</span><span class="n">run_nose</span><span class="p">()</span>
</pre></div>
</div>
<p>If you are developing new functionality, it is sometimes more convenient to use
the Nose command line interface, <code class="docutils literal"><span class="pre">nosetests</span></code>. You can run the unit tests
using <code class="docutils literal"><span class="pre">nose</span></code> by navigating to the base directory of the yt mercurial
repository and invoking <code class="docutils literal"><span class="pre">nosetests</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$YT_HG</span>
<span class="nv">$ </span>nosetests
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">$YT_HG</span></code> is the path to the root of the yt mercurial repository.</p>
<p>If you want to specify a specific unit test to run (and not run the entire
suite), you can do so by specifying the path of the test relative to the
<code class="docutils literal"><span class="pre">$YT_HG/yt</span></code> directory &#8211; note that you strip off one yt more than you
normally would!  For example, if you want to run the plot_window tests, you&#8217;d
run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>nosetests visualization/tests/test_plotwindow.py
</pre></div>
</div>
</div>
<div class="section" id="how-to-write-unit-tests">
<h3>How to Write Unit Tests<a class="headerlink" href="#how-to-write-unit-tests" title="Permalink to this headline">¶</a></h3>
<p>yt provides several pieces of testing assistance, all in the <code class="docutils literal"><span class="pre">yt.testing</span></code>
module.  Describing them in detail is somewhat outside the scope of this
document, as in some cases they belong to other packages.  However, a few come
in handy:</p>
<ul class="simple">
<li><a class="reference internal" href="../reference/api/generated/yt.testing.fake_random_ds.html#yt.testing.fake_random_ds" title="yt.testing.fake_random_ds"><code class="xref py py-func docutils literal"><span class="pre">fake_random_ds()</span></code></a> provides the ability to create a random
dataset, with several fields and divided into several different
grids, that can be operated on.</li>
<li><a class="reference internal" href="../reference/api/generated/yt.testing.assert_equal.html#yt.testing.assert_equal" title="yt.testing.assert_equal"><code class="xref py py-func docutils literal"><span class="pre">assert_equal()</span></code></a> can operate on arrays.</li>
<li><a class="reference internal" href="../reference/api/generated/yt.testing.assert_almost_equal.html#yt.testing.assert_almost_equal" title="yt.testing.assert_almost_equal"><code class="xref py py-func docutils literal"><span class="pre">assert_almost_equal()</span></code></a> can operate on arrays and accepts a
relative allowable difference.</li>
<li><a class="reference internal" href="../reference/api/generated/yt.testing.amrspace.html#yt.testing.amrspace" title="yt.testing.amrspace"><code class="xref py py-func docutils literal"><span class="pre">amrspace()</span></code></a> provides the ability to create AMR grid
structures.</li>
<li><a class="reference internal" href="../reference/api/generated/yt.testing.expand_keywords.html#yt.testing.expand_keywords" title="yt.testing.expand_keywords"><code class="xref py py-func docutils literal"><span class="pre">expand_keywords()</span></code></a> provides the ability to iterate over
many values for keywords.</li>
</ul>
<p>To create new unit tests:</p>
<ol class="arabic simple">
<li>Create a new <code class="docutils literal"><span class="pre">tests/</span></code> directory next to the file containing the
functionality you want to test.  Be sure to add this new directory as a
subpackage in the setup.py script located in the directory you&#8217;re adding a
new <code class="docutils literal"><span class="pre">tests/</span></code> folder to.  This ensures that the tests will be deployed in
yt source and binary distributions.</li>
<li>Inside that directory, create a new python file prefixed with <code class="docutils literal"><span class="pre">test_</span></code> and
including the name of the functionality.</li>
<li>Inside that file, create one or more routines prefixed with <code class="docutils literal"><span class="pre">test_</span></code> that
accept no arguments.  These should <code class="docutils literal"><span class="pre">yield</span></code> a set of values of the form
<code class="docutils literal"><span class="pre">function</span></code>, <code class="docutils literal"><span class="pre">arguments</span></code>.  For example <code class="docutils literal"><span class="pre">yield</span> <span class="pre">assert_equal,</span> <span class="pre">1.0,</span> <span class="pre">1.0</span></code>
would evaluate that 1.0 equaled 1.0.</li>
<li>Use <code class="docutils literal"><span class="pre">fake_random_ds</span></code> to test on datasets, and be sure to test for
several combinations of <code class="docutils literal"><span class="pre">nproc</span></code>, so that domain decomposition can be
tested as well.</li>
<li>Test multiple combinations of options by using the
<a class="reference internal" href="../reference/api/generated/yt.testing.expand_keywords.html#yt.testing.expand_keywords" title="yt.testing.expand_keywords"><code class="xref py py-func docutils literal"><span class="pre">expand_keywords()</span></code></a> function, which will enable much
easier iteration over options.</li>
</ol>
<p>For an example of how to write unit tests, look at the file
<code class="docutils literal"><span class="pre">yt/data_objects/tests/test_covering_grid.py</span></code>, which covers a great deal of
functionality.</p>
</div>
</div>
<div class="section" id="answer-testing">
<span id="id3"></span><h2>Answer Testing<a class="headerlink" href="#answer-testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-do-answer-tests-do">
<h3>What do Answer Tests Do<a class="headerlink" href="#what-do-answer-tests-do" title="Permalink to this headline">¶</a></h3>
<p>Answer tests test <strong>actual data</strong>, and many operations on that data, to make
sure that answers don&#8217;t drift over time.  This is how we will be testing
frontends, as opposed to operations, in yt.</p>
</div>
<div class="section" id="how-to-run-the-answer-tests">
<span id="run-answer-testing"></span><h3>How to Run the Answer Tests<a class="headerlink" href="#how-to-run-the-answer-tests" title="Permalink to this headline">¶</a></h3>
<p>The very first step is to make a directory and copy over the data against which
you want to test.  Currently, we test:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">DD0010/moving7_0010</span></code> (available in <code class="docutils literal"><span class="pre">tests/</span></code> in the yt distribution)</li>
<li><code class="docutils literal"><span class="pre">IsolatedGalaxy/galaxy0030/galaxy0030</span></code></li>
<li><code class="docutils literal"><span class="pre">WindTunnel/windtunnel_4lev_hdf5_plt_cnt_0030</span></code></li>
<li><code class="docutils literal"><span class="pre">GasSloshingLowRes/sloshing_low_res_hdf5_plt_cnt_0300</span></code></li>
<li><code class="docutils literal"><span class="pre">TurbBoxLowRes/data.0005.3d.hdf5</span></code></li>
<li><code class="docutils literal"><span class="pre">GaussianCloud/data.0077.3d.hdf5</span></code></li>
<li><code class="docutils literal"><span class="pre">RadAdvect/plt00000</span></code></li>
<li><code class="docutils literal"><span class="pre">RadTube/plt00500</span></code></li>
</ul>
<p>These datasets are available at <a class="reference external" href="http://yt-project.org/data/">http://yt-project.org/data/</a>.</p>
<p>Next, modify the file <code class="docutils literal"><span class="pre">~/.yt/config</span></code> to include a section <code class="docutils literal"><span class="pre">[yt]</span></code>
with the parameter <code class="docutils literal"><span class="pre">test_data_dir</span></code>.  Set this to point to the
directory with the test data you want to compare.  Here is an example
config file:</p>
<div class="highlight-none"><div class="highlight"><pre>[yt]
test_data_dir = /Users/tomservo/src/yt-data
</pre></div>
</div>
<p>More data will be added over time.  To run the tests, you can import the yt
module and invoke <code class="docutils literal"><span class="pre">yt.run_nose()</span></code> with a new keyword argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="n">yt</span><span class="o">.</span><span class="n">run_nose</span><span class="p">(</span><span class="n">run_answer_tests</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have installed yt using <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">develop</span></code> you can also
optionally invoke nose using the <code class="docutils literal"><span class="pre">nosetests</span></code> command line interface:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$YT_HG</span>
<span class="nv">$ </span>nosetests --with-answer-testing
</pre></div>
</div>
<p>In either case, the current gold standard results will be downloaded from the
rackspace cloud and compared to what is generated locally.  The results from a
nose testing session are pretty straightforward to understand, the results for
each test are printed directly to STDOUT. If a test passes, nose prints a
period, F if a test fails, and E if the test encounters an exception or errors
out for some reason.  If you want to also run tests for the &#8216;big&#8217; datasets,
then you can use the <code class="docutils literal"><span class="pre">answer_big_data</span></code> keyword argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="n">yt</span><span class="o">.</span><span class="n">run_nose</span><span class="p">(</span><span class="n">run_answer_tests</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">answer_big_data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>or, in the base directory of the yt mercurial repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>nosetests --with-answer-testing --answer-big-data
</pre></div>
</div>
<p>It&#8217;s also possible to only run the answer tests for one frontend.  For example,
to run only the enzo answers tests, one can do,</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>nosetests --with-answer-testing yt.frontends.enzo
</pre></div>
</div>
</div>
<div class="section" id="how-to-write-answer-tests">
<h3>How to Write Answer Tests<a class="headerlink" href="#how-to-write-answer-tests" title="Permalink to this headline">¶</a></h3>
<p>Tests can be added in the file <code class="docutils literal"><span class="pre">yt/utilities/answer_testing/framework.py</span></code> .
You can find examples there of how to write a test.  Here is a trivial example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!python</span>
<span class="k">class</span> <span class="nc">MaximumValue</span><span class="p">(</span><span class="n">AnswerTestingTest</span><span class="p">):</span>
    <span class="n">_type_name</span> <span class="o">=</span> <span class="s">&quot;ParentageRelationships&quot;</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;field&quot;</span><span class="p">,)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_fn</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MaximumValue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">ds_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">field</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">v</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">find_max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">c</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_result</span><span class="p">,</span> <span class="n">old_result</span><span class="p">):</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">new_result</span><span class="p">,</span> <span class="n">old_result</span><span class="p">)</span>
</pre></div>
</div>
<p>What this does is calculate the location and value of the maximum of a
field.  It then puts that into the variable result, returns that from
<code class="docutils literal"><span class="pre">run</span></code> and then in <code class="docutils literal"><span class="pre">compare</span></code> makes sure that all are exactly equal.</p>
<p>To write a new test:</p>
<ul class="simple">
<li>Subclass <code class="docutils literal"><span class="pre">AnswerTestingTest</span></code></li>
<li>Add the attributes <code class="docutils literal"><span class="pre">_type_name</span></code> (a string) and <code class="docutils literal"><span class="pre">_attrs</span></code>
(a tuple of strings, one for each attribute that defines the test &#8211;
see how this is done for projections, for instance)</li>
<li>Implement the two routines <code class="docutils literal"><span class="pre">run</span></code> and <code class="docutils literal"><span class="pre">compare</span></code>  The first
should return a result and the second should compare a result to an old
result.  Neither should yield, but instead actually return.  If you need
additional arguments to the test, implement an <code class="docutils literal"><span class="pre">__init__</span></code> routine.</li>
<li>Keep in mind that <em>everything</em> returned from <code class="docutils literal"><span class="pre">run</span></code> will be stored.  So if
you are going to return a huge amount of data, please ensure that the test
only gets run for small data.  If you want a fast way to measure something as
being similar or different, either an md5 hash (see the grid values test) or
a sum and std of an array act as good proxies.  If you must store a large
amount of data for some reason, try serializing the data to a string
(e.g. using <code class="docutils literal"><span class="pre">numpy.ndarray.dumps</span></code>), and then compressing the data stream
using <code class="docutils literal"><span class="pre">zlib.compress</span></code>.</li>
<li>Typically for derived values, we compare to 10 or 12 decimal places.
For exact values, we compare exactly.</li>
</ul>
</div>
<div class="section" id="how-to-add-data-to-the-testing-suite">
<h3>How to Add Data to the Testing Suite<a class="headerlink" href="#how-to-add-data-to-the-testing-suite" title="Permalink to this headline">¶</a></h3>
<p>To add data to the testing suite, first write a new set of tests for the data.
The Enzo example in <code class="docutils literal"><span class="pre">yt/frontends/enzo/tests/test_outputs.py</span></code> is
considered canonical.  Do these things:</p>
<ul class="simple">
<li>Create a new directory, <code class="docutils literal"><span class="pre">tests</span></code> inside the frontend&#8217;s directory.</li>
<li>Create a new file, <code class="docutils literal"><span class="pre">test_outputs.py</span></code> in the frontend&#8217;s <code class="docutils literal"><span class="pre">tests</span></code>
directory.</li>
<li>Create a new routine that operates similarly to the routines you can see
in Enzo&#8217;s outputs.<ul>
<li>This routine should test a number of different fields and data objects.</li>
<li>The test routine itself should be decorated with
<code class="docutils literal"><span class="pre">&#64;requires_ds(file_name)</span></code>  This decorate can accept the argument
<code class="docutils literal"><span class="pre">big_data</span></code> for if this data is too big to run all the time.</li>
<li>There are <code class="docutils literal"><span class="pre">small_patch_amr</span></code> and <code class="docutils literal"><span class="pre">big_patch_amr</span></code> routines that
you can yield from to execute a bunch of standard tests.  This is where
you should start, and then yield additional tests that stress the
outputs in whatever ways are necessary to ensure functionality.</li>
<li><strong>All tests should be yielded!</strong></li>
</ul>
</li>
</ul>
<p>If you are adding to a frontend that has a few tests already, skip the first
two steps.</p>
</div>
<div class="section" id="how-to-upload-answers">
<h3>How to Upload Answers<a class="headerlink" href="#how-to-upload-answers" title="Permalink to this headline">¶</a></h3>
<p>To upload answers you can execute this command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>nosetests --with-answer-testing frontends/enzo/ --answer-store --answer-name<span class="o">=</span>whatever
</pre></div>
</div>
<p>The current version of the gold standard can be found in the variable
<code class="docutils literal"><span class="pre">_latest</span></code> inside <code class="docutils literal"><span class="pre">yt/utilities/answer_testing/framework.py</span></code>  As of
the time of this writing, it is <code class="docutils literal"><span class="pre">gold007</span></code>  Note that the name of the
suite of results is now disconnected from the dataset&#8217;s name, so you
can upload multiple outputs with the same name and not collide.</p>
<p>To upload answers, you <strong>must</strong> have the package boto installed, and you
<strong>must</strong> have an Amazon key provided by Matt.  Contact Matt for these keys.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
    <div class="footer">
      &copy; Copyright 2013, the yt Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>