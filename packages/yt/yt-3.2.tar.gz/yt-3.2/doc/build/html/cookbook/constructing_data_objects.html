<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Constructing Data Objects &mdash; The yt Project 3.2-dev documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.4/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.2-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="The yt Project 3.2-dev documentation" href="../index.html" />
    <link rel="up" title="The Cookbook" href="index.html" />
    <link rel="next" title="Notebook Tutorial" href="notebook_tutorial.html" />
    <link rel="prev" title="Cosmological Analysis" href="cosmological_analysis.html" />
    
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-391373-2']);
      _gaq.push(['_setDomainName', 'yt-project.org']);
      _gaq.push(['_setAllowHash', false]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/yt_icon.png">
          The yt Project</a>
        <span class="navbar-text navbar-version pull-left"><b>3.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../help/index.html">How to get help</a></li>
                <li><a href="../quickstart/index.html">Quickstart notebooks</a></li>
                <li><a href="index.html">Cookbook</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Getting and Installing yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#getting-yt">Getting yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#testing-your-installation">Testing Your Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#switching-between-yt-2-x-and-yt-3-x">Switching between yt-2.x and yt-3.x</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">yt Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/data_inspection.html">Data Inspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/simple_visualization.html">Simple Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/data_objects_and_time_series.html">Data Objects and Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/derived_fields_and_profiles.html">Derived Fields and Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/volume_rendering.html">Volume Rendering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../yt3differences.html">What&#8217;s New and Different in yt 3.0?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#updating-to-yt-3-0-from-old-versions-and-going-back">Updating to yt 3.0 from Old Versions (and going back)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#converting-old-scripts-to-work-with-yt-3-0">Converting Old Scripts to Work with yt 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#cool-new-things">Cool New Things</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#api-changes">API Changes</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#getting-the-sample-data">Getting the Sample Data</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#example-scripts">Example Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#example-notebooks">Example Notebooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visualizing/index.html">Visualizing Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/plots.html">How to Make Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/callbacks.html">Plot Modifications: Overplotting Contours, Velocities, Particles, and More</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/manual_plotting.html">Using the Manual Plotting Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/volume_rendering.html">Volume Rendering: Making 3D Photorealistic Isocontoured Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/hardware_volume_rendering.html">Hardware Volume Rendering on NVidia Graphics cards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/sketchfab.html">3D Surfaces and Sketchfab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/mapserver.html">Mapserver - A Google-Maps-like Interface to your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/streamlines.html">Streamlines: Tracking the Trajectories of Tracers in your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/colormaps/index.html">Colormaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/writing_fits_images.html">Writing FITS Images</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing/index.html">General Data Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/fields.html">Fields in yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/objects.html">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/units/index.html">Symbolic Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/filtering.html">Filtering your Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/generating_processed_data.html">Generating Processed Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/time_series_analysis.html">Time Series Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/parallel_computation.html">Parallel Computation With yt</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing/analysis_modules/index.html">Topic-Specific Analysis Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/halo_analysis.html">Halo Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/synthetic_observation.html">Synthetic Observation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/exporting.html">Exporting to External Radiation Transport Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/two_point_functions.html">Two Point Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/clump_finding.html">Clump Finding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/particle_trajectories.html">Particle Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/ellipsoid_analysis.html">Halo Ellipsoid Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examining/index.html">Loading and Examining Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examining/loading_data.html">Loading Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/generic_array_data.html">Loading Generic Array Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/generic_particle_data.html">Loading Generic Particle Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/spherical_data.html">Loading Spherical Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/low_level_inspection.html">Low-Level Data Inspection: Accessing Raw Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developing/index.html">Developing in yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developing/intro.html">Getting Involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/developing.html">How to Develop yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/building_the_docs.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/debugdrive.html">Debugging yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_datatypes.html">Creating Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_derived_quantities.html">Creating Derived Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_frontend.html">Creating A New Code Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/external_analysis.html">Using yt with External Analysis Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Materials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/code_support.html">Code Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/command-line.html">Command-Line Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/api/api.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration.html">Customizing yt: The Configuration and Plugin Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/field_list.html">Field List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/changelog.html">ChangeLog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#version-installation">Version &amp; Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#code-errors-and-failures">Code Errors and Failures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#units">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#fields">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#data-objects">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#developing">Developing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">Getting Help</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#don-t-panic-and-don-t-give-up">Don&#8217;t panic and don&#8217;t give up</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#update-to-the-latest-version">Update to the latest version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#search-the-documentation-faq-and-mailing-lists">Search the documentation, FAQ, and mailing lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#look-at-the-source-code">Look at the source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#isolate-and-document-your-problem">Isolate and document your problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#go-on-irc-to-ask-a-question">Go on IRC to ask a question</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#ask-the-mailing-list">Ask the mailing list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#submit-a-bug-report">Submit a bug report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#special-issues">Special Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#what-is-yt">What is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#who-is-yt">Who is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#history-of-yt">History of yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#how-do-i-contact-yt">How do I contact yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#how-do-i-cite-yt">How do I cite yt?</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Constructing Data Objects</a><ul>
<li><a class="reference internal" href="#creating-particle-filters">Creating Particle Filters</a></li>
<li><a class="reference internal" href="#cookbook-find-clumps">Identifying Clumps</a></li>
<li><a class="reference internal" href="#extracting-fixed-resolution-data">Extracting Fixed Resolution Data</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="constructing-data-objects">
<h1>Constructing Data Objects<a class="headerlink" href="#constructing-data-objects" title="Permalink to this headline">¶</a></h1>
<p>These recipes demonstrate a few uncommon methods of constructing data objects
from a simulation.</p>
<div class="section" id="creating-particle-filters">
<h2>Creating Particle Filters<a class="headerlink" href="#creating-particle-filters" title="Permalink to this headline">¶</a></h2>
<p>Create particle filters based on the age of star particles in an isolated
disk galaxy simulation.  Determine the total mass of each stellar age bin
in the simulation.  Generate projections for each of the stellar age bins.</p>
<p>(<a class="reference external" href="particle_filter.py">particle_filter.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">yt.data_objects.particle_filters</span> <span class="kn">import</span> <span class="n">add_particle_filter</span>


<span class="c"># Define filter functions for our particle filters based on stellar age.</span>
<span class="c"># In this dataset particles in the initial conditions are given creation</span>
<span class="c"># times arbitrarily far into the future, so stars with negative ages belong</span>
<span class="c"># in the old stars filter.</span>
<span class="k">def</span> <span class="nf">stars_10Myr</span><span class="p">(</span><span class="n">pfilter</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">current_time</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;Stars&quot;</span><span class="p">,</span> <span class="s">&quot;creation_time&quot;</span><span class="p">]</span>
    <span class="nb">filter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">age</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Myr&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">filter</span>

<span class="k">def</span> <span class="nf">stars_100Myr</span><span class="p">(</span><span class="n">pfilter</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">age</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">current_time</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;Stars&quot;</span><span class="p">,</span> <span class="s">&quot;creation_time&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Myr&#39;</span><span class="p">)</span>
    <span class="nb">filter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">filter</span>

<span class="k">def</span> <span class="nf">stars_old</span><span class="p">(</span><span class="n">pfilter</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">current_time</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;Stars&quot;</span><span class="p">,</span> <span class="s">&quot;creation_time&quot;</span><span class="p">]</span>
    <span class="nb">filter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">age</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">age</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Myr&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">filter</span>

<span class="c"># Create the particle filters</span>
<span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&quot;stars_young&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">stars_10Myr</span><span class="p">,</span> <span class="n">filtered_type</span><span class="o">=</span><span class="s">&#39;Stars&#39;</span><span class="p">,</span>
                    <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;creation_time&quot;</span><span class="p">])</span>
<span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&quot;stars_medium&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">stars_100Myr</span><span class="p">,</span> <span class="n">filtered_type</span><span class="o">=</span><span class="s">&#39;Stars&#39;</span><span class="p">,</span>
                    <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;creation_time&quot;</span><span class="p">])</span>
<span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&quot;stars_old&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">stars_old</span><span class="p">,</span> <span class="n">filtered_type</span><span class="o">=</span><span class="s">&#39;Stars&#39;</span><span class="p">,</span>
                    <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;creation_time&quot;</span><span class="p">])</span>

<span class="c"># Load a dataset and apply the particle filters</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;TipsyGalaxy/galaxy.00300&quot;</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&#39;stars_young&#39;</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&#39;stars_medium&#39;</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&#39;stars_old&#39;</span><span class="p">)</span>

<span class="c"># What are the total masses of different ages of star in the whole simulation </span>
<span class="c"># volume?</span>
<span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>
<span class="n">mass_young</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s">&#39;stars_young&#39;</span><span class="p">,</span> <span class="s">&#39;particle_mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msun&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">mass_medium</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s">&#39;stars_medium&#39;</span><span class="p">,</span> <span class="s">&#39;particle_mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msun&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">mass_old</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s">&#39;stars_old&#39;</span><span class="p">,</span> <span class="s">&#39;particle_mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msun&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Mass of young stars = </span><span class="si">%g</span><span class="s"> Msun&quot;</span> <span class="o">%</span> <span class="n">mass_young</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Mass of medium stars = </span><span class="si">%g</span><span class="s"> Msun&quot;</span> <span class="o">%</span> <span class="n">mass_medium</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Mass of old stars = </span><span class="si">%g</span><span class="s"> Msun&quot;</span> <span class="o">%</span> <span class="n">mass_old</span><span class="p">)</span>

<span class="c"># Generate 4 projections: gas density, young stars, medium stars, old stars</span>
<span class="n">fields</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;gas&#39;</span><span class="p">,</span> <span class="s">&#39;density&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;deposit&#39;</span><span class="p">,</span> <span class="s">&#39;stars_young_cic&#39;</span><span class="p">),</span>
          <span class="p">(</span><span class="s">&#39;deposit&#39;</span><span class="p">,</span> <span class="s">&#39;stars_medium_cic&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;deposit&#39;</span><span class="p">,</span> <span class="s">&#39;stars_old_cic&#39;</span><span class="p">)]</span>

<span class="n">prj</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">ProjectionPlot</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s">&quot;max&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s">&#39;kpc&#39;</span><span class="p">))</span>
<span class="n">prj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="cookbook-find-clumps">
<span id="identifying-clumps"></span><h2>Identifying Clumps<a class="headerlink" href="#cookbook-find-clumps" title="Permalink to this headline">¶</a></h2>
<p>This is a recipe to show how to find topologically connected sets of cells
inside a dataset.  It returns these clumps and they can be inspected or
visualized as would any other data object.  More detail on this method can be
found in <cite>astro-ph/0806.1653</cite>.</p>
<p>(<a class="reference external" href="find_clumps.py">find_clumps.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.level_sets.api</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;IsolatedGalaxy/galaxy0030/galaxy0030&quot;</span><span class="p">)</span>

<span class="n">data_source</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">disk</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> 
                      <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s">&#39;kpc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kpc&#39;</span><span class="p">))</span>

<span class="c"># the field to be used for contouring</span>
<span class="n">field</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;gas&quot;</span><span class="p">,</span> <span class="s">&quot;density&quot;</span><span class="p">)</span>

<span class="c"># This is the multiplicative interval between contours.</span>
<span class="n">step</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c"># Now we set some sane min/max values between which we want to find contours.</span>
<span class="c"># This is how we tell the clump finder what to look for -- it won&#39;t look for</span>
<span class="c"># contours connected below or above these threshold values.</span>
<span class="n">c_min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data_source</span><span class="p">[</span><span class="n">field</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>  <span class="p">)</span>
<span class="n">c_max</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data_source</span><span class="p">[</span><span class="n">field</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Now find get our &#39;base&#39; clump -- this one just covers the whole domain.</span>
<span class="n">master_clump</span> <span class="o">=</span> <span class="n">Clump</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>

<span class="c"># Add a &quot;validator&quot; to weed out clumps with less than 20 cells.</span>
<span class="c"># As many validators can be added as you want.</span>
<span class="n">master_clump</span><span class="o">.</span><span class="n">add_validator</span><span class="p">(</span><span class="s">&quot;min_cells&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c"># Begin clump finding.</span>
<span class="n">find_clumps</span><span class="p">(</span><span class="n">master_clump</span><span class="p">,</span> <span class="n">c_min</span><span class="p">,</span> <span class="n">c_max</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

<span class="c"># Write out the full clump hierarchy.</span>
<span class="n">write_clump_index</span><span class="p">(</span><span class="n">master_clump</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_clump_hierarchy.txt&quot;</span> <span class="o">%</span> <span class="n">ds</span><span class="p">)</span>

<span class="c"># Write out only the leaf nodes of the hierarchy.</span>
<span class="n">write_clumps</span><span class="p">(</span><span class="n">master_clump</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_clumps.txt&quot;</span> <span class="o">%</span> <span class="n">ds</span><span class="p">)</span>

<span class="c"># We can traverse the clump hierarchy to get a list of all of the &#39;leaf&#39; clumps</span>
<span class="n">leaf_clumps</span> <span class="o">=</span> <span class="n">get_lowest_clumps</span><span class="p">(</span><span class="n">master_clump</span><span class="p">)</span>

<span class="c"># If you&#39;d like to visualize these clumps, a list of clumps can be supplied to</span>
<span class="c"># the &quot;clumps&quot; callback on a plot.  First, we create a projection plot:</span>
<span class="n">prj</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">ProjectionPlot</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="s">&#39;kpc&#39;</span><span class="p">))</span>

<span class="c"># Next we annotate the plot with contours on the borders of the clumps</span>
<span class="n">prj</span><span class="o">.</span><span class="n">annotate_clumps</span><span class="p">(</span><span class="n">leaf_clumps</span><span class="p">)</span>

<span class="c"># Lastly, we write the plot to disk.</span>
<span class="n">prj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&#39;clumps&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="extracting-fixed-resolution-data">
<span id="extract-frb"></span><h2>Extracting Fixed Resolution Data<a class="headerlink" href="#extracting-fixed-resolution-data" title="Permalink to this headline">¶</a></h2>
<p>This is a recipe to show how to open a dataset and extract it to a file at a
fixed resolution with no interpolation or smoothing.  Additionally, this recipe
shows how to insert a dataset into an external HDF5 file using h5py.</p>
<p>(<a class="reference external" href="extract_fixed_resolution_data.py">extract_fixed_resolution_data.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>

<span class="c"># For this example we will use h5py to write to our output file.</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;IsolatedGalaxy/galaxy0030/galaxy0030&quot;</span><span class="p">)</span>

<span class="n">level</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">domain_dimensions</span> <span class="o">*</span> <span class="n">ds</span><span class="o">.</span><span class="n">refine_by</span><span class="o">**</span><span class="n">level</span>

<span class="c"># We construct an object that describes the data region and structure we want</span>
<span class="c"># In this case, we want all data up to the maximum &quot;level&quot; of refinement </span>
<span class="c"># across the entire simulation volume.  Higher levels than this will not </span>
<span class="c"># contribute to our covering grid.</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">covering_grid</span><span class="p">(</span><span class="n">level</span><span class="p">,</span>  
                        <span class="n">left_edge</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                        <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
                        <span class="c"># And any fields to preload (this is optional!)</span>
                        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">])</span>

<span class="c"># Now we open our output file using h5py</span>
<span class="c"># Note that we open with &#39;w&#39; (write), which will overwrite existing files!</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&quot;my_data.h5&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>

<span class="c"># We create a dataset at the root, calling it &quot;density&quot;</span>
<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;/density&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">cube</span><span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">])</span>

<span class="c"># We close our file</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># If we want to then access this datacube in the h5 file, we can now...</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&quot;my_data.h5&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
    <div class="footer">
      &copy; Copyright 2013, the yt Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>