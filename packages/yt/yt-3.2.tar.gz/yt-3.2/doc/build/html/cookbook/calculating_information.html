<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Calculating Dataset Information &mdash; The yt Project 3.2-dev documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.4/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.2-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="The yt Project 3.2-dev documentation" href="../index.html" />
    <link rel="up" title="The Cookbook" href="index.html" />
    <link rel="next" title="A Few Complex Plots" href="complex_plots.html" />
    <link rel="prev" title="Making Simple Plots" href="simple_plots.html" />
    
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-391373-2']);
      _gaq.push(['_setDomainName', 'yt-project.org']);
      _gaq.push(['_setAllowHash', false]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/yt_icon.png">
          The yt Project</a>
        <span class="navbar-text navbar-version pull-left"><b>3.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../help/index.html">How to get help</a></li>
                <li><a href="../quickstart/index.html">Quickstart notebooks</a></li>
                <li><a href="index.html">Cookbook</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Getting and Installing yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#getting-yt">Getting yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#testing-your-installation">Testing Your Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#switching-between-yt-2-x-and-yt-3-x">Switching between yt-2.x and yt-3.x</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">yt Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/data_inspection.html">Data Inspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/simple_visualization.html">Simple Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/data_objects_and_time_series.html">Data Objects and Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/derived_fields_and_profiles.html">Derived Fields and Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/volume_rendering.html">Volume Rendering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../yt3differences.html">What&#8217;s New and Different in yt 3.0?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#updating-to-yt-3-0-from-old-versions-and-going-back">Updating to yt 3.0 from Old Versions (and going back)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#converting-old-scripts-to-work-with-yt-3-0">Converting Old Scripts to Work with yt 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#cool-new-things">Cool New Things</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#api-changes">API Changes</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#getting-the-sample-data">Getting the Sample Data</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#example-scripts">Example Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#example-notebooks">Example Notebooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visualizing/index.html">Visualizing Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/plots.html">How to Make Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/callbacks.html">Plot Modifications: Overplotting Contours, Velocities, Particles, and More</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/manual_plotting.html">Using the Manual Plotting Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/volume_rendering.html">Volume Rendering: Making 3D Photorealistic Isocontoured Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/hardware_volume_rendering.html">Hardware Volume Rendering on NVidia Graphics cards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/sketchfab.html">3D Surfaces and Sketchfab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/mapserver.html">Mapserver - A Google-Maps-like Interface to your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/streamlines.html">Streamlines: Tracking the Trajectories of Tracers in your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/colormaps/index.html">Colormaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/writing_fits_images.html">Writing FITS Images</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing/index.html">General Data Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/fields.html">Fields in yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/objects.html">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/units/index.html">Symbolic Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/filtering.html">Filtering your Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/generating_processed_data.html">Generating Processed Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/time_series_analysis.html">Time Series Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/parallel_computation.html">Parallel Computation With yt</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing/analysis_modules/index.html">Topic-Specific Analysis Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/halo_analysis.html">Halo Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/synthetic_observation.html">Synthetic Observation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/exporting.html">Exporting to External Radiation Transport Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/two_point_functions.html">Two Point Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/clump_finding.html">Clump Finding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/particle_trajectories.html">Particle Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analyzing/analysis_modules/ellipsoid_analysis.html">Halo Ellipsoid Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examining/index.html">Loading and Examining Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examining/loading_data.html">Loading Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/generic_array_data.html">Loading Generic Array Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/generic_particle_data.html">Loading Generic Particle Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/spherical_data.html">Loading Spherical Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/low_level_inspection.html">Low-Level Data Inspection: Accessing Raw Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developing/index.html">Developing in yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developing/intro.html">Getting Involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/developing.html">How to Develop yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/building_the_docs.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/debugdrive.html">Debugging yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_datatypes.html">Creating Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_derived_quantities.html">Creating Derived Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_frontend.html">Creating A New Code Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/external_analysis.html">Using yt with External Analysis Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Materials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/code_support.html">Code Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/command-line.html">Command-Line Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/api/api.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration.html">Customizing yt: The Configuration and Plugin Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/field_list.html">Field List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/changelog.html">ChangeLog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#version-installation">Version &amp; Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#code-errors-and-failures">Code Errors and Failures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#units">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#fields">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#data-objects">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#developing">Developing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">Getting Help</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#don-t-panic-and-don-t-give-up">Don&#8217;t panic and don&#8217;t give up</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#update-to-the-latest-version">Update to the latest version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#search-the-documentation-faq-and-mailing-lists">Search the documentation, FAQ, and mailing lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#look-at-the-source-code">Look at the source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#isolate-and-document-your-problem">Isolate and document your problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#go-on-irc-to-ask-a-question">Go on IRC to ask a question</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#ask-the-mailing-list">Ask the mailing list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#submit-a-bug-report">Submit a bug report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#special-issues">Special Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#what-is-yt">What is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#who-is-yt">Who is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#history-of-yt">History of yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#how-do-i-contact-yt">How do I contact yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#how-do-i-cite-yt">How do I cite yt?</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Calculating Dataset Information</a><ul>
<li><a class="reference internal" href="#average-field-value">Average Field Value</a></li>
<li><a class="reference internal" href="#mass-enclosed-in-a-sphere">Mass Enclosed in a Sphere</a></li>
<li><a class="reference internal" href="#global-phase-plot">Global Phase Plot</a></li>
<li><a class="reference internal" href="#radial-velocity-profile">Radial Velocity Profile</a></li>
<li><a class="reference internal" href="#simulation-analysis">Simulation Analysis</a></li>
<li><a class="reference internal" href="#time-series-analysis">Time Series Analysis</a></li>
<li><a class="reference internal" href="#simple-derived-fields">Simple Derived Fields</a></li>
<li><a class="reference internal" href="#complicated-derived-fields">Complicated Derived Fields</a></li>
<li><a class="reference internal" href="#using-particle-filters-to-calculate-star-formation-rates">Using Particle Filters to Calculate Star Formation Rates</a></li>
<li><a class="reference internal" href="#making-a-turbulent-kinetic-energy-power-spectrum">Making a Turbulent Kinetic Energy Power Spectrum</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="calculating-dataset-information">
<h1>Calculating Dataset Information<a class="headerlink" href="#calculating-dataset-information" title="Permalink to this headline">¶</a></h1>
<p>These recipes demonstrate methods of calculating quantities in a simulation,
either for later visualization or for understanding properties of fluids and
particles in the simulation.</p>
<div class="section" id="average-field-value">
<h2>Average Field Value<a class="headerlink" href="#average-field-value" title="Permalink to this headline">¶</a></h2>
<p>This recipe is a very simple method of calculating the global average of a
given field, as weighted by another field.
See <a class="reference internal" href="../analyzing/objects.html#derived-quantities"><span>Processing Objects: Derived Quantities</span></a> for more information.</p>
<p>(<a class="reference external" href="average_value.py">average_value.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;IsolatedGalaxy/galaxy0030/galaxy0030&quot;</span><span class="p">)</span>  <span class="c"># load data</span>

<span class="n">field</span> <span class="o">=</span> <span class="s">&quot;temperature&quot;</span>  <span class="c"># The field to average</span>
<span class="n">weight</span> <span class="o">=</span> <span class="s">&quot;cell_mass&quot;</span>  <span class="c"># The weight for the average</span>

<span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>  <span class="c"># This is a region describing the entire box,</span>
                    <span class="c"># but note it doesn&#39;t read anything in yet!</span>

<span class="c"># We now use our &#39;quantities&#39; call to get the average quantity</span>
<span class="n">average_value</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">weighted_average_quantity</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;Average </span><span class="si">%s</span><span class="s"> (weighted by </span><span class="si">%s</span><span class="s">) is </span><span class="si">%0.3e</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">average_value</span><span class="p">,</span> <span class="n">average_value</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="mass-enclosed-in-a-sphere">
<h2>Mass Enclosed in a Sphere<a class="headerlink" href="#mass-enclosed-in-a-sphere" title="Permalink to this headline">¶</a></h2>
<p>This recipe constructs a sphere and then sums the total mass in particles and
fluids in the sphere.
See <a class="reference internal" href="../analyzing/objects.html#available-objects"><span>Available Objects</span></a> and <a class="reference internal" href="../analyzing/objects.html#derived-quantities"><span>Processing Objects: Derived Quantities</span></a> for more information.</p>
<p>(<a class="reference external" href="sum_mass_in_sphere.py">sum_mass_in_sphere.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>

<span class="c"># Load the dataset.</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;Enzo_64/DD0029/data0029&quot;</span><span class="p">)</span>

<span class="c"># Create a 1 Mpc radius sphere, centered on the max density.</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="s">&quot;max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&quot;Mpc&quot;</span><span class="p">))</span>

<span class="c"># Use the total_quantity derived quantity to sum up the</span>
<span class="c"># values of the cell_mass and particle_mass fields</span>
<span class="c"># within the sphere.</span>
<span class="n">baryon_mass</span><span class="p">,</span> <span class="n">particle_mass</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">total_quantity</span><span class="p">([</span><span class="s">&quot;cell_mass&quot;</span><span class="p">,</span> <span class="s">&quot;particle_mass&quot;</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;Total mass in sphere is </span><span class="si">%0.3e</span><span class="s"> Msun (gas = </span><span class="si">%0.3e</span><span class="s"> Msun, particles = </span><span class="si">%0.3e</span><span class="s"> Msun)&quot;</span> <span class="o">%</span> \
      <span class="p">((</span><span class="n">baryon_mass</span> <span class="o">+</span> <span class="n">particle_mass</span><span class="p">)</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msun&#39;</span><span class="p">),</span> \
       <span class="n">baryon_mass</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msun&#39;</span><span class="p">),</span> <span class="n">particle_mass</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msun&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="global-phase-plot">
<h2>Global Phase Plot<a class="headerlink" href="#global-phase-plot" title="Permalink to this headline">¶</a></h2>
<p>This is a simple recipe to show how to open a dataset and then plot a couple
global phase diagrams, save them, and quit.
See <a class="reference internal" href="../visualizing/plots.html#how-to-make-2d-profiles"><span>2D Phase Plots</span></a> for more information.</p>
<p>(<a class="reference external" href="global_phase_plots.py">global_phase_plots.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>

<span class="c"># load the dataset</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;IsolatedGalaxy/galaxy0030/galaxy0030&quot;</span><span class="p">)</span>

<span class="c"># This is an object that describes the entire box</span>
<span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>

<span class="c"># We plot the average velocity magnitude (mass-weighted) in our object</span>
<span class="c"># as a function of density and temperature</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">PhasePlot</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="s">&quot;density&quot;</span><span class="p">,</span> <span class="s">&quot;temperature&quot;</span><span class="p">,</span> <span class="s">&quot;velocity_magnitude&quot;</span><span class="p">)</span>

<span class="c"># save the plot</span>
<span class="n">plot</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="radial-velocity-profile">
<span id="cookbook-radial-velocity"></span><h2>Radial Velocity Profile<a class="headerlink" href="#radial-velocity-profile" title="Permalink to this headline">¶</a></h2>
<p>This recipe demonstrates how to subtract off a bulk velocity on a sphere before
calculating the radial velocity within that sphere.
See <a class="reference internal" href="../visualizing/plots.html#how-to-make-1d-profiles"><span>1D Profile Plots</span></a> for more information on creating profiles and
<a class="reference internal" href="../analyzing/fields.html#field-parameters"><span>Field Parameters</span></a> for an explanation of how the bulk velocity is provided
to the radial velocity field function.</p>
<p>(<a class="reference external" href="rad_velocity.py">rad_velocity.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;GasSloshing/sloshing_nomag2_hdf5_plt_cnt_0150&quot;</span><span class="p">)</span>

<span class="c"># Get the first sphere</span>
<span class="n">sp0</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">domain_center</span><span class="p">,</span> <span class="p">(</span><span class="mf">500.</span><span class="p">,</span> <span class="s">&quot;kpc&quot;</span><span class="p">))</span>

<span class="c"># Compute the bulk velocity from the cells in this sphere</span>
<span class="n">bulk_vel</span> <span class="o">=</span> <span class="n">sp0</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">bulk_velocity</span><span class="p">()</span>


<span class="c"># Get the second sphere</span>
<span class="n">sp1</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">domain_center</span><span class="p">,</span> <span class="p">(</span><span class="mf">500.</span><span class="p">,</span> <span class="s">&quot;kpc&quot;</span><span class="p">))</span>

<span class="c"># Set the bulk velocity field parameter</span>
<span class="n">sp1</span><span class="o">.</span><span class="n">set_field_parameter</span><span class="p">(</span><span class="s">&quot;bulk_velocity&quot;</span><span class="p">,</span> <span class="n">bulk_vel</span><span class="p">)</span>

<span class="c"># Radial profile without correction</span>

<span class="n">rp0</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">create_profile</span><span class="p">(</span><span class="n">sp0</span><span class="p">,</span> <span class="s">&#39;radius&#39;</span><span class="p">,</span> <span class="s">&#39;radial_velocity&#39;</span><span class="p">,</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;radius&#39;</span><span class="p">:</span> <span class="s">&#39;kpc&#39;</span><span class="p">},</span>
                        <span class="n">logs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;radius&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>

<span class="c"># Radial profile with correction for bulk velocity</span>

<span class="n">rp1</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">create_profile</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="s">&#39;radius&#39;</span><span class="p">,</span> <span class="s">&#39;radial_velocity&#39;</span><span class="p">,</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;radius&#39;</span><span class="p">:</span> <span class="s">&#39;kpc&#39;</span><span class="p">},</span>
                        <span class="n">logs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;radius&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>

<span class="c"># Make a plot using matplotlib</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rp0</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">rp0</span><span class="p">[</span><span class="s">&quot;radial_velocity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&quot;km/s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">rp1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">rp1</span><span class="p">[</span><span class="s">&quot;radial_velocity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&quot;km/s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&quot;$\mathrm{r\ (kpc)}$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&quot;$\mathrm{v_r\ (km/s)}$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&quot;Without Correction&quot;</span><span class="p">,</span> <span class="s">&quot;With Correction&quot;</span><span class="p">])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">_profiles.png&quot;</span> <span class="o">%</span> <span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="simulation-analysis">
<h2>Simulation Analysis<a class="headerlink" href="#simulation-analysis" title="Permalink to this headline">¶</a></h2>
<p>This uses <a class="reference internal" href="../reference/api/generated/yt.data_objects.time_series.DatasetSeries.html#yt.data_objects.time_series.DatasetSeries" title="yt.data_objects.time_series.DatasetSeries"><code class="xref py py-class docutils literal"><span class="pre">DatasetSeries</span></code></a> to
calculate the extrema of a series of outputs, whose names it guesses in
advance.  This will run in parallel and take advantage of multiple MPI tasks.
See <a class="reference internal" href="../analyzing/parallel_computation.html#parallel-computation"><span>Parallel Computation With yt</span></a> and <a class="reference internal" href="../analyzing/time_series_analysis.html#time-series-analysis"><span>Time Series Analysis</span></a> for more
information.</p>
<p>(<a class="reference external" href="simulation_analysis.py">simulation_analysis.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="n">yt</span><span class="o">.</span><span class="n">enable_parallelism</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="c"># Enable parallelism in the script (assuming it was called with </span>
<span class="c"># `mpirun -np &lt;n_procs&gt;` )</span>
<span class="n">yt</span><span class="o">.</span><span class="n">enable_parallelism</span><span class="p">()</span>

<span class="c"># By using wildcards such as ? and * with the load command, we can load up a </span>
<span class="c"># Time Series containing all of these datasets simultaneously.</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;enzo_tiny_cosmology/DD????/DD????&#39;</span><span class="p">)</span>

<span class="c"># Calculate and store density extrema for all datasets along with redshift</span>
<span class="c"># in a data dictionary with entries as tuples</span>

<span class="c"># Create an empty dictionary</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c"># Iterate through each dataset in the Time Series (using piter allows it </span>
<span class="c"># to happen in parallel automatically across available processors)</span>
<span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">piter</span><span class="p">():</span>
    <span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>
    <span class="n">extrema</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">extrema</span><span class="p">(</span><span class="s">&#39;density&#39;</span><span class="p">)</span>

    <span class="c"># Fill the dictionary with extrema and redshift information for each dataset</span>
    <span class="n">data</span><span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">basename</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">extrema</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">current_redshift</span><span class="p">)</span>

<span class="c"># Convert dictionary to ordered dictionary to get the right order</span>
<span class="n">od</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

<span class="c"># Print out all the values we calculated.</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Dataset      Redshift        Density Min      Density Max&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;---------------------------------------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">od</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span> 
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">       </span><span class="si">%05.3f</span><span class="s">          </span><span class="si">%5.3g</span><span class="s"> g/cm^3   </span><span class="si">%5.3g</span><span class="s"> g/cm^3&quot;</span> <span class="o">%</span> \
           <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="time-series-analysis">
<span id="cookbook-time-series-analysis"></span><h2>Time Series Analysis<a class="headerlink" href="#time-series-analysis" title="Permalink to this headline">¶</a></h2>
<p>This recipe shows how to calculate a number of quantities on a set of parameter
files.  Note that it is parallel aware, and that if you only wanted to run in
serial the operation <code class="docutils literal"><span class="pre">for</span> <span class="pre">pf</span> <span class="pre">in</span> <span class="pre">ts:</span></code> would also have worked identically.
See <a class="reference internal" href="../analyzing/parallel_computation.html#parallel-computation"><span>Parallel Computation With yt</span></a> and <a class="reference internal" href="../analyzing/time_series_analysis.html#time-series-analysis"><span>Time Series Analysis</span></a> for more
information.</p>
<p>(<a class="reference external" href="time_series.py">time_series.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># Enable parallelism in the script (assuming it was called with</span>
<span class="c"># `mpirun -np &lt;n_procs&gt;` )</span>
<span class="n">yt</span><span class="o">.</span><span class="n">enable_parallelism</span><span class="p">()</span>

<span class="c"># By using wildcards such as ? and * with the load command, we can load up a</span>
<span class="c"># Time Series containing all of these datasets simultaneously.</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;GasSloshingLowRes/sloshing_low_res_hdf5_plt_cnt_0*&#39;</span><span class="p">)</span>

<span class="n">storage</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c"># By using the piter() function, we can iterate on every dataset in </span>
<span class="c"># the TimeSeries object.  By using the storage keyword, we can populate</span>
<span class="c"># a dictionary where the dataset is the key, and sto.result is the value</span>
<span class="c"># for later use when the loop is complete.</span>

<span class="c"># The serial equivalent of piter() here is just &quot;for ds in ts:&quot; .</span>

<span class="k">for</span> <span class="n">store</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">piter</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">storage</span><span class="p">):</span>

    <span class="c"># Create a sphere of radius 100 kpc at the center of the dataset volume</span>
    <span class="n">sphere</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">100.</span><span class="p">,</span> <span class="s">&quot;kpc&quot;</span><span class="p">))</span>
    <span class="c"># Calculate the entropy within that sphere</span>
    <span class="n">entr</span> <span class="o">=</span> <span class="n">sphere</span><span class="p">[</span><span class="s">&quot;entropy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="c"># Store the current time and sphere entropy for this dataset in our </span>
    <span class="c"># storage dictionary as a tuple</span>
    <span class="n">store</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">current_time</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Gyr&#39;</span><span class="p">),</span> <span class="n">entr</span><span class="p">)</span>

<span class="c"># Convert the storage dictionary values to a Nx2 array, so the can be easily</span>
<span class="c"># plotted</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storage</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c"># Plot up the results: time versus entropy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;r-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time (Gyr)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Entropy (ergs/K)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&quot;time_versus_entropy.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="simple-derived-fields">
<span id="cookbook-simple-derived-fields"></span><h2>Simple Derived Fields<a class="headerlink" href="#simple-derived-fields" title="Permalink to this headline">¶</a></h2>
<p>This recipe demonstrates how to create a simple derived field,
<code class="docutils literal"><span class="pre">thermal_energy_density</span></code>, and then generate a projection from it.
See <a class="reference internal" href="../developing/creating_derived_fields.html#creating-derived-fields"><span>Creating Derived Fields</span></a> and <a class="reference internal" href="../visualizing/plots.html#projection-plots"><span>Projection Plots</span></a> for more
information.</p>
<p>(<a class="reference external" href="derived_field.py">derived_field.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>

<span class="c"># Load the dataset.</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;IsolatedGalaxy/galaxy0030/galaxy0030&quot;</span><span class="p">)</span>

<span class="c"># You can create a derived field by manipulating any existing derived fields</span>
<span class="c"># in any way you choose.  In this case, let&#39;s just make a simple one:</span>
<span class="c"># thermal_energy_density = 3/2 nkT</span>

<span class="c"># First create a function which yields your new derived field</span>
<span class="k">def</span> <span class="nf">thermal_energy_dens</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;gas&#39;</span><span class="p">,</span> <span class="s">&#39;number_density&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;gas&#39;</span><span class="p">,</span> <span class="s">&#39;kT&#39;</span><span class="p">]</span>

<span class="c"># Then add it to your dataset and define the units</span>
<span class="n">ds</span><span class="o">.</span><span class="n">add_field</span><span class="p">((</span><span class="s">&quot;gas&quot;</span><span class="p">,</span> <span class="s">&quot;thermal_energy_density&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s">&quot;erg/cm**3&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">thermal_energy_dens</span><span class="p">)</span>

<span class="c"># It will now show up in your derived_field_list</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">derived_field_list</span><span class="p">):</span> 
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c"># Let&#39;s use it to make a projection</span>
<span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>
<span class="n">yt</span><span class="o">.</span><span class="n">ProjectionPlot</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;thermal_energy_density&quot;</span><span class="p">,</span> <span class="n">weight_field</span><span class="o">=</span><span class="s">&quot;density&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&#39;kpc&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="complicated-derived-fields">
<span id="cookbook-complicated-derived-fields"></span><h2>Complicated Derived Fields<a class="headerlink" href="#complicated-derived-fields" title="Permalink to this headline">¶</a></h2>
<p>This recipe demonstrates how to use the
<code class="xref py py-meth docutils literal"><span class="pre">add_gradient_fields()</span></code> method
to generate gradient fields and use them in a more complex derived field.</p>
<p>(<a class="reference external" href="hse_field.py">hse_field.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">yt</span>

<span class="c"># Open a dataset from when there&#39;s a lot of sloshing going on.</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;GasSloshingLowRes/sloshing_low_res_hdf5_plt_cnt_0350&quot;</span><span class="p">)</span>

<span class="c"># Define the components of the gravitational acceleration vector field by</span>
<span class="c"># taking the gradient of the gravitational potential</span>
<span class="n">grad_fields</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">add_gradient_fields</span><span class="p">((</span><span class="s">&quot;gas&quot;</span><span class="p">,</span><span class="s">&quot;gravitational_potential&quot;</span><span class="p">))</span>

<span class="c"># We don&#39;t need to do the same for the pressure field because yt already</span>
<span class="c"># has pressure gradient fields. Now, define the &quot;degree of hydrostatic </span>
<span class="c"># equilibrium&quot; field.</span>

<span class="k">def</span> <span class="nf">_hse</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c"># Remember that g is the negative of the potential gradient</span>
    <span class="n">gx</span> <span class="o">=</span> <span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;gravitational_potential_gradient_x&quot;</span><span class="p">]</span>
    <span class="n">gy</span> <span class="o">=</span> <span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;gravitational_potential_gradient_y&quot;</span><span class="p">]</span>
    <span class="n">gz</span> <span class="o">=</span> <span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;gravitational_potential_gradient_z&quot;</span><span class="p">]</span>
    <span class="n">hx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;pressure_gradient_x&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">gx</span>
    <span class="n">hy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;pressure_gradient_y&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">gy</span>
    <span class="n">hz</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;pressure_gradient_z&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">gz</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">hx</span> <span class="o">*</span> <span class="n">hx</span> <span class="o">+</span> <span class="n">hy</span> <span class="o">*</span> <span class="n">hy</span> <span class="o">+</span> <span class="n">hz</span> <span class="o">*</span> <span class="n">hz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gx</span> <span class="o">*</span> <span class="n">gx</span> <span class="o">+</span> <span class="n">gy</span> <span class="o">*</span> <span class="n">gy</span> <span class="o">+</span> <span class="n">gz</span> <span class="o">*</span> <span class="n">gz</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">h</span>
<span class="n">ds</span><span class="o">.</span><span class="n">add_field</span><span class="p">((</span><span class="s">&#39;gas&#39;</span><span class="p">,</span><span class="s">&#39;HSE&#39;</span><span class="p">),</span> <span class="n">function</span><span class="o">=</span><span class="n">_hse</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">take_log</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">display_name</span><span class="o">=</span><span class="s">&#39;Hydrostatic Equilibrium&#39;</span><span class="p">)</span>

<span class="c"># The gradient operator requires periodic boundaries.  This dataset has</span>
<span class="c"># open boundary conditions.  We need to hack it for now (this will be fixed</span>
<span class="c"># in future version of yt)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">periodicity</span> <span class="o">=</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="c"># Take a slice through the center of the domain</span>
<span class="n">slc</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">SlicePlot</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">,</span> <span class="s">&quot;HSE&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Mpc&#39;</span><span class="p">))</span>

<span class="n">slc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&quot;hse&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-particle-filters-to-calculate-star-formation-rates">
<h2>Using Particle Filters to Calculate Star Formation Rates<a class="headerlink" href="#using-particle-filters-to-calculate-star-formation-rates" title="Permalink to this headline">¶</a></h2>
<p>This recipe demonstrates how to use a particle filter to calculate the star
formation rate in a galaxy evolution simulation.
See <a class="reference internal" href="../analyzing/filtering.html#filtering-particles"><span>Filtering Particle Fields</span></a> for more information.</p>
<p>(<a class="reference external" href="particle_filter_sfr.py">particle_filter_sfr.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">yt.data_objects.particle_filters</span> <span class="kn">import</span> <span class="n">add_particle_filter</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">def</span> <span class="nf">formed_star</span><span class="p">(</span><span class="n">pfilter</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="nb">filter</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="s">&quot;creation_time&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nb">filter</span>

<span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&quot;formed_star&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">formed_star</span><span class="p">,</span> <span class="n">filtered_type</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span>
                    <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;creation_time&quot;</span><span class="p">])</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;IsolatedGalaxy/galaxy0030/galaxy0030&quot;</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&#39;formed_star&#39;</span><span class="p">)</span>
<span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>
<span class="n">masses</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s">&#39;formed_star&#39;</span><span class="p">,</span> <span class="s">&#39;particle_mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msun&#39;</span><span class="p">)</span>
<span class="n">formation_time</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s">&#39;formed_star&#39;</span><span class="p">,</span> <span class="s">&#39;creation_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;yr&#39;</span><span class="p">)</span>

<span class="n">time_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5e8</span><span class="p">]</span> <span class="c"># years</span>
<span class="n">n_bins</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">formation_time</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">time_range</span><span class="p">,)</span>
<span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">formation_time</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
<span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>

<span class="n">sfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">masses</span><span class="p">[</span><span class="n">inds</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">bins</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))])</span>
<span class="n">sfr</span><span class="p">[</span><span class="n">sfr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">sfr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time  [Myr]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;SFR  [M$_\odot$ yr$^{-1}$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&quot;filter_sfr.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="making-a-turbulent-kinetic-energy-power-spectrum">
<h2>Making a Turbulent Kinetic Energy Power Spectrum<a class="headerlink" href="#making-a-turbulent-kinetic-energy-power-spectrum" title="Permalink to this headline">¶</a></h2>
<p>This recipe shows how to use <cite>yt</cite> to read data and put it on a uniform
grid to interface with the NumPy FFT routines and create a turbulent
kinetic energy power spectrum.  (Note: the dataset used here is of low
resolution, so the turbulence is not very well-developed.  The spike
at high wavenumbers is due to non-periodicity in the z-direction).</p>
<p>(<a class="reference external" href="power_spectrum_example.py">power_spectrum_example.py</a>)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">yt</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Make a turbulent KE power spectrum.  Since we are stratified, we use</span>
<span class="sd">a rho**(1/3) scaling to the velocity to get something that would</span>
<span class="sd">look Kolmogorov (if the turbulence were fully developed).</span>

<span class="sd">Ultimately, we aim to compute:</span>

<span class="sd">                      1  ^      ^*                                           </span>
<span class="sd">     E(k) = integral  -  V(k) . V(k) dS                                      </span>
<span class="sd">                      2                                                      </span>
<span class="sd"> </span>
<span class="sd">             n                                               ^               </span>
<span class="sd">where V = rho  U is the density-weighted velocity field, and V is the</span>
<span class="sd">FFT of V.</span>
<span class="sd"> </span>
<span class="sd">(Note: sometimes we normalize by 1/volume to get a spectral</span>
<span class="sd">energy density spectrum).</span>


<span class="sd">&quot;&quot;&quot;</span>
 

<span class="k">def</span> <span class="nf">doit</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>

    <span class="c"># a FFT operates on uniformly gridded data.  We&#39;ll use the yt</span>
    <span class="c"># covering grid for this.</span>

    <span class="n">max_level</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max_level</span>

    <span class="n">ref</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">ref_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">max_level</span><span class="p">]))</span>

    <span class="n">low</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">domain_left_edge</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">domain_dimensions</span><span class="o">*</span><span class="n">ref</span>

    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span> <span class="o">=</span> <span class="n">dims</span>

    <span class="n">nindex_rho</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span>

    <span class="n">Kk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nz</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">vel</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&quot;gas&quot;</span><span class="p">,</span> <span class="s">&quot;velocity_x&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;gas&quot;</span><span class="p">,</span> <span class="s">&quot;velocity_y&quot;</span><span class="p">),</span> 
                <span class="p">(</span><span class="s">&quot;gas&quot;</span><span class="p">,</span> <span class="s">&quot;velocity_z&quot;</span><span class="p">)]:</span>

        <span class="n">Kk</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">fft_comp</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;gas&quot;</span><span class="p">,</span> <span class="s">&quot;density&quot;</span><span class="p">),</span> <span class="n">vel</span><span class="p">,</span>
                           <span class="n">nindex_rho</span><span class="p">,</span> <span class="n">max_level</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>

    <span class="c"># wavenumbers</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">domain_right_edge</span> <span class="o">-</span> <span class="n">ds</span><span class="o">.</span><span class="n">domain_left_edge</span><span class="p">)</span><span class="o">.</span><span class="n">d</span>

    <span class="n">kx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span><span class="o">*</span><span class="n">nx</span><span class="o">/</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span><span class="o">*</span><span class="n">ny</span><span class="o">/</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">kz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span><span class="o">*</span><span class="n">nz</span><span class="o">/</span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="c"># physical limits to the wavenumbers</span>
    <span class="n">kmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">L</span><span class="p">)</span>
    <span class="n">kmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dims</span><span class="o">/</span><span class="n">L</span><span class="p">)</span>
    
    <span class="n">kbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">kmin</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kbins</span><span class="p">)</span>

    <span class="c"># bin the Fourier KE into radial kbins</span>
    <span class="n">kx3d</span><span class="p">,</span> <span class="n">ky3d</span><span class="p">,</span> <span class="n">kz3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s">&quot;ij&quot;</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kx3d</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ky3d</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">kz3d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">whichbin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">kbins</span><span class="p">)</span>
    <span class="n">ncount</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">whichbin</span><span class="p">)</span>
    
    <span class="n">E_spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ncount</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ncount</span><span class="p">)):</span>
        <span class="n">E_spectrum</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Kk</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">whichbin</span><span class="o">==</span><span class="n">n</span><span class="p">])</span>

    <span class="n">k</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">kbins</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
    <span class="n">E_spectrum</span> <span class="o">=</span> <span class="n">E_spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">]</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">E_spectrum</span><span class="p">)</span>
    <span class="n">kmax</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">Emax</span> <span class="o">=</span> <span class="n">E_spectrum</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">E_spectrum</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Emax</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="n">kmax</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">5.</span><span class="o">/</span><span class="mf">3.</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;0.5&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&quot;$k$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&quot;$E(k)dk$&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&quot;spectrum.png&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fft_comp</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">irho</span><span class="p">,</span> <span class="n">iu</span><span class="p">,</span> <span class="n">nindex_rho</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">delta</span> <span class="p">):</span>

    <span class="n">cube</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">covering_grid</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">left_edge</span><span class="o">=</span><span class="n">low</span><span class="p">,</span>
                            <span class="n">dims</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span>
                            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">irho</span><span class="p">,</span> <span class="n">iu</span><span class="p">])</span>

    <span class="n">rho</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="n">irho</span><span class="p">]</span><span class="o">.</span><span class="n">d</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="n">iu</span><span class="p">]</span><span class="o">.</span><span class="n">d</span>

    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span> <span class="o">=</span> <span class="n">rho</span><span class="o">.</span><span class="n">shape</span>

    <span class="c"># do the FFTs -- note that since our data is real, there will be</span>
    <span class="c"># too much information here.  fftn puts the positive freq terms in</span>
    <span class="c"># the first half of the axes -- that&#39;s what we keep.  Our</span>
    <span class="c"># normalization has an &#39;8&#39; to account for this clipping to one</span>
    <span class="c"># octant.</span>
    <span class="n">ru</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftn</span><span class="p">(</span><span class="n">rho</span><span class="o">**</span><span class="n">nindex_rho</span> <span class="o">*</span> <span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">nz</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ru</span> <span class="o">=</span> <span class="mf">8.0</span><span class="o">*</span><span class="n">ru</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ru</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>



<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;maestro_xrb_lores_23437&quot;</span><span class="p">)</span>
<span class="n">doit</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
    <div class="footer">
      &copy; Copyright 2013, the yt Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>