<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using yt with External Analysis Tools &mdash; The yt Project 3.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="The yt Project 3.0 documentation" href="../index.html" />
    <link rel="up" title="Analyzing Data" href="index.html" />
    <link rel="next" title="Examining Data" href="../examining/index.html" />
    <link rel="prev" title="Halo Ellipsoid Analysis" href="analysis_modules/ellipsoid_analysis.html" />
    
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-391373-2']);
      _gaq.push(['_setDomainName', 'yt-project.org']);
      _gaq.push(['_setAllowHash', false]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/yt_icon.png">
          The yt Project</a>
        <span class="navbar-text navbar-version pull-left"><b>3.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="../help/index.html">How to get help</a></li>
                <li><a href="../quickstart/index.html">Quickstart notebooks</a></li>
                <li><a href="../cookbook/index.html">Cookbook</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Getting and Installing yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#getting-yt">Getting yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#testing-your-installation">Testing Your Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing.html#switching-between-yt-2-x-and-yt-3-x">Switching between yt-2.x and yt-3.x</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">yt Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/data_inspection.html">Data Inspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/simple_visualization.html">Simple Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/data_objects_and_time_series.html">Data Objects and Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/derived_fields_and_profiles.html">Derived Fields and Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/volume_rendering.html">Volume Rendering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../yt3differences.html">What&#8217;s New and Different in yt 3.0?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#updating-to-yt-3-0-from-old-versions">Updating to yt 3.0 from Old Versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#cheat-sheet">Cheat Sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#cool-new-things">Cool New Things</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yt3differences.html#api-changes">API Changes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/index.html">The Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/index.html#getting-the-sample-data">Getting the Sample Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/index.html#example-scripts">Example Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/index.html#example-notebooks">Example Notebooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visualizing/index.html">Visualizing Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/plots.html">How to Make Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/callbacks.html">Plot Modification Mechanisms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/manual_plotting.html">Using the Manual Plotting Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/volume_rendering.html">Volume Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/hardware_volume_rendering.html">Hardware Volume Rendering on NVidia Graphics cards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/sketchfab.html">3D Surfaces and Sketchfab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/mapserver.html">Mapserver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/streamlines.html">Streamlines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/colormaps/index.html">Colormaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualizing/writing_fits_images.html">Writing FITS Images</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Analyzing Data</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fields.html">Fields in yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="objects.html">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="units/index.html">Symbolic Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="filtering.html">Filtering your Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="generating_processed_data.html">Generating Processed Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="time_series_analysis.html">Time Series Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_computation.html">Parallel Computation With yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis_modules/index.html">Analysis Modules</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Using yt with External Analysis Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examining/index.html">Examining Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examining/loading_data.html">Loading Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/generic_array_data.html">Loading Generic Array Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/generic_particle_data.html">Loading Generic Particle Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examining/low_level_inspection.html">Low-Level Data Inspection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developing/index.html">Developing in yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developing/intro.html">Getting Involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/developing.html">How to Develop yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/debugdrive.html">Debugging yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_datatypes.html">Creating Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_derived_quantities.html">Creating Derived Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/creating_frontend.html">Creating A New Code Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing/building_the_docs.html">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Materials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/code_support.html">Code Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/command-line.html">Command-Line Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sharing_data.html">What is the yt Hub?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration.html">Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/faq/index.html">Frequently Asked Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/overview.html">yt Concepts and History</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python_introduction.html">A Brief Introduction to Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/field_list.html">Field List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/api/api.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/changelog.html">ChangeLog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">Getting Help</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#don-t-panic-and-don-t-give-up">Don&#8217;t Panic and Don&#8217;t Give up</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#try-updating-yt">Try Updating yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#search-the-documentation-and-mailing-lists">Search the Documentation and Mailing Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#look-at-the-source-code">Look at the Source Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#isolate-and-document-your-problem">Isolate and Document Your Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#irc">IRC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#ask-the-mailing-list">Ask the Mailing List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#how-to-report-a-bug">How to Report a Bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#installation-issues">Installation Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/index.html#customization-and-scripting-issues">Customization and Scripting Issues</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Using yt with External Analysis Tools</a><ul>
<li><a class="reference internal" href="#calling-external-python-codes">Calling External Python Codes</a></li>
<li><a class="reference internal" href="#calling-non-python-external-codes">Calling Non-Python External Codes</a><ul>
<li><a class="reference internal" href="#our-example-code">Our Example Code</a></li>
<li><a class="reference internal" href="#setting-up-and-building-our-wrapper">Setting Up and Building Our Wrapper</a></li>
<li><a class="reference internal" href="#writing-and-calling-our-wrapper">Writing and Calling our Wrapper</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exporting-data-from-yt">Exporting Data from yt</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="using-yt-with-external-analysis-tools">
<h1>Using yt with External Analysis Tools<a class="headerlink" href="#using-yt-with-external-analysis-tools" title="Permalink to this headline">¶</a></h1>
<p>yt can be used as a <tt class="docutils literal"><span class="pre">glue</span></tt> code between simulation data and other methods of
analyzing data.  Its facilities for understanding units, disk IO and data
selection set it up ideally to use other mechanisms for analyzing, processing
and visualizing data.</p>
<div class="section" id="calling-external-python-codes">
<h2>Calling External Python Codes<a class="headerlink" href="#calling-external-python-codes" title="Permalink to this headline">¶</a></h2>
<p>Calling external Python codes very straightforward.  For instance, if you had a
Python code that accepted a set of structured meshes and then post-processed
them to apply radiative feedback, one could imagine calling it directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">import</span> <span class="nn">radtrans</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;DD0010/DD0010&quot;</span><span class="p">)</span>
<span class="n">rt_grids</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">grid</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">grids</span><span class="p">:</span>
    <span class="n">rt_grid</span> <span class="o">=</span> <span class="n">radtrans</span><span class="o">.</span><span class="n">RegularBox</span><span class="p">(</span>
         <span class="n">grid</span><span class="o">.</span><span class="n">LeftEdge</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">RightEdge</span><span class="p">,</span>
         <span class="n">grid</span><span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="s">&quot;temperature&quot;</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="s">&quot;metallicity&quot;</span><span class="p">])</span>
    <span class="n">rt_grids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rt_grid</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">clear_data</span><span class="p">()</span>

<span class="n">radtrans</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rt_grids</span><span class="p">)</span>
</pre></div>
</div>
<p>Or if you wanted to run a population synthesis module on a set of star
particles (and you could fit them all into memory) it might look something like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">import</span> <span class="nn">pop_synthesis</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;DD0010/DD0010&quot;</span><span class="p">)</span>
<span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>
<span class="n">star_masses</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s">&quot;StarMassMsun&quot;</span><span class="p">]</span>
<span class="n">star_metals</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s">&quot;StarMetals&quot;</span><span class="p">]</span>

<span class="n">pop_synthesis</span><span class="o">.</span><span class="n">CalculateSED</span><span class="p">(</span><span class="n">star_masses</span><span class="p">,</span> <span class="n">star_metals</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have a code that&#8217;s written in Python that you are having trouble getting
data into from yt, please feel encouraged to email the users list and we&#8217;ll
help out.</p>
</div>
<div class="section" id="calling-non-python-external-codes">
<h2>Calling Non-Python External Codes<a class="headerlink" href="#calling-non-python-external-codes" title="Permalink to this headline">¶</a></h2>
<p>Independent of its ability to process, analyze and visualize data, yt can also
serve as a mechanism for reading and selecting simulation data.  In this way,
it can be used to supply data to an external analysis routine written in
Fortran, C or C++.  This document describes how to supply that data, using the
example of a simple code that calculates the best axes that describe a
distribution of particles as a starting point.  (The underlying method is left
as an exercise for the reader; we&#8217;re only currently interested in the function
specification and structs.)</p>
<p>If you have written a piece of code that performs some analysis function, and
you would like to include it in the base distribution of yt, we would be happy
to do so; drop us a line or see <a class="reference internal" href="../developing/developing.html#contributing-code"><em>How to Develop yt</em></a> for more information.</p>
<p>To accomplish the process of linking Python with our external code, we will be
using a language called <a class="reference external" href="http://www.cython.org/">Cython</a>, which is
essentially a superset of Python that compiles down to C.  It is aware of NumPy
arrays, and it is able to massage data between the interpreted language Python
and C, Fortran or C++.  It will be much easier to utilize routines and analysis
code that have been separated into subroutines that accept data structures, so
we will assume that our halo axis calculator accepts a set of structs.</p>
<div class="section" id="our-example-code">
<h3>Our Example Code<a class="headerlink" href="#our-example-code" title="Permalink to this headline">¶</a></h3>
<p>Here is the <tt class="docutils literal"><span class="pre">axes.h</span></tt> file in our imaginary code, which we will then wrap:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">structParticleCollection</span> <span class="p">{</span>
     <span class="kt">long</span> <span class="n">npart</span><span class="p">;</span>
     <span class="kt">double</span> <span class="o">*</span><span class="n">xpos</span><span class="p">;</span>
     <span class="kt">double</span> <span class="o">*</span><span class="n">ypos</span><span class="p">;</span>
     <span class="kt">double</span> <span class="o">*</span><span class="n">zpos</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ParticleCollection</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">calculate_axes</span><span class="p">(</span><span class="n">ParticleCollection</span> <span class="o">*</span><span class="n">part</span><span class="p">,</span>
         <span class="kt">double</span> <span class="o">*</span><span class="n">ax1</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">ax2</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">ax3</span><span class="p">);</span>
</pre></div>
</div>
<p>There are several components to this analysis routine which we will have to
wrap.</p>
<ol class="arabic simple">
<li>We have to wrap the creation of an instance of <tt class="docutils literal"><span class="pre">ParticleCollection</span></tt>.</li>
<li>We have to transform a set of NumPy arrays into pointers to doubles.</li>
<li>We have to create a set of doubles into which <tt class="docutils literal"><span class="pre">calculate_axes</span></tt> will be
placing the values of the axes it calculates.</li>
<li>We have to turn the return values back into Python objects.</li>
</ol>
<p>Each of these steps can be handled in turn, and we&#8217;ll be doing it using Cython
as our interface code.</p>
</div>
<div class="section" id="setting-up-and-building-our-wrapper">
<h3>Setting Up and Building Our Wrapper<a class="headerlink" href="#setting-up-and-building-our-wrapper" title="Permalink to this headline">¶</a></h3>
<p>To get started, we&#8217;ll need to create two files:</p>
<div class="highlight-bash"><div class="highlight"><pre>axes_calculator.pyx
axes_calculator_setup.py
</pre></div>
</div>
<p>These can go anywhere, but it might be useful to put them in their own
directory.  The contents of <tt class="docutils literal"><span class="pre">axes_calculator.pyx</span></tt> will be left for the next
section, but we will need to put some boilerplate code into
<tt class="docutils literal"><span class="pre">axes_calculator_setup.pyx</span></tt>.  As a quick sidenote, you should call these
whatever is most appropriate for the external code you are wrapping;
<tt class="docutils literal"><span class="pre">axes_calculator</span></tt> is probably not the best bet.</p>
<p>Here&#8217;s a rough outline of what should go in <tt class="docutils literal"><span class="pre">axes_calculator_setup.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">NAME</span> <span class="o">=</span> <span class="s">&quot;axes_calculator&quot;</span>
<span class="n">EXT_SOURCES</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">EXT_LIBRARIES</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;axes_utils&quot;</span><span class="p">,</span> <span class="s">&quot;m&quot;</span><span class="p">]</span>
<span class="n">EXT_LIBRARY_DIRS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;/home/rincewind/axes_calculator/&quot;</span><span class="p">]</span>
<span class="n">EXT_INCLUDE_DIRS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">DEFINES</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="kn">from</span> <span class="nn">distutils.extension</span> <span class="kn">import</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="nn">Cython.Distutils</span> <span class="kn">import</span> <span class="n">build_ext</span>

<span class="n">ext_modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">Extension</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span>
                 <span class="p">[</span><span class="n">NAME</span><span class="o">+</span><span class="s">&quot;.pyx&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">EXT_SOURCES</span><span class="p">,</span>
                 <span class="n">libraries</span> <span class="o">=</span> <span class="n">EXT_LIBRARIES</span><span class="p">,</span>
                 <span class="n">library_dirs</span> <span class="o">=</span> <span class="n">EXT_LIBRARY_DIRS</span><span class="p">,</span>
                 <span class="n">include_dirs</span> <span class="o">=</span> <span class="n">EXT_INCLUDE_DIRS</span><span class="p">,</span>
                 <span class="n">define_macros</span> <span class="o">=</span> <span class="n">DEFINES</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">setup</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span><span class="p">,</span>
  <span class="n">cmdclass</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;build_ext&#39;</span><span class="p">:</span> <span class="n">build_ext</span><span class="p">},</span>
  <span class="n">ext_modules</span> <span class="o">=</span> <span class="n">ext_modules</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The only variables you should have to change in this are the first six, and
possibly only the first one.  We&#8217;ll go through these variables one at a time.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">NAME</span></tt></dt>
<dd>This is the name of our source file, minus the <tt class="docutils literal"><span class="pre">.pyx</span></tt>.  We&#8217;re also
mandating that it be the name of the module we import.  You&#8217;re free to
modify this.</dd>
<dt><tt class="docutils literal"><span class="pre">EXT_SOURCES</span></tt></dt>
<dd>Any additional sources can be listed here.  For instance, if you are only
linking against a single <tt class="docutils literal"><span class="pre">.c</span></tt> file, you could list it here &#8211; if our axes
calculator were fully contained within a file called <tt class="docutils literal"><span class="pre">calculate_my_axes.c</span></tt>
we could link against it using this variable, and then we would not have to
specify any libraries.  This is usually the simplest way to do things, and in
fact, yt makes use of this itself for things like HEALPix and interpolation
functions.</dd>
<dt><tt class="docutils literal"><span class="pre">EXT_LIBRARIES</span></tt></dt>
<dd>Any libraries that will need to be linked against (like <tt class="docutils literal"><span class="pre">m</span></tt>!) should be
listed here.  Note that these are the name of the library minus the leading
<tt class="docutils literal"><span class="pre">lib</span></tt> and without the trailing <tt class="docutils literal"><span class="pre">.so</span></tt>.  So <tt class="docutils literal"><span class="pre">libm.so</span></tt> would become <tt class="docutils literal"><span class="pre">m</span></tt>
and <tt class="docutils literal"><span class="pre">libluggage.so</span></tt> would become <tt class="docutils literal"><span class="pre">luggage</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">EXT_LIBRARY_DIRS</span></tt></dt>
<dd>If the libraries listed in <tt class="docutils literal"><span class="pre">EXT_LIBRARIES</span></tt> reside in some other directory
or directories, those directories should be listed here.  For instance,
<tt class="docutils literal"><span class="pre">[&quot;/usr/local/lib&quot;,</span> <span class="pre">&quot;/home/rincewind/luggage/&quot;]</span></tt> .</dd>
<dt><tt class="docutils literal"><span class="pre">EXT_INCLUDE_DIRS</span></tt></dt>
<dd>If any header files have been included that live in external directories,
those directories should be included here.</dd>
<dt><tt class="docutils literal"><span class="pre">DEFINES</span></tt></dt>
<dd>Any define macros that should be passed to the C compiler should be listed
here; if they just need to be defined, then they should be specified to be
defined as &#8220;None.&#8221;  For instance, if you wanted to pass <tt class="docutils literal"><span class="pre">-DTWOFLOWER</span></tt>, you
would set this to equal: <tt class="docutils literal"><span class="pre">[(&quot;TWOFLOWER&quot;,</span> <span class="pre">None)]</span></tt>.</dd>
</dl>
<p>To build our extension, we would run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python2.7 axes_calculator_setup.py build_ext -i
</pre></div>
</div>
<p>Note that since we don&#8217;t yet have an <tt class="docutils literal"><span class="pre">axes_calculator.pyx</span></tt>, this will fail.
But once we have it, it ought to run.</p>
</div>
<div class="section" id="writing-and-calling-our-wrapper">
<h3>Writing and Calling our Wrapper<a class="headerlink" href="#writing-and-calling-our-wrapper" title="Permalink to this headline">¶</a></h3>
<p>Now we begin the tricky part, of writing our wrapper code.  We&#8217;ve already
figured out how to build it, which is halfway to being able to test that it
works, and we now need to start writing Cython code.</p>
<p>For a more detailed introduction to Cython, see the Cython documentation at
<a class="reference external" href="http://docs.cython.org/">http://docs.cython.org/</a> .  We&#8217;ll cover a few of the basics for wrapping code
however.</p>
<p>To start out with, we need to open up and edit our file,
<tt class="docutils literal"><span class="pre">axes_calculator.pyx</span></tt>.  Open this in your favorite version of vi (mine is
vim) and we will get started by declaring the struct we need to pass in.  But
first, we need to include some header information:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">cimport</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">cimport</span> <span class="nn">cython</span>
<span class="k">from</span> <span class="nn">stdlib</span> <span class="k">cimport</span> <span class="n">malloc</span><span class="p">,</span> <span class="n">free</span>
</pre></div>
</div>
<p>These lines simply import and &#8220;Cython import&#8221; some common routines.  For more
information about what is already available, see the Cython documentation.  For
now, we need to start translating our data.</p>
<p>To do so, we tell Cython both where the struct should come from, and then we
describe the struct itself.  One fun thing to note is that if you don&#8217;t need to
set or access all the values in a struct, and it just needs to be passed around
opaquely, you don&#8217;t have to include them in the definition.  For an example of
this, see the <tt class="docutils literal"><span class="pre">png_writer.pyx</span></tt> file in the yt repository.  Here&#8217;s the syntax
for pulling in (from a file called <tt class="docutils literal"><span class="pre">axes_calculator.h</span></tt>) a struct like the one
described above:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kr">extern</span> <span class="k">from</span> <span class="s">&quot;axes_calculator.h&quot;</span><span class="p">:</span>
    <span class="k">ctypedef</span> <span class="k">struct</span> <span class="nc">ParticleCollection</span><span class="p">:</span>
        <span class="nb">long</span> <span class="n">npart</span>
        <span class="n">double</span> <span class="o">*</span><span class="n">xpos</span>
        <span class="n">double</span> <span class="o">*</span><span class="n">ypos</span>
        <span class="n">double</span> <span class="o">*</span><span class="n">zpos</span>
</pre></div>
</div>
<p>So far, pretty easy!  We&#8217;ve basically just translated the declaration from the
<tt class="docutils literal"><span class="pre">.h</span></tt> file.  Now that we have done so, any other Cython code can create and
manipulate these <tt class="docutils literal"><span class="pre">ParticleCollection</span></tt> structs &#8211; which we&#8217;ll do shortly.
Next up, we need to declare the function we&#8217;re going to call, which looks
nearly exactly like the one in the <tt class="docutils literal"><span class="pre">.h</span></tt> file.  (One common problem is that
Cython doesn&#8217;t know what <tt class="docutils literal"><span class="pre">const</span></tt> means, so just remove it wherever you see
it.)  Declare it like so:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="n">void</span> <span class="n">calculate_axes</span><span class="p">(</span><span class="n">ParticleCollection</span> <span class="o">*</span><span class="n">part</span><span class="p">,</span>
         <span class="n">double</span> <span class="o">*</span><span class="n">ax1</span><span class="p">,</span> <span class="n">double</span> <span class="o">*</span><span class="n">ax2</span><span class="p">,</span> <span class="n">double</span> <span class="o">*</span><span class="n">ax3</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this is indented one level, to indicate that it, too, comes from
<tt class="docutils literal"><span class="pre">axes_calculator.h</span></tt>.  The next step is to create a function that accepts
arrays and converts them to the format the struct likes.  We declare our
function just like we would a normal Python function, using <tt class="docutils literal"><span class="pre">def</span></tt>.  You can
also use <tt class="docutils literal"><span class="pre">cdef</span></tt> if you only want to call a function from within Cython.  We
want to call it from Python, too, so we just use <tt class="docutils literal"><span class="pre">def</span></tt>.  Note that we don&#8217;t
here specify types for the various arguments.  In a moment we&#8217;ll refine this to
have better argument types.</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">def</span> <span class="nf">examine_axes</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">zpos</span><span class="p">):</span>
    <span class="k">cdef</span> <span class="kt">double</span> <span class="kt">ax1</span>[3], <span class="kt">ax2</span>[3], <span class="kt">ax3</span>[3]
    <span class="k">cdef</span> <span class="kt">ParticleCollection</span> <span class="nf">particles</span>
    <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span>

    <span class="n">particles</span><span class="o">.</span><span class="n">npart</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xpos</span><span class="p">)</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">xpos</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span> <span class="n">malloc</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">npart</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">))</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">ypos</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span> <span class="n">malloc</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">npart</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">))</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">zpos</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span> <span class="n">malloc</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">npart</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">npart</span><span class="p">):</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">xpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">ypos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ypos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">zpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">zpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">calculate_axes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">particles</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span>

    <span class="n">free</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">xpos</span><span class="p">)</span>
    <span class="n">free</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">ypos</span><span class="p">)</span>
    <span class="n">free</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">zpos</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">ax1</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ax1</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ax1</span><span class="p">[</span><span class="mf">2</span><span class="p">]),</span>
             <span class="p">(</span><span class="n">ax2</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ax2</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ax2</span><span class="p">[</span><span class="mf">2</span><span class="p">]),</span>
             <span class="p">(</span><span class="n">ax3</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ax3</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ax3</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span> <span class="p">)</span>
</pre></div>
</div>
<p>This does the rest.  Note that we&#8217;ve weaved in C-type declarations (ax1, ax2,
ax3) and Python access to the variables fed in.  This function will probably be
quite slow &#8211; because it doesn&#8217;t know anything about the variables xpos, ypos,
zpos, it won&#8217;t be able to speed up access to them.  Now we will see what we can
do by declaring them to be of array-type before we start handling them at all.
We can do that by annotating in the function argument list.  But first, let&#8217;s
test that it works.  From the directory in which you placed these files, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python2.6 setup.py build_ext -i
</pre></div>
</div>
<p>Now, create a sample file that feeds in the particles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">axes_calculator</span>
<span class="n">axes_calculator</span><span class="o">.</span><span class="n">examine_axes</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">zpos</span><span class="p">)</span>
</pre></div>
</div>
<p>Most of the time in that function is spent in converting the data.  So now we
can go back and we&#8217;ll try again, rewriting our converter function to believe
that its being fed arrays from NumPy:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">def</span> <span class="nf">examine_axes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">xpos</span><span class="p">,</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">ypos</span><span class="p">,</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">zpos</span><span class="p">):</span>
    <span class="k">cdef</span> <span class="kt">double</span> <span class="kt">ax1</span>[3], <span class="kt">ax2</span>[3], <span class="kt">ax3</span>[3]
    <span class="k">cdef</span> <span class="kt">ParticleCollection</span> <span class="nf">particles</span>
    <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span>

    <span class="n">particles</span><span class="o">.</span><span class="n">npart</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xpos</span><span class="p">)</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">xpos</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span> <span class="n">malloc</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">npart</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">))</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">ypos</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span> <span class="n">malloc</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">npart</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">))</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">zpos</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span> <span class="n">malloc</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">npart</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">npart</span><span class="p">):</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">xpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">ypos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ypos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">zpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">zpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">calculate_axes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">particles</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span>

    <span class="n">free</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">xpos</span><span class="p">)</span>
    <span class="n">free</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">ypos</span><span class="p">)</span>
    <span class="n">free</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">zpos</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">ax1</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ax1</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ax1</span><span class="p">[</span><span class="mf">2</span><span class="p">]),</span>
             <span class="p">(</span><span class="n">ax2</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ax2</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ax2</span><span class="p">[</span><span class="mf">2</span><span class="p">]),</span>
             <span class="p">(</span><span class="n">ax3</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ax3</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ax3</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span> <span class="p">)</span>
</pre></div>
</div>
<p>This should be substantially faster, assuming you feed it arrays.</p>
<p>Now, there&#8217;s one last thing we can try.  If we know our function won&#8217;t modify
our arrays, and they are C-Contiguous, we can simply grab pointers to the data:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">def</span> <span class="nf">examine_axes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">xpos</span><span class="p">,</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">ypos</span><span class="p">,</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">zpos</span><span class="p">):</span>
    <span class="k">cdef</span> <span class="kt">double</span> <span class="kt">ax1</span>[3], <span class="kt">ax2</span>[3], <span class="kt">ax3</span>[3]
    <span class="k">cdef</span> <span class="kt">ParticleCollection</span> <span class="nf">particles</span>
    <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span>

    <span class="n">particles</span><span class="o">.</span><span class="n">npart</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xpos</span><span class="p">)</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">xpos</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span> <span class="n">xpos</span><span class="o">.</span><span class="n">data</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">ypos</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span> <span class="n">ypos</span><span class="o">.</span><span class="n">data</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">zpos</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span> <span class="n">zpos</span><span class="o">.</span><span class="n">data</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">npart</span><span class="p">):</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">xpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">ypos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ypos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">zpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">zpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">calculate_axes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">particles</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">ax1</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ax1</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ax1</span><span class="p">[</span><span class="mf">2</span><span class="p">]),</span>
             <span class="p">(</span><span class="n">ax2</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ax2</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ax2</span><span class="p">[</span><span class="mf">2</span><span class="p">]),</span>
             <span class="p">(</span><span class="n">ax3</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ax3</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ax3</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span> <span class="p">)</span>
</pre></div>
</div>
<p>But note!  This will break or do weird things if you feed it arrays that are
non-contiguous.</p>
<p>At this point, you should have a mostly working piece of wrapper code.  And it
was pretty easy!  Let us know if you run into any problems, or if you are
interested in distributing your code with yt.</p>
<p>A complete set of files is available with this documentation.  These are
slightly different, so that the whole thing will simply compile, but they
provide a useful example.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="../_static/axes.c">axes.c</a></li>
<li><a class="reference external" href="../_static/axes.h">axes.h</a></li>
<li><a class="reference external" href="../_static/axes_calculator.pyx">axes_calculator.pyx</a></li>
<li><a class="reference external" href="../_static/axes_calculator_setup.txt">axes_calculator_setup.py</a></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="exporting-data-from-yt">
<h2>Exporting Data from yt<a class="headerlink" href="#exporting-data-from-yt" title="Permalink to this headline">¶</a></h2>
<p>yt is installed alongside h5py.  If you need to export your data from yt, to
share it with people or to use it inside another code, h5py is a good way to do
so.  You can write out complete datasets with just a few commands.  You have to
import, and then save things out into a file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">h5py</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&quot;some_file.h5&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">some_data</span><span class="p">)</span>
</pre></div>
</div>
<p>This will create <tt class="docutils literal"><span class="pre">some_file.h5</span></tt> if necessary and add a new dataset
(<tt class="docutils literal"><span class="pre">/data</span></tt>) to it.  Writing out in ASCII should be relatively straightforward.
For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">halo</span> <span class="ow">in</span> <span class="n">halos</span><span class="p">:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">halo</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%0.2f</span><span class="s"> </span><span class="si">%0.2f</span><span class="s"> </span><span class="si">%0.2f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This example could be extended to work with any data object&#8217;s fields, as well.</p>
</div>
</div>


    </div>
      
  </div>
</div>
    <div class="footer">
      &copy; Copyright 2013, the yt Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>