<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Constructing Mock X-ray Observations &mdash; The yt Project 3.2-dev documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootswatch-3.3.4/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.2-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="The yt Project 3.2-dev documentation" href="../../index.html" />
    <link rel="up" title="Synthetic Observation" href="synthetic_observation.html" />
    <link rel="next" title="Creating Position-Position-Velocity FITS Cubes" href="ppv_cubes.html" />
    <link rel="prev" title="Mock Observations of the Sunyaev-Zeldovich Effect" href="sunyaev_zeldovich.html" />
    
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-391373-2']);
      _gaq.push(['_setDomainName', 'yt-project.org']);
      _gaq.push(['_setAllowHash', false]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><img src="../../_static/yt_icon.png">
          The yt Project</a>
        <span class="navbar-text navbar-version pull-left"><b>3.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../help/index.html">How to get help</a></li>
                <li><a href="../../quickstart/index.html">Quickstart notebooks</a></li>
                <li><a href="../../cookbook/index.html">Cookbook</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installing.html">Getting and Installing yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installing.html#getting-yt">Getting yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installing.html#testing-your-installation">Testing Your Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installing.html#switching-between-yt-2-x-and-yt-3-x">Switching between yt-2.x and yt-3.x</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">yt Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/data_inspection.html">Data Inspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/simple_visualization.html">Simple Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/data_objects_and_time_series.html">Data Objects and Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/derived_fields_and_profiles.html">Derived Fields and Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/volume_rendering.html">Volume Rendering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../yt3differences.html">What&#8217;s New and Different in yt 3.0?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../yt3differences.html#updating-to-yt-3-0-from-old-versions-and-going-back">Updating to yt 3.0 from Old Versions (and going back)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../yt3differences.html#converting-old-scripts-to-work-with-yt-3-0">Converting Old Scripts to Work with yt 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../yt3differences.html#cool-new-things">Cool New Things</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../yt3differences.html#api-changes">API Changes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cookbook/index.html">The Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook/index.html#getting-the-sample-data">Getting the Sample Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook/index.html#example-scripts">Example Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook/index.html#example-notebooks">Example Notebooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../visualizing/index.html">Visualizing Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/plots.html">How to Make Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/callbacks.html">Plot Modifications: Overplotting Contours, Velocities, Particles, and More</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/manual_plotting.html">Using the Manual Plotting Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/volume_rendering.html">Volume Rendering: Making 3D Photorealistic Isocontoured Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/hardware_volume_rendering.html">Hardware Volume Rendering on NVidia Graphics cards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/sketchfab.html">3D Surfaces and Sketchfab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/mapserver.html">Mapserver - A Google-Maps-like Interface to your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/streamlines.html">Streamlines: Tracking the Trajectories of Tracers in your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/colormaps/index.html">Colormaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/writing_fits_images.html">Writing FITS Images</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">General Data Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../fields.html">Fields in yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../objects.html">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../units/index.html">Symbolic Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filtering.html">Filtering your Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generating_processed_data.html">Generating Processed Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../time_series_analysis.html">Time Series Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parallel_computation.html">Parallel Computation With yt</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Topic-Specific Analysis Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="halo_analysis.html">Halo Analysis</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="synthetic_observation.html">Synthetic Observation</a></li>
<li class="toctree-l2"><a class="reference internal" href="exporting.html">Exporting to External Radiation Transport Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="two_point_functions.html">Two Point Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="clump_finding.html">Clump Finding</a></li>
<li class="toctree-l2"><a class="reference internal" href="particle_trajectories.html">Particle Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="ellipsoid_analysis.html">Halo Ellipsoid Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examining/index.html">Loading and Examining Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examining/loading_data.html">Loading Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examining/generic_array_data.html">Loading Generic Array Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examining/generic_particle_data.html">Loading Generic Particle Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examining/spherical_data.html">Loading Spherical Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examining/low_level_inspection.html">Low-Level Data Inspection: Accessing Raw Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developing/index.html">Developing in yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developing/intro.html">Getting Involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/developing.html">How to Develop yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/building_the_docs.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/debugdrive.html">Debugging yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_datatypes.html">Creating Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_derived_quantities.html">Creating Derived Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_frontend.html">Creating A New Code Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/external_analysis.html">Using yt with External Analysis Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference Materials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code_support.html">Code Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/command-line.html">Command-Line Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/api/api.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/configuration.html">Customizing yt: The Configuration and Plugin Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/field_list.html">Field List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/changelog.html">ChangeLog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#version-installation">Version &amp; Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#code-errors-and-failures">Code Errors and Failures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#units">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#fields">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#data-objects">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#developing">Developing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../help/index.html">Getting Help</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#don-t-panic-and-don-t-give-up">Don&#8217;t panic and don&#8217;t give up</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#update-to-the-latest-version">Update to the latest version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#search-the-documentation-faq-and-mailing-lists">Search the documentation, FAQ, and mailing lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#look-at-the-source-code">Look at the source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#isolate-and-document-your-problem">Isolate and document your problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#go-on-irc-to-ask-a-question">Go on IRC to ask a question</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#ask-the-mailing-list">Ask the mailing list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#submit-a-bug-report">Submit a bug report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#special-issues">Special Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#what-is-yt">What is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#who-is-yt">Who is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#history-of-yt">History of yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#how-do-i-contact-yt">How do I contact yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#how-do-i-cite-yt">How do I cite yt?</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Constructing Mock X-ray Observations</a><ul>
<li><a class="reference internal" href="#creating-an-x-ray-observation-of-a-dataset-on-disk">Creating an X-ray observation of a dataset on disk</a></li>
<li><a class="reference internal" href="#creating-a-x-ray-observation-from-an-in-memory-dataset">Creating a X-ray observation from an in-memory dataset</a></li>
<li><a class="reference internal" href="#storing-events-for-future-use-and-for-reading-in-by-telescope-simulators">Storing events for future use and for reading-in by telescope simulators</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="constructing-mock-x-ray-observations">
<h1>Constructing Mock X-ray Observations<a class="headerlink" href="#constructing-mock-x-ray-observations" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you just want to create derived fields for X-ray emission,
you should go <a class="reference external" href="xray_emission_fields.html">here</a> instead.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">photon_simulator</span></code> analysis module enables the creation of
simulated X-ray photon lists of events from datasets that yt is able
to read. The simulated events then can be exported to X-ray telescope
simulators to produce realistic observations or can be analyzed in-line.
The algorithm is based off of that implemented in
<a class="reference external" href="http://www.mpa-garching.mpg.de/~kdolag/Phox/">PHOX</a> for SPH datasets
by Veronica Biffi and Klaus Dolag. There are two relevant papers:</p>
<p><a class="reference external" href="http://adsabs.harvard.edu/abs/2012MNRAS.420.3545B">Biffi, V., Dolag, K., Bohringer, H., &amp; Lemson, G. 2012, MNRAS, 420,
3545</a></p>
<p><a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.428.1395B">Biffi, V., Dolag, K., Bohringer, H. 2013, MNRAS, 428,
1395</a></p>
<p>The basic procedure is as follows:</p>
<ol class="arabic simple">
<li>Using a spectral model for the photon flux given the gas properties,
and an algorithm for generating photons from the dataset loaded in
yt, produce a large number of photons in three-dimensional space
associated with the cells of the dataset.</li>
<li>Use this three-dimensional dataset as a sample from which to generate
photon events that are projected along a line of sight, Doppler and
cosmologically shifted, and absorbed by the Galactic foreground.</li>
<li>Optionally convolve these photons with instrument responses and
produce images and spectra.</li>
</ol>
<p>We&#8217;ll demonstrate the functionality on a realistic dataset of a galaxy
cluster to get you started.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently, the <code class="docutils literal"><span class="pre">photon_simulator</span></code> analysis module only works with grid-based
data.</p>
</div>
<div class="section" id="creating-an-x-ray-observation-of-a-dataset-on-disk">
<h2>Creating an X-ray observation of a dataset on disk<a class="headerlink" href="#creating-an-x-ray-observation-of-a-dataset-on-disk" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="c">#yt.enable_parallelism() # If you want to run in parallel this should go here!</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.photon_simulator.api</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">yt.utilities.cosmology</span> <span class="kn">import</span> <span class="n">Cosmology</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For parallel runs using <code class="docutils literal"><span class="pre">mpi4py</span></code>, the call to <code class="docutils literal"><span class="pre">yt.enable_parallelism</span></code> should go <em>before</em>
the import of the <code class="docutils literal"><span class="pre">photon_simulator</span></code> module, as shown above.</p>
</div>
<p>We&#8217;re going to load up an Athena dataset of a galaxy cluster core:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;MHDSloshing/virgo_low_res.0054.vtk&quot;</span><span class="p">,</span>
             <span class="n">units_override</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;time_unit&quot;</span><span class="p">:(</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&quot;Myr&quot;</span><span class="p">),</span>
                             <span class="s">&quot;length_unit&quot;</span><span class="p">:(</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&quot;Mpc&quot;</span><span class="p">),</span>
                             <span class="s">&quot;mass_unit&quot;</span><span class="p">:(</span><span class="mf">1.0e14</span><span class="p">,</span><span class="s">&quot;Msun&quot;</span><span class="p">)})</span>
</pre></div>
</div>
<p>First, to get a sense of what the resulting image will look like, let&#8217;s
make a new yt field called <code class="docutils literal"><span class="pre">&quot;density_squared&quot;</span></code>, since the X-ray
emission is proportional to <img class="math" src="../../_images/math/8c72784def35b27688bdf64672b954c6fbe9089c.png" alt="\rho^2"/>, and a weak function of
temperature and metallicity.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">_density_squared</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">ds</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s">&quot;density_squared&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">_density_squared</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&quot;g**2/cm**6&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we&#8217;ll project this field along the z-axis.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">prj</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">ProjectionPlot</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;density_squared&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mf">500.</span><span class="p">,</span> <span class="s">&quot;kpc&quot;</span><span class="p">))</span>
<span class="n">prj</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="s">&quot;density_squared&quot;</span><span class="p">,</span> <span class="s">&quot;gray_r&quot;</span><span class="p">)</span>
<span class="n">prj</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/dsquared.png" src="../../_images/dsquared.png" />
<p>In this simulation the core gas is sloshing, producing spiral-shaped
cold fronts.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To work out the following examples, you should install
<a class="reference external" href="http://www.atomdb.org">AtomDB</a> and get the files from the
<a class="reference external" href="http://yt-project.org/data/xray_data.tar.gz">xray_data</a> auxiliary
data package (see the <code class="docutils literal"><span class="pre">xray_data</span></code> <a class="reference external" href="xray_data_README.html">README</a>
for details on the latter). Make sure that
in what follows you specify the full path to the locations of these
files.</p>
</div>
<p>To generate photons from this dataset, we have several different things
we need to set up. The first is a standard yt data object. It could
be all of the cells in the domain, a rectangular solid region, a
cylindrical region, etc. Let&#8217;s keep it simple and make a sphere at the
center of the domain, with a radius of 250 kpc:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">sp</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">250.</span><span class="p">,</span> <span class="s">&quot;kpc&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This will serve as our <code class="docutils literal"><span class="pre">data_source</span></code> that we will use later. Next, we
need to create the <code class="docutils literal"><span class="pre">SpectralModel</span></code> instance that will determine how
the data in the grid cells will generate photons. By default, two
options are available. The first, <code class="docutils literal"><span class="pre">XSpecThermalModel</span></code>, allows one to
use any thermal model that is known to
<a class="reference external" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/">XSPEC</a>, such as
<code class="docutils literal"><span class="pre">&quot;mekal&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;apec&quot;</span></code>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">mekal_model</span> <span class="o">=</span> <span class="n">XSpecThermalModel</span><span class="p">(</span><span class="s">&quot;mekal&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
<p>This requires XSPEC and
<a class="reference external" href="http://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/">PyXspec</a> to
be installed. The second option, <code class="docutils literal"><span class="pre">TableApecModel</span></code>, utilizes the data
from the <a class="reference external" href="http://www.atomdb.org">AtomDB</a> tables. We&#8217;ll use this one
here:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">apec_model</span> <span class="o">=</span> <span class="n">TableApecModel</span><span class="p">(</span><span class="s">&quot;atomdb_v2.0.2&quot;</span><span class="p">,</span>
                            <span class="mf">0.01</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span>
                            <span class="n">thermal_broad</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">apec_vers</span><span class="o">=</span><span class="s">&quot;2.0.2&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The first argument sets the location of the AtomDB files, and the next
three arguments determine the minimum energy in keV, maximum energy in
keV, and the number of linearly-spaced bins to bin the spectrum in. If
the optional keyword <code class="docutils literal"><span class="pre">thermal_broad</span></code> is set to <code class="docutils literal"><span class="pre">True</span></code>, the spectral
lines will be thermally broadened.</p>
<p>Now that we have our <code class="docutils literal"><span class="pre">SpectralModel</span></code> that gives us a spectrum, we need
to connect this model to a <code class="docutils literal"><span class="pre">PhotonModel</span></code> that will connect the field
data in the <code class="docutils literal"><span class="pre">data_source</span></code> to the spectral model to actually generate
photons. For thermal spectra, we have a special <code class="docutils literal"><span class="pre">PhotonModel</span></code> called
<code class="docutils literal"><span class="pre">ThermalPhotonModel</span></code>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">thermal_model</span> <span class="o">=</span> <span class="n">ThermalPhotonModel</span><span class="p">(</span><span class="n">apec_model</span><span class="p">,</span> <span class="n">X_H</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">Zmet</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                                   <span class="n">photons_per_chunk</span><span class="o">=</span><span class="mi">100000000</span><span class="p">)</span>
</pre></div>
</div>
<p>Where we pass in the <code class="docutils literal"><span class="pre">SpectralModel</span></code>, and can optionally set values for
the hydrogen mass fraction <code class="docutils literal"><span class="pre">X_H</span></code> and metallicity <code class="docutils literal"><span class="pre">Z_met</span></code>. If
<code class="docutils literal"><span class="pre">Z_met</span></code> is a float, it will assume that value for the metallicity
everywhere in terms of the solar metallicity. If it is a string, it will
assume that is the name of the metallicity field (which may be spatially
varying).</p>
<p>The <code class="docutils literal"><span class="pre">ThermalPhotonModel</span></code> iterates over &#8220;chunks&#8221; of the supplied data source
to generate the photons, to reduce memory usage and make parallelization more
efficient. For each chunk, memory is set aside for the photon energies that will
be generated. <code class="docutils literal"><span class="pre">photons_per_chunk</span></code> is an optional keyword argument which controls
the size of this array. For large numbers of photons, you may find that
this parameter needs to be set higher, or if you are looking to decrease memory
usage, you might set this parameter lower.</p>
<p>Next, we need to specify &#8220;fiducial&#8221; values for the telescope collecting
area, exposure time, and cosmological redshift. Remember, the initial
photon generation will act as a source for Monte-Carlo sampling for more
realistic values of these parameters later, so choose generous values so
that you have a large number of photons to sample from. We will also
construct a <code class="docutils literal"><span class="pre">Cosmology</span></code> object:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">A</span> <span class="o">=</span> <span class="mf">6000.</span>
<span class="n">exp_time</span> <span class="o">=</span> <span class="mf">4.0e5</span>
<span class="n">redshift</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">cosmo</span> <span class="o">=</span> <span class="n">Cosmology</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, we finally combine everything together and create a <code class="docutils literal"><span class="pre">PhotonList</span></code>
instance:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">photons</span> <span class="o">=</span> <span class="n">PhotonList</span><span class="o">.</span><span class="n">from_scratch</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">redshift</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">exp_time</span><span class="p">,</span>
                                  <span class="n">thermal_model</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">,</span>
                                  <span class="n">cosmology</span><span class="o">=</span><span class="n">cosmo</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, the angular diameter distance to the object is determined
from the <code class="docutils literal"><span class="pre">cosmology</span></code> and the cosmological <code class="docutils literal"><span class="pre">redshift</span></code>. If a
<code class="docutils literal"><span class="pre">Cosmology</span></code> instance is not provided, one will be made from the
default cosmological parameters. If your source is local to the galaxy,
you can set its distance directly, using a tuple, e.g.
<code class="docutils literal"><span class="pre">dist=(30,</span> <span class="pre">&quot;kpc&quot;)</span></code>. In this case, the <code class="docutils literal"><span class="pre">redshift</span></code> and <code class="docutils literal"><span class="pre">cosmology</span></code>
will be ignored. Finally, if the photon generating function accepts any
parameters, they can be passed to <code class="docutils literal"><span class="pre">from_scratch</span></code> via a <code class="docutils literal"><span class="pre">parameters</span></code>
dictionary.</p>
<p>At this point, the <code class="docutils literal"><span class="pre">photons</span></code> are distributed in the three-dimensional
space of the <code class="docutils literal"><span class="pre">data_source</span></code>, with energies in the rest frame of the
plasma. Doppler and/or cosmological shifting of the photons will be
applied in the next step.</p>
<p>The <code class="docutils literal"><span class="pre">photons</span></code> can be saved to disk in an HDF5 file:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">photons</span><span class="o">.</span><span class="n">write_h5_file</span><span class="p">(</span><span class="s">&quot;my_photons.h5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Which is most useful if it takes a long time to generate the photons,
because a <code class="docutils literal"><span class="pre">PhotonList</span></code> can be created in-memory from the dataset
stored on disk:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">photons</span> <span class="o">=</span> <span class="n">PhotonList</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s">&quot;my_photons.h5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This enables one to make many simulated event sets, along different
projections, at different redshifts, with different exposure times, and
different instruments, with the same <code class="docutils literal"><span class="pre">data_source</span></code>, without having to
do the expensive step of generating the photons all over again!</p>
<p>To get a set of photon events such as that observed by X-ray telescopes,
we need to take the three-dimensional photon distribution and project it
along a line of sight. Also, this is the step at which we put in the
realistic values for the telescope collecting area, cosmological
redshift and/or source distance, and exposure time. The order of
operations goes like this:</p>
<ol class="arabic simple">
<li>From the adjusted exposure time, redshift and/or source distance, and
telescope collecting area, determine the number of photons we will
<em>actually</em> observe.</li>
<li>Determine the plane of projection from the supplied normal vector,
and reproject the photon positions onto this plane.</li>
<li>Doppler-shift the photon energies according to the velocity along the
line of sight, and apply cosmological redshift if the source is not
local.</li>
<li>Optionally, alter the received distribution of photons via an
energy-dependent galactic absorption model.</li>
<li>Optionally, alter the received distribution of photons using an
effective area curve provided from an ancillary response file (ARF).</li>
<li>Optionally, scatter the photon energies into channels according to
the information from a redistribution matrix file (RMF).</li>
</ol>
<p>First, if we want to apply galactic absorption, we need to set up a
spectral model for the absorption coefficient, similar to the spectral
model for the emitted photons we set up before. Here again, we have two
options. The first, <code class="docutils literal"><span class="pre">XSpecAbsorbModel</span></code>, allows one to use any
absorption model that XSpec is aware of that takes only the Galactic
column density <img class="math" src="../../_images/math/adfee1edff0cd05931662b0ee8215a513c3c6bd8.png" alt="N_H"/> as input:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">N_H</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">abs_model</span> <span class="o">=</span> <span class="n">XSpecAbsorbModel</span><span class="p">(</span><span class="s">&quot;wabs&quot;</span><span class="p">,</span> <span class="n">N_H</span><span class="p">)</span>
</pre></div>
</div>
<p>The second option, <code class="docutils literal"><span class="pre">TableAbsorbModel</span></code>, takes as input an HDF5 file
containing two datasets, <code class="docutils literal"><span class="pre">&quot;energy&quot;</span></code> (in keV), and <code class="docutils literal"><span class="pre">&quot;cross_section&quot;</span></code>
(in cm2), and the Galactic column density <img class="math" src="../../_images/math/adfee1edff0cd05931662b0ee8215a513c3c6bd8.png" alt="N_H"/>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">abs_model</span> <span class="o">=</span> <span class="n">TableAbsorbModel</span><span class="p">(</span><span class="s">&quot;tbabs_table.h5&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we&#8217;re ready to project the photons. First, we choose a line-of-sight
vector <code class="docutils literal"><span class="pre">L</span></code>. Second, we&#8217;ll adjust the exposure time and the redshift.
Third, we&#8217;ll pass in the absorption <code class="docutils literal"><span class="pre">SpectrumModel</span></code>. Fourth, we&#8217;ll
specify a <code class="docutils literal"><span class="pre">sky_center</span></code> in RA,DEC on the sky in degrees.</p>
<p>Also, we&#8217;re going to convolve the photons with instrument <code class="docutils literal"><span class="pre">responses</span></code>.
For this, you need a ARF/RMF pair with matching energy bins. This is of
course far short of a full simulation of a telescope ray-trace, but it&#8217;s
a quick-and-dirty way to get something close to the real thing. We&#8217;ll
discuss how to get your simulated events into a format suitable for
reading by telescope simulation codes later.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">ARF</span> <span class="o">=</span> <span class="s">&quot;chandra_ACIS-S3_onaxis_arf.fits&quot;</span>
<span class="n">RMF</span> <span class="o">=</span> <span class="s">&quot;chandra_ACIS-S3_onaxis_rmf.fits&quot;</span>
<span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">photons</span><span class="o">.</span><span class="n">project_photons</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">exp_time_new</span><span class="o">=</span><span class="mf">2.0e5</span><span class="p">,</span> <span class="n">redshift_new</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">absorb_model</span><span class="o">=</span><span class="n">abs_model</span><span class="p">,</span>
                                 <span class="n">sky_center</span><span class="o">=</span><span class="p">(</span><span class="mf">187.5</span><span class="p">,</span><span class="mf">12.333</span><span class="p">),</span> <span class="n">responses</span><span class="o">=</span><span class="p">[</span><span class="n">ARF</span><span class="p">,</span><span class="n">RMF</span><span class="p">])</span>
</pre></div>
</div>
<p>Also, the optional keyword <code class="docutils literal"><span class="pre">psf_sigma</span></code> specifies a Gaussian standard
deviation to scatter the photon sky positions around with, providing a
crude representation of a PSF.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The binned images that result, even if you convolve with responses,
are still of the same resolution as the finest cell size of the
simulation dataset. If you want a more accurate simulation of a
particular X-ray telescope, you should check out <a class="reference internal" href="#storing-events-for-future-use-and-for-reading-in-by-telescope-simulators">Storing events for future use and for reading-in by telescope simulators</a>.</p>
</div>
<p>Let&#8217;s just take a quick look at the raw events object:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">events</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>{&#39;eobs&#39;: YTArray([  0.32086522,   0.32271389,   0.32562708, ...,   8.90600621,
         9.73534237,  10.21614256]) keV,
 &#39;xsky&#39;: YTArray([ 187.5177707 ,  187.4887825 ,  187.50733609, ...,  187.5059345 ,
        187.49897546,  187.47307048]) degree,
 &#39;ysky&#39;: YTArray([ 12.33519996,  12.3544496 ,  12.32750903, ...,  12.34907707,
        12.33327653,  12.32955225]) degree,
 &#39;ypix&#39;: array([ 133.85374195,  180.68583074,  115.14110561, ...,  167.61447493,
        129.17278711,  120.11508562]),
 &#39;PI&#39;: array([ 27,  15,  25, ..., 609, 611, 672]),
 &#39;xpix&#39;: array([  86.26331108,  155.15934197,  111.06337043, ...,  114.39586907,
        130.93509652,  192.50639633])}
</pre></div>
</div>
<p>We can bin up the events into an image and save it to a FITS file. The
pixel size of the image is equivalent to the smallest cell size from the
original dataset. We can specify limits for the photon energies to be
placed in the image:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">events</span><span class="o">.</span><span class="n">write_fits_image</span><span class="p">(</span><span class="s">&quot;sloshing_image.fits&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">emin</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">7.0</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting FITS image will have WCS coordinates in RA and Dec. It
should be suitable for plotting in
<a class="reference external" href="http://hea-www.harvard.edu/RD/ds9/site/Home.html">ds9</a>, for example.
There is also a great project for opening astronomical images in Python,
called <a class="reference external" href="http://aplpy.github.io">APLpy</a>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">aplpy</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">aplpy</span><span class="o">.</span><span class="n">FITSFigure</span><span class="p">(</span><span class="s">&quot;sloshing_image.fits&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show_colorscale</span><span class="p">(</span><span class="n">stretch</span><span class="o">=</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;gray_r&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_axis_labels_font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s">&quot;serif&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_tick_labels_font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s">&quot;serif&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/Photon_Simulator_30_4.png" src="../../_images/Photon_Simulator_30_4.png" />
<p>Which is starting to look like a real observation!</p>
<p>We can also bin up the spectrum into energy bins, and write it to a FITS
table file. This is an example where we&#8217;ve binned up the spectrum
according to the unconvolved photon energy:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">events</span><span class="o">.</span><span class="n">write_spectrum</span><span class="p">(</span><span class="s">&quot;virgo_spec.fits&quot;</span><span class="p">,</span> <span class="n">energy_bins</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">emin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">nchan</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>If we don&#8217;t set <code class="docutils literal"><span class="pre">energy_bins=True</span></code>, and we have convolved our events
with response files, then any other keywords will be ignored and it will
try to make a spectrum from the channel information that is contained
within the RMF, suitable for analyzing in XSPEC. For now, we&#8217;ll stick
with the energy spectrum, and plot it up:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">astropy.io.fits</span> <span class="kn">as</span> <span class="nn">pyfits</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;virgo_spec.fits&quot;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s">&quot;SPECTRUM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;ENERGY&quot;</span><span class="p">),</span> <span class="n">f</span><span class="p">[</span><span class="s">&quot;SPECTRUM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;COUNTS&quot;</span><span class="p">))</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;E (keV)&quot;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;counts/bin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/Photon_Simulator_34_1.png" src="../../_images/Photon_Simulator_34_1.png" />
<p>We can also write the events to a FITS file that is of a format that can
be manipulated by software packages like
<a class="reference external" href="http://cxc.harvard.edu/ciao/">CIAO</a> and read in by ds9 to do more
standard X-ray analysis:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">events</span><span class="o">.</span><span class="n">write_fits_file</span><span class="p">(</span><span class="s">&quot;my_events.fits&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">We&#8217;ve done some very low-level testing of this feature, and
it seems to work, but it may not be consistent with standard FITS events
files in subtle ways that we haven&#8217;t been able to identify. Please email
<a class="reference external" href="mailto:jzuhone&#37;&#52;&#48;gmail&#46;com">jzuhone<span>&#64;</span>gmail<span>&#46;</span>com</a> if you find any bugs!</p>
</div>
<p>Two <code class="docutils literal"><span class="pre">EventList</span></code> instances can be added together, which is useful if they were
created using different data sources:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">events3</span> <span class="o">=</span> <span class="n">events1</span><span class="o">+</span><span class="n">events2</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This only works if the two event lists were generated using
the same parameters!</p>
</div>
<p>Finally, a new <code class="docutils literal"><span class="pre">EventList</span></code> can be created from a subset of an existing <code class="docutils literal"><span class="pre">EventList</span></code>,
defined by a ds9 region (this functionality requires the
<a class="reference external" href="http://pyregion.readthedocs.org">pyregion</a> package to be installed):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">circle_events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">filter_events</span><span class="p">(</span><span class="s">&quot;circle.reg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-x-ray-observation-from-an-in-memory-dataset">
<h2>Creating a X-ray observation from an in-memory dataset<a class="headerlink" href="#creating-a-x-ray-observation-from-an-in-memory-dataset" title="Permalink to this headline">¶</a></h2>
<p>It may be useful, especially for observational applications, to create
datasets in-memory and then create simulated observations from
them. Here is a relevant example of creating a toy cluster and evacuating two AGN-blown bubbles in it.</p>
<p>First, we create the in-memory dataset (see <a class="reference internal" href="../../examining/generic_array_data.html#loading-numpy-array"><span>Loading Generic Array Data</span></a>
for details on how to do this):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">from</span> <span class="nn">yt.utilities.physical_constants</span> <span class="kn">import</span> <span class="n">cm_per_kpc</span><span class="p">,</span> <span class="n">K_per_keV</span><span class="p">,</span> <span class="n">mp</span>
<span class="kn">from</span> <span class="nn">yt.utilities.cosmology</span> <span class="kn">import</span> <span class="n">Cosmology</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.photon_simulator.api</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">aplpy</span>

<span class="n">R</span> <span class="o">=</span> <span class="mf">1000.</span> <span class="c"># in kpc</span>
<span class="n">r_c</span> <span class="o">=</span> <span class="mf">100.</span> <span class="c"># in kpc</span>
<span class="n">rho_c</span> <span class="o">=</span> <span class="mf">1.673e-26</span> <span class="c"># in g/cm^3</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">4.</span> <span class="c"># in keV</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">256</span>

<span class="n">bub_rad</span> <span class="o">=</span> <span class="mf">30.0</span>
<span class="n">bub_dist</span> <span class="o">=</span> <span class="mf">50.0</span>

<span class="n">ddims</span> <span class="o">=</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="n">R</span><span class="p">:</span><span class="n">R</span><span class="p">:</span><span class="n">nx</span><span class="o">*</span><span class="mi">1j</span><span class="p">,</span>
                   <span class="o">-</span><span class="n">R</span><span class="p">:</span><span class="n">R</span><span class="p">:</span><span class="n">nx</span><span class="o">*</span><span class="mi">1j</span><span class="p">,</span>
                   <span class="o">-</span><span class="n">R</span><span class="p">:</span><span class="n">R</span><span class="p">:</span><span class="n">nx</span><span class="o">*</span><span class="mi">1j</span><span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ddims</span><span class="p">)</span>
<span class="n">dens</span><span class="p">[</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">R</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho_c</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">R</span><span class="p">]</span><span class="o">/</span><span class="n">r_c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
<span class="n">dens</span><span class="p">[</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">R</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">T</span><span class="o">*</span><span class="n">K_per_keV</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ddims</span><span class="p">)</span>
<span class="n">rbub1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">bub_rad</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">rbub2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">bub_rad</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">dens</span><span class="p">[</span><span class="n">rbub1</span> <span class="o">&lt;=</span> <span class="n">bub_rad</span><span class="p">]</span> <span class="o">/=</span> <span class="mf">100.</span>
<span class="n">dens</span><span class="p">[</span><span class="n">rbub2</span> <span class="o">&lt;=</span> <span class="n">bub_rad</span><span class="p">]</span> <span class="o">/=</span> <span class="mf">100.</span>
<span class="n">temp</span><span class="p">[</span><span class="n">rbub1</span> <span class="o">&lt;=</span> <span class="n">bub_rad</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">100.</span>
<span class="n">temp</span><span class="p">[</span><span class="n">rbub2</span> <span class="o">&lt;=</span> <span class="n">bub_rad</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">100.</span>
</pre></div>
</div>
<p>This created a cluster with a radius of 1 Mpc, a uniform temperature
of 4 keV, and a density distribution from a <img class="math" src="../../_images/math/8ce03f78ed945f2ef3dac87c8799b55b393527e7.png" alt="\beta"/>-model. We then
evacuated two &#8220;bubbles&#8221; of radius 30 kpc at a distance of 50 kpc from
the center.</p>
<p>Now, we create a yt Dataset object out of this dataset:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">data</span><span class="p">[</span><span class="s">&quot;density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="s">&quot;g/cm**3&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="s">&quot;K&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s">&quot;velocity_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ddims</span><span class="p">),</span> <span class="s">&quot;cm/s&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s">&quot;velocity_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ddims</span><span class="p">),</span> <span class="s">&quot;cm/s&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s">&quot;velocity_z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ddims</span><span class="p">),</span> <span class="s">&quot;cm/s&quot;</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]])</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load_uniform_grid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ddims</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">cm_per_kpc</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span>
</pre></div>
</div>
<p>where for simplicity we have set the velocities to zero, though we
could have created a realistic velocity field as well. Now, we
generate the photon and event lists in the same way as the previous
example:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">sphere</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&quot;Mpc&quot;</span><span class="p">))</span>

<span class="n">A</span> <span class="o">=</span> <span class="mf">6000.</span>
<span class="n">exp_time</span> <span class="o">=</span> <span class="mf">2.0e5</span>
<span class="n">redshift</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">cosmo</span> <span class="o">=</span> <span class="n">Cosmology</span><span class="p">()</span>

<span class="n">apec_model</span> <span class="o">=</span> <span class="n">TableApecModel</span><span class="p">(</span><span class="s">&quot;/Users/jzuhone/Data/atomdb_v2.0.2&quot;</span><span class="p">,</span>
                            <span class="mf">0.01</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mi">20000</span><span class="p">)</span>
<span class="n">abs_model</span> <span class="o">=</span> <span class="n">TableAbsorbModel</span><span class="p">(</span><span class="s">&quot;tbabs_table.h5&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">thermal_model</span> <span class="o">=</span> <span class="n">ThermalPhotonModel</span><span class="p">(</span><span class="n">apec_model</span><span class="p">)</span>
<span class="n">photons</span> <span class="o">=</span> <span class="n">PhotonList</span><span class="o">.</span><span class="n">from_scratch</span><span class="p">(</span><span class="n">sphere</span><span class="p">,</span> <span class="n">redshift</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span>
                                  <span class="n">exp_time</span><span class="p">,</span> <span class="n">thermal_model</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">)</span>


<span class="n">events</span> <span class="o">=</span> <span class="n">photons</span><span class="o">.</span><span class="n">project_photons</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
                                 <span class="n">responses</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;sim_arf.fits&quot;</span><span class="p">,</span><span class="s">&quot;sim_rmf.fits&quot;</span><span class="p">],</span>
                                 <span class="n">absorb_model</span><span class="o">=</span><span class="n">abs_model</span><span class="p">)</span>

<span class="n">events</span><span class="o">.</span><span class="n">write_fits_image</span><span class="p">(</span><span class="s">&quot;img.fits&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>which yields the following image:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">aplpy</span><span class="o">.</span><span class="n">FITSFigure</span><span class="p">(</span><span class="s">&quot;img.fits&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show_colorscale</span><span class="p">(</span><span class="n">stretch</span><span class="o">=</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">600.</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;jet&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_axis_labels_font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s">&quot;serif&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_tick_labels_font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s">&quot;serif&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/bubbles.png"><img alt="../../_images/bubbles.png" src="../../_images/bubbles.png" style="width: 80%;" /></a>
</div>
<div class="section" id="storing-events-for-future-use-and-for-reading-in-by-telescope-simulators">
<h2>Storing events for future use and for reading-in by telescope simulators<a class="headerlink" href="#storing-events-for-future-use-and-for-reading-in-by-telescope-simulators" title="Permalink to this headline">¶</a></h2>
<p>If you want a more accurate representation of an observation taken by a
particular instrument, there are tools available for such purposes. For
the <em>Chandra</em> telescope, there is the venerable
<a class="reference external" href="http://space.mit.edu/ASC/MARX/">MARX</a>. For a wide range of
instruments, both existing and future, there is
<a class="reference external" href="http://hea-www.harvard.edu/simx/">SIMX</a>. We&#8217;ll discuss two ways
to store your event files so that they can be input by these and other
codes.</p>
<p>The first option is the most general, and the simplest: simply dump the
event data to an HDF5 file:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">events</span><span class="o">.</span><span class="n">write_h5_file</span><span class="p">(</span><span class="s">&quot;my_events.h5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will dump the raw event data, as well as the associated parameters,
into the file. If you want to read these events back in, it&#8217;s just as
simple:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">events</span> <span class="o">=</span> <span class="n">EventList</span><span class="o">.</span><span class="n">from_h5_file</span><span class="p">(</span><span class="s">&quot;my_events.h5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can use event data written to HDF5 files to input events into MARX
using <a class="reference external" href="http://bitbucket.org/jzuhone/yt_marx_source">this code</a>.</p>
<p>The second option, for use with SIMX, is to dump the events into a
SIMPUT file:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">events</span><span class="o">.</span><span class="n">write_simput_file</span><span class="p">(</span><span class="s">&quot;my_events&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">emin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
</pre></div>
</div>
<p>which will write two files, <code class="docutils literal"><span class="pre">&quot;my_events_phlist.fits&quot;</span></code> and
<code class="docutils literal"><span class="pre">&quot;my_events_simput.fits&quot;</span></code>, the former being a auxiliary file for the
latter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can only write SIMPUT files if you didn&#8217;t convolve
the photons with responses, since the idea is to pass unconvolved
photons to the telescope simulator.</p>
</div>
<p>The following images were made from the same yt-generated events in both MARX and
SIMX. They are 200 ks observations of the two example clusters from above
(the Chandra images have been reblocked by a factor of 4):</p>
<img alt="../../_images/ds9_sloshing.png" src="../../_images/ds9_sloshing.png" />
<img alt="../../_images/ds9_bubbles.png" src="../../_images/ds9_bubbles.png" />
</div>
</div>


    </div>
      
  </div>
</div>
    <div class="footer">
      &copy; Copyright 2013, the yt Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>