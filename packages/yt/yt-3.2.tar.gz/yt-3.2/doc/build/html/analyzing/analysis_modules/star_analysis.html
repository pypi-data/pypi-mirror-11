<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Star Particle Analysis &mdash; The yt Project 3.2-dev documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootswatch-3.3.4/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.2-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="The yt Project 3.2-dev documentation" href="../../index.html" />
    <link rel="up" title="Synthetic Observation" href="synthetic_observation.html" />
    <link rel="next" title="X-ray Emission Fields" href="xray_emission_fields.html" />
    <link rel="prev" title="Absorption Spectrum" href="absorption_spectrum.html" />
    
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-391373-2']);
      _gaq.push(['_setDomainName', 'yt-project.org']);
      _gaq.push(['_setAllowHash', false]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><img src="../../_static/yt_icon.png">
          The yt Project</a>
        <span class="navbar-text navbar-version pull-left"><b>3.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../help/index.html">How to get help</a></li>
                <li><a href="../../quickstart/index.html">Quickstart notebooks</a></li>
                <li><a href="../../cookbook/index.html">Cookbook</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installing.html">Getting and Installing yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installing.html#getting-yt">Getting yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installing.html#testing-your-installation">Testing Your Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installing.html#switching-between-yt-2-x-and-yt-3-x">Switching between yt-2.x and yt-3.x</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">yt Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/data_inspection.html">Data Inspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/simple_visualization.html">Simple Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/data_objects_and_time_series.html">Data Objects and Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/derived_fields_and_profiles.html">Derived Fields and Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/volume_rendering.html">Volume Rendering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../yt3differences.html">What&#8217;s New and Different in yt 3.0?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../yt3differences.html#updating-to-yt-3-0-from-old-versions-and-going-back">Updating to yt 3.0 from Old Versions (and going back)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../yt3differences.html#converting-old-scripts-to-work-with-yt-3-0">Converting Old Scripts to Work with yt 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../yt3differences.html#cool-new-things">Cool New Things</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../yt3differences.html#api-changes">API Changes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cookbook/index.html">The Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook/index.html#getting-the-sample-data">Getting the Sample Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook/index.html#example-scripts">Example Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook/index.html#example-notebooks">Example Notebooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../visualizing/index.html">Visualizing Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/plots.html">How to Make Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/callbacks.html">Plot Modifications: Overplotting Contours, Velocities, Particles, and More</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/manual_plotting.html">Using the Manual Plotting Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/volume_rendering.html">Volume Rendering: Making 3D Photorealistic Isocontoured Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/hardware_volume_rendering.html">Hardware Volume Rendering on NVidia Graphics cards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/sketchfab.html">3D Surfaces and Sketchfab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/mapserver.html">Mapserver - A Google-Maps-like Interface to your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/streamlines.html">Streamlines: Tracking the Trajectories of Tracers in your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/colormaps/index.html">Colormaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualizing/writing_fits_images.html">Writing FITS Images</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">General Data Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../fields.html">Fields in yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../objects.html">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../units/index.html">Symbolic Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filtering.html">Filtering your Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generating_processed_data.html">Generating Processed Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../time_series_analysis.html">Time Series Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parallel_computation.html">Parallel Computation With yt</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Topic-Specific Analysis Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="halo_analysis.html">Halo Analysis</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="synthetic_observation.html">Synthetic Observation</a></li>
<li class="toctree-l2"><a class="reference internal" href="exporting.html">Exporting to External Radiation Transport Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="two_point_functions.html">Two Point Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="clump_finding.html">Clump Finding</a></li>
<li class="toctree-l2"><a class="reference internal" href="particle_trajectories.html">Particle Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="ellipsoid_analysis.html">Halo Ellipsoid Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examining/index.html">Loading and Examining Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examining/loading_data.html">Loading Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examining/generic_array_data.html">Loading Generic Array Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examining/generic_particle_data.html">Loading Generic Particle Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examining/spherical_data.html">Loading Spherical Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examining/low_level_inspection.html">Low-Level Data Inspection: Accessing Raw Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developing/index.html">Developing in yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developing/intro.html">Getting Involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/developing.html">How to Develop yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/building_the_docs.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/debugdrive.html">Debugging yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_datatypes.html">Creating Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_derived_fields.html">Creating Derived Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_derived_quantities.html">Creating Derived Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/creating_frontend.html">Creating A New Code Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/external_analysis.html">Using yt with External Analysis Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference Materials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code_support.html">Code Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/command-line.html">Command-Line Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/api/api.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/configuration.html">Customizing yt: The Configuration and Plugin Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/field_list.html">Field List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/changelog.html">ChangeLog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#version-installation">Version &amp; Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#code-errors-and-failures">Code Errors and Failures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#units">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#fields">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#data-objects">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#developing">Developing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/index.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../help/index.html">Getting Help</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#don-t-panic-and-don-t-give-up">Don&#8217;t panic and don&#8217;t give up</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#update-to-the-latest-version">Update to the latest version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#search-the-documentation-faq-and-mailing-lists">Search the documentation, FAQ, and mailing lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#look-at-the-source-code">Look at the source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#isolate-and-document-your-problem">Isolate and document your problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#go-on-irc-to-ask-a-question">Go on IRC to ask a question</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#ask-the-mailing-list">Ask the mailing list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#submit-a-bug-report">Submit a bug report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help/index.html#special-issues">Special Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About yt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#what-is-yt">What is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#who-is-yt">Who is yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#history-of-yt">History of yt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#how-do-i-contact-yt">How do I contact yt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#how-do-i-cite-yt">How do I cite yt?</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Star Particle Analysis</a><ul>
<li><a class="reference internal" href="#star-formation-rate">Star Formation Rate</a></li>
<li><a class="reference internal" href="#synthetic-spectrum-generator">Synthetic Spectrum Generator</a><ul>
<li><a class="reference internal" href="#iterate-over-a-number-of-halos">Iterate Over a Number of Halos</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="star-particle-analysis">
<span id="star-analysis"></span><h1>Star Particle Analysis<a class="headerlink" href="#star-particle-analysis" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.6.</span></p>
</div>
<p>This document describes tools in yt for analyzing star particles.
The Star Formation Rate tool bins stars by time to produce star formation
statistics over several metrics.
A synthetic flux spectrum and a spectral energy density plot can be calculated
with the Spectrum tool.</p>
<div class="section" id="star-formation-rate">
<span id="id1"></span><h2>Star Formation Rate<a class="headerlink" href="#star-formation-rate" title="Permalink to this headline">¶</a></h2>
<p>This tool can calculate various star formation statistics binned over time.
As input it can accept either a yt <code class="docutils literal"><span class="pre">data_source</span></code>, such as a region or
sphere (see <a class="reference internal" href="../objects.html#available-objects"><span>Available Objects</span></a>), or arrays containing the data for
the stars you wish to analyze.</p>
<p>This example will analyze all the stars in the volume:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.star_analysis.api</span> <span class="kn">import</span> <span class="n">StarFormationRate</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;Enzo_64/DD0030/data0030&quot;</span><span class="p">)</span>
<span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>
<span class="n">sfr</span> <span class="o">=</span> <span class="n">StarFormationRate</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="n">ad</span><span class="p">)</span>
</pre></div>
</div>
<p>or just a small part of the volume i.e. a small sphere at the center of the
simulation volume with radius 10% the box size:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.star_analysis.api</span> <span class="kn">import</span> <span class="n">StarFormationRate</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;Enzo_64/DD0030/data0030&quot;</span><span class="p">)</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sphere</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">sfr</span> <span class="o">=</span> <span class="n">StarFormationRate</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
</pre></div>
</div>
<p>If the stars to be analyzed cannot be defined by a <code class="docutils literal"><span class="pre">data_source</span></code>, YTArrays can
be passed. For backward compatibility it is also possible to pass generic numpy
arrays. In this case, the units for the <code class="docutils literal"><span class="pre">star_mass</span></code> must be in
<img class="math" src="../../_images/math/743f1980a6be41e6dcc7281f8416400a04758752.png" alt="(\mathrm{\rm{M}_\odot})"/>, the <code class="docutils literal"><span class="pre">star_creation_time</span></code> in code units, and
the volume must be specified in <img class="math" src="../../_images/math/5dd7bed5940d7d227fd7af7c3338b110c0907efc.png" alt="(\mathrm{\rm{Mpc}})"/> as a float (but it
doesn&#8217;t have to be correct depending on which statistic is important).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.star_analysis.api</span> <span class="kn">import</span> <span class="n">StarFormationRate</span>
<span class="kn">from</span> <span class="nn">yt.data_objects.particle_filters</span> <span class="kn">import</span> <span class="n">add_particle_filter</span>

<span class="k">def</span> <span class="nf">Stars</span><span class="p">(</span><span class="n">pfilter</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">data</span><span class="p">[(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="s">&quot;particle_type&quot;</span><span class="p">)]</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">Stars</span><span class="p">,</span> <span class="n">filtered_type</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span>
                    <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;particle_type&quot;</span><span class="p">])</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;enzo_tiny_cosmology/RD0009/RD0009&quot;</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&#39;stars&#39;</span><span class="p">)</span>
<span class="n">v</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">find_max</span><span class="p">(</span><span class="s">&quot;density&quot;</span><span class="p">)</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s">&quot;kpc&quot;</span><span class="p">))</span>

<span class="c"># This puts the particle data for *all* the particles in the sphere sp</span>
<span class="c"># into the arrays sm and ct.</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="s">&quot;particle_mass&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msun&#39;</span><span class="p">)</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="s">&quot;age&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Myr&#39;</span><span class="p">)</span>
<span class="n">ct</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="s">&quot;creation_time&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Myr&#39;</span><span class="p">)</span>

<span class="c"># Pick out only old stars using Numpy array fancy indexing.</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">quan</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span> <span class="s">&quot;Myr&quot;</span><span class="p">)</span>
<span class="n">mass_old</span> <span class="o">=</span> <span class="n">mass</span><span class="p">[</span><span class="n">age</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span>
<span class="n">ct_old</span> <span class="o">=</span> <span class="n">ct</span><span class="p">[</span><span class="n">age</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span>

<span class="n">sfr</span> <span class="o">=</span> <span class="n">StarFormationRate</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">star_mass</span><span class="o">=</span><span class="n">mass_old</span><span class="p">,</span> <span class="n">star_creation_time</span><span class="o">=</span><span class="n">ct_old</span><span class="p">,</span>
                        <span class="n">volume</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">volume</span><span class="p">())</span>
</pre></div>
</div>
<p>To output the data to a text file, use the command <code class="docutils literal"><span class="pre">.write_out</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sfr</span><span class="o">.</span><span class="n">write_out</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;StarFormationRate.out&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the file <code class="docutils literal"><span class="pre">StarFormationRate.out</span></code>, there are seven columns of data:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Time (yr)</li>
<li>Look-back time (yr)</li>
<li>Redshift</li>
<li>Star formation rate in this bin per year <img class="math" src="../../_images/math/373307a426cfdca2d7192ed4c33f82e855351544.png" alt="(\mathrm{\rm{M}_\odot / \rm{yr}})"/></li>
<li>Star formation rate in this bin per year per Mpc**3 <img class="math" src="../../_images/math/e7fd7b351b62baacab3df9c471234c638e42d0b9.png" alt="(\mathrm{\rm{M}_\odot / \rm{h} / \rm{Mpc}^3})"/></li>
<li>Stars formed in this time bin <img class="math" src="../../_images/math/743f1980a6be41e6dcc7281f8416400a04758752.png" alt="(\mathrm{\rm{M}_\odot})"/></li>
<li>Cumulative stars formed up to this time bin <img class="math" src="../../_images/math/743f1980a6be41e6dcc7281f8416400a04758752.png" alt="(\mathrm{\rm{M}_\odot})"/></li>
</ol>
</div></blockquote>
<p>The output is easily plotted. This is a plot for some test data (that may or may not
correspond to anything physical) using columns #2 and #4 for the x and y
axes, respectively:</p>
<a class="reference internal image-reference" href="../../_images/SFR.png"><img alt="../../_images/SFR.png" src="../../_images/SFR.png" style="width: 640px; height: 480px;" /></a>
<p>It is possible to access the output of the analysis without writing to disk.
Attached to the <code class="docutils literal"><span class="pre">sfr</span></code> object are the following arrays which are identical
to the ones that are saved to the text file as above:</p>
<blockquote>
<div><ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">sfr.time</span></code></li>
<li><code class="docutils literal"><span class="pre">sfr.lookback_time</span></code></li>
<li><code class="docutils literal"><span class="pre">sfr.redshift</span></code></li>
<li><code class="docutils literal"><span class="pre">sfr.Msol_yr</span></code></li>
<li><code class="docutils literal"><span class="pre">sfr.Msol_yr_vol</span></code></li>
<li><code class="docutils literal"><span class="pre">sfr.Msol</span></code></li>
<li><code class="docutils literal"><span class="pre">sfr.Msol_cumulative</span></code></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="synthetic-spectrum-generator">
<span id="synthetic-spectrum"></span><h2>Synthetic Spectrum Generator<a class="headerlink" href="#synthetic-spectrum-generator" title="Permalink to this headline">¶</a></h2>
<p>Based on code generously provided by Kentaro Nagamine &lt;<a class="reference external" href="mailto:kn&#37;&#52;&#48;physics&#46;unlv&#46;edu">kn<span>&#64;</span>physics<span>&#46;</span>unlv<span>&#46;</span>edu</a>&gt;,
this will generate a synthetic spectrum for the stars using the publicly-available
tables of Bruzual &amp; Charlot (hereafter B&amp;C). Please see their <a class="reference external" href="http://adsabs.harvard.edu/abs/2003MNRAS.344.1000B">2003 paper</a> for more information
and the <a class="reference external" href="http://www.bruzual.org/bc03/">main data
distribution page</a> for the original data.
Based on the mass, age and metallicity of each star, a cumulative spectrum is
generated and can be output in two ways, either raw, or as a spectral
energy distribution.</p>
<p>This analysis toolkit reads in the B&amp;C data from HDF5 files that have been
converted from the original ASCII files (available at the link above). The
HDF5 files are one-quarter the size of the ASCII files, and greatly reduce
the time required to read the data off disk. The HDF5 files are available from
the main yt website <a class="reference external" href="http://yt-project.org/data/bc03.tar.gz">here</a>.
Both the Salpeter and Chabrier models have been converted,
and it is simplest to download all the files to the same location.
Please read the original B&amp;C sources for information on the differences between
the models.</p>
<p>In order to analyze stars, first the Bruzual &amp; Charlot data tables need to be
read in from disk. This is accomplished by initializing <code class="docutils literal"><span class="pre">SpectrumBuilder</span></code> and
specifying the location of the HDF5 files with the <code class="docutils literal"><span class="pre">bcdir</span></code> parameter.
The models are chosen with the <code class="docutils literal"><span class="pre">model</span></code> parameter, which is either
<em>&#8220;chabrier&#8221;</em> or <em>&#8220;salpeter&#8221;</em>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.star_analysis.api</span> <span class="kn">import</span> <span class="n">SpectrumBuilder</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;enzo_tiny_cosmology/RD0009/RD0009&quot;</span><span class="p">)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">SpectrumBuilder</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">bcdir</span><span class="o">=</span><span class="s">&quot;bc&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">&quot;chabrier&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to analyze a set of stars, use the <code class="docutils literal"><span class="pre">calculate_spectrum</span></code> command.
It accepts either a <code class="docutils literal"><span class="pre">data_source</span></code>, or a set of YTarrays with the star
information. Continuing from the above example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">v</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">find_max</span><span class="p">(</span><span class="s">&quot;density&quot;</span><span class="p">)</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s">&quot;kpc&quot;</span><span class="p">))</span>
<span class="n">spec</span><span class="o">.</span><span class="n">calculate_spectrum</span><span class="p">(</span><span class="n">data_source</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
</pre></div>
</div>
<p>If a subset of stars are desired, call it like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">yt.data_objects.particle_filters</span> <span class="kn">import</span> <span class="n">add_particle_filter</span>

<span class="k">def</span> <span class="nf">Stars</span><span class="p">(</span><span class="n">pfilter</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="s">&quot;particle_type&quot;</span><span class="p">)]</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">Stars</span><span class="p">,</span> <span class="n">filtered_type</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span>
                    <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;particle_type&quot;</span><span class="p">])</span>

<span class="c"># Pick out only old stars using Numpy array fancy indexing.</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">quan</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span> <span class="s">&quot;Myr&quot;</span><span class="p">)</span>
<span class="n">mass_old</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="s">&quot;age&quot;</span><span class="p">)][</span><span class="n">age</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span>
<span class="n">metal_old</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="s">&quot;metallicity_fraction&quot;</span><span class="p">)][</span><span class="n">age</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span>
<span class="n">ct_old</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="s">&quot;creation_time&quot;</span><span class="p">)][</span><span class="n">age</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span>

<span class="n">spec</span><span class="o">.</span><span class="n">calculate_spectrum</span><span class="p">(</span><span class="n">star_mass</span><span class="o">=</span><span class="n">mass_old</span><span class="p">,</span> <span class="n">star_creation_time</span><span class="o">=</span><span class="n">ct_old</span><span class="p">,</span>
                        <span class="n">star_metallicity_fraction</span><span class="o">=</span><span class="n">metal_old</span><span class="p">)</span>
</pre></div>
</div>
<p>For backward compatibility numpy arrays can be used instead for <code class="docutils literal"><span class="pre">star_mass</span></code>
(in units <img class="math" src="../../_images/math/09df3ecfc37ce02f152c9f6b5d782d49e08ff135.png" alt="\mathrm{\rm{M}_\odot}"/>), <code class="docutils literal"><span class="pre">star_creation_time</span></code> and
<code class="docutils literal"><span class="pre">star_metallicity_fraction</span></code> (in code units).
Alternatively, when using either a <code class="docutils literal"><span class="pre">data_source</span></code> or individual arrays,
the option <code class="docutils literal"><span class="pre">star_metallicity_constant</span></code> can be specified to force all the
stars to have the same metallicity. If arrays are being used, the
<code class="docutils literal"><span class="pre">star_metallicity_fraction</span></code> array need not be specified.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Make all the stars have solar metallicity.</span>
<span class="n">spec</span><span class="o">.</span><span class="n">calculate_spectrum</span><span class="p">(</span><span class="n">data_source</span><span class="o">=</span><span class="n">sp</span><span class="p">,</span> <span class="n">star_metallicity_constant</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
</pre></div>
</div>
<p>Newly formed stars are often shrouded by thick gas. With the <code class="docutils literal"><span class="pre">min_age</span></code> option
of <code class="docutils literal"><span class="pre">calculate_spectrum</span></code>, young stars can be excluded from the spectrum.
The units are in years.
The default is zero, which is equivalent to including all stars.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">spec</span><span class="o">.</span><span class="n">calculate_spectrum</span><span class="p">(</span><span class="n">data_source</span><span class="o">=</span><span class="n">sp</span><span class="p">,</span> <span class="n">star_metallicity_constant</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
                        <span class="n">min_age</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">quan</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&quot;Myr&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>There are two ways to write out the data once the spectrum has been calculated.
The command <code class="docutils literal"><span class="pre">write_out</span></code> outputs two columns of data:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Wavelength <img class="math" src="../../_images/math/23e34d45ac103442c2393cd45962d35401690c85.png" alt="(\text{\AA})"/></p>
</li>
<li><dl class="first docutils">
<dt>Flux (Luminosity per unit wavelength <img class="math" src="../../_images/math/7568a0cd57cf21fed329c1d85f54356900e2bcee.png" alt="(\mathrm{\rm{L}_\odot} / \text{\AA})"/> , where</dt>
<dd><p class="first last"><img class="math" src="../../_images/math/90d91d6b809a851f9e99fc97fd45a1a17a0756c7.png" alt="\mathrm{\rm{L}_\odot} = 3.826 \cdot 10^{33}\, \mathrm{ergs / s}"/> ).</p>
</dd>
</dl>
</li>
</ol>
</div></blockquote>
<p>and can be called simply, specifying the output file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">spec</span><span class="o">.</span><span class="n">write_out</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;spec.out&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The other way is to output a spectral energy density plot. Along with the
<code class="docutils literal"><span class="pre">name</span></code> parameter, this command can also take the <code class="docutils literal"><span class="pre">flux_norm</span></code> option,
which is the wavelength in Angstroms of the flux to normalize the
distribution to. The default is 5200 Angstroms. This command outputs the data
in two columns:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Wavelength <img class="math" src="../../_images/math/23e34d45ac103442c2393cd45962d35401690c85.png" alt="(\text{\AA})"/></li>
<li>Relative flux normalized to the flux at <em>flux_norm</em>.</li>
</ol>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="n">spec</span><span class="o">.</span><span class="n">write_out_SED</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;SED.out&quot;</span><span class="p">,</span> <span class="n">flux_norm</span><span class="o">=</span><span class="mi">5200</span><span class="p">)</span>
</pre></div>
</div>
<p>Below is an example of an absurd SED for universe-old stars all with
solar metallicity at a redshift of zero. Note that even in this example,
a <code class="docutils literal"><span class="pre">ds</span></code> is required.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.star_analysis.api</span> <span class="kn">import</span> <span class="n">SpectrumBuilder</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;Enzo_64/DD0030/data0030&quot;</span><span class="p">)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">SpectrumBuilder</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">bcdir</span><span class="o">=</span><span class="s">&quot;bc&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">&quot;chabrier&quot;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">spec</span><span class="o">.</span><span class="n">calculate_spectrum</span><span class="p">(</span><span class="n">star_mass</span><span class="o">=</span><span class="n">sm</span><span class="p">,</span> <span class="n">star_creation_time</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span>
                        <span class="n">star_metallicity_constant</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
<span class="n">spec</span><span class="o">.</span><span class="n">write_out_SED</span><span class="p">(</span><span class="s">&#39;SED.out&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And the plot:</p>
<a class="reference internal image-reference" href="../../_images/SED.png"><img alt="../../_images/SED.png" src="../../_images/SED.png" style="width: 640px; height: 480px;" /></a>
<div class="section" id="iterate-over-a-number-of-halos">
<h3>Iterate Over a Number of Halos<a class="headerlink" href="#iterate-over-a-number-of-halos" title="Permalink to this headline">¶</a></h3>
<p>In this example below, the halos for a dataset are found, and the SED is calculated
and written out for each.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.star_analysis.api</span> <span class="kn">import</span> <span class="n">SpectrumBuilder</span>
<span class="kn">from</span> <span class="nn">yt.data_objects.particle_filters</span> <span class="kn">import</span> <span class="n">add_particle_filter</span>
<span class="kn">from</span> <span class="nn">yt.analysis_modules.halo_finding.api</span> <span class="kn">import</span> <span class="n">HaloFinder</span>

<span class="k">def</span> <span class="nf">Stars</span><span class="p">(</span><span class="n">pfilter</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="s">&quot;particle_type&quot;</span><span class="p">)]</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">Stars</span><span class="p">,</span> <span class="n">filtered_type</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span>
                    <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;particle_type&quot;</span><span class="p">])</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;enzo_tiny_cosmology/RD0009/RD0009&quot;</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">add_particle_filter</span><span class="p">(</span><span class="s">&#39;stars&#39;</span><span class="p">)</span>
<span class="n">halos</span> <span class="o">=</span> <span class="n">HaloFinder</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">dm_only</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c"># Set up the spectrum builder.</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">SpectrumBuilder</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">bcdir</span><span class="o">=</span><span class="s">&quot;bc&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">&quot;salpeter&quot;</span><span class="p">)</span>

<span class="c"># Iterate over the halos.</span>
<span class="k">for</span> <span class="n">halo</span> <span class="ow">in</span> <span class="n">halos</span><span class="p">:</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">halo</span><span class="o">.</span><span class="n">get_sphere</span><span class="p">()</span>
    <span class="n">spec</span><span class="o">.</span><span class="n">calculate_spectrum</span><span class="p">(</span>
        <span class="n">star_mass</span><span class="o">=</span><span class="n">sp</span><span class="p">[(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="s">&quot;particle_mass&quot;</span><span class="p">)],</span>
        <span class="n">star_creation_time</span><span class="o">=</span><span class="n">sp</span><span class="p">[(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="s">&quot;creation_time&quot;</span><span class="p">)],</span>
        <span class="n">star_metallicity_fraction</span><span class="o">=</span><span class="n">sp</span><span class="p">[(</span><span class="s">&quot;stars&quot;</span><span class="p">,</span> <span class="s">&quot;metallicity_fraction&quot;</span><span class="p">)])</span>
    <span class="c"># Write out the SED using the default flux normalization.</span>
    <span class="n">spec</span><span class="o">.</span><span class="n">write_out_SED</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;halo</span><span class="si">%05d</span><span class="s">.out&quot;</span> <span class="o">%</span> <span class="n">halo</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
    <div class="footer">
      &copy; Copyright 2013, the yt Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>