# Note that since Factory.connect() was replaced by Factory.open() with only
# two parameters, this testcase is going to use such call instead.

from nosqldb import Factory
from nosqldb import Store
from nosqldb import ConnectionException
from testSetup import get_store
from testSetup import add_runtime_params
from testSetup import get_kvstore_config
from testSetup import host_port
from testSetup import user
from testSetup import password

import unittest


class TestOpenWrongCredentials(unittest.TestCase):

    def setUp(self):
        self.store = get_store()

    def tearDown(self):
        if (self.store is not None):
            self.store.close()

    @unittest.expectedFailure
    def testConnectWrongCredentialsKVStoreConfig(self):
        # check open with wrong credentials from KVStoreConfig
        # you can change user and password using --user and
        # --password command line parameters
        # Note that this user/password combination must not be valid.
        kvstore_config = get_kvstore_config()
        kvstore_config.setSecurityProperties({'user': user,
            'password': password})
        self.assertRaises(ConnectionException, Factory.open,
                          host_port, kvstore_config)

if __name__ == '__main__':
    add_runtime_params()
    unittest.main()
