<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Siesta 1: Basis Sets &mdash; ASE  documentation</title>
    <link rel="stylesheet" href="../../_static/ase.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../../',
          VERSION:     '',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/ase.ico"/>
    <link rel="contents" title="Global table of contents" href="../../contents.html" />
    <link rel="index" title="Global index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="ASE  documentation" href="../../index.html" />
    <link rel="up" title="Exercises" href="../exercises.html" />
    <link rel="next" title="Siesta 2: Molecular Dynamics" href="../siesta2/siesta2.html" />
    <link rel="prev" title="Exercises" href="../exercises.html" />
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>



        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>



        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             accesskey="">modules</a> |</li>
        <a href="../../index.html"><img class="logo" src="../../_static/ase.ico" alt="Logo" align="absmiddle"/></a>
          <li><a href="../../tutorials/tutorials.html" accesskey="U">Tutorials</a> &raquo;</li>
          <li><a href="../exercises.html" accesskey="U">Exercises</a> &raquo;</li>
      </ul>
    </div>
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="siesta-1-basis-sets">
<span id="siesta1"></span><h1>Siesta 1: Basis Sets<a class="headerlink" href="#siesta-1-basis-sets" title="Permalink to this headline">¶</a></h1>
<p>This exercise is intended to illustrate the definition of basis sets
with different numbers of orbitals and localization radii in
SIESTA. It is based on the H<sub>2</sub>O molecule. You will first use
standard basis sets generated by SIESTA, and then a basis set
specifically optimized for the H<sub>2</sub>O molecule. The tips at
the end of this page will help you in analyzing the results of the
calculations.</p>
<p>We are going to use the ASE interface to the <tt class="xref py py-mod docutils literal"><span class="pre">siesta</span></tt> calculator,
for the official SIESTA documentation see <a class="reference external" href="http://www.uam.es/siesta/">here</a>.</p>
<div class="section" id="part-1-standard-basis-sets">
<h2>Part 1: Standard basis sets<a class="headerlink" href="#part-1-standard-basis-sets" title="Permalink to this headline">¶</a></h2>
<p>In the following script you will relax the structure of the H<sub>2</sub>O
molecule to find its equilibrium structure.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">Atoms</span><span class="p">,</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">ase.optimize</span> <span class="kn">import</span> <span class="n">QuasiNewton</span>
<span class="kn">from</span> <span class="nn">ase.calculators.siesta</span> <span class="kn">import</span> <span class="n">Siesta</span>

<span class="c"># Set up a H2O molecule by specifying atomic positions</span>
<span class="n">h2o</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s">&#39;H2O&#39;</span><span class="p">,</span>
            <span class="n">positions</span><span class="o">=</span><span class="p">[(</span> <span class="mf">0.776070</span><span class="p">,</span> <span class="mf">0.590459</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">),</span>
                       <span class="p">(</span><span class="o">-</span><span class="mf">0.776070</span><span class="p">,</span> <span class="mf">0.590459</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">),</span>
                       <span class="p">(</span><span class="mf">0.000000</span><span class="p">,</span>  <span class="o">-</span><span class="mf">0.007702</span><span class="p">,</span>  <span class="o">-</span><span class="mf">0.000001</span><span class="p">)],</span>
            <span class="n">pbc</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="c"># Center the molecule in the cell with some vacuum around</span>
<span class="n">h2o</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">vacuum</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>

<span class="c"># Select some energy-shifts for the basis orbitals</span>
<span class="n">e_shifts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>

<span class="c"># Run the relaxation for each energy shift, and print out the</span>
<span class="c"># corresponding total energy, bond length and angle</span>


<span class="k">for</span> <span class="n">e_s</span> <span class="ow">in</span> <span class="n">e_shifts</span><span class="p">:</span>
    <span class="n">starttime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">calc</span> <span class="o">=</span> <span class="n">Siesta</span><span class="p">(</span><span class="s">&#39;h2o&#39;</span><span class="p">,</span><span class="n">meshcutoff</span><span class="o">=</span><span class="mf">200.0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">Ry</span><span class="p">,</span> <span class="n">mix</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pulay</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">calc</span><span class="o">.</span><span class="n">set_fdf</span><span class="p">(</span><span class="s">&#39;PAO.EnergyShift&#39;</span><span class="p">,</span> <span class="n">e_s</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">eV</span><span class="p">)</span>    
    <span class="n">calc</span><span class="o">.</span><span class="n">set_fdf</span><span class="p">(</span><span class="s">&#39;PAO.SplitNorm&#39;</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
    <span class="n">calc</span><span class="o">.</span><span class="n">set_fdf</span><span class="p">(</span><span class="s">&#39;PAO.BasisSize&#39;</span><span class="p">,</span> <span class="s">&#39;SZ&#39;</span><span class="p">)</span>
    <span class="n">h2o</span><span class="o">.</span><span class="n">set_calculator</span><span class="p">(</span><span class="n">calc</span><span class="p">)</span>
    <span class="c"># Make a -traj file named h2o_current_shift.traj:      </span>
    <span class="n">dyn</span> <span class="o">=</span> <span class="n">QuasiNewton</span><span class="p">(</span><span class="n">h2o</span><span class="p">,</span> <span class="n">trajectory</span><span class="o">=</span><span class="s">&#39;h2o_</span><span class="si">%s</span><span class="s">.traj&#39;</span> <span class="o">%</span> <span class="n">e_s</span><span class="p">)</span>
    <span class="n">dyn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>      <span class="c"># Perform the relaxation      </span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">h2o</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
    <span class="k">print</span><span class="p">()</span>                                <span class="c"># Make the output more readable      </span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;E_shift: </span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e_s</span><span class="p">)</span>       
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;----------------&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Total Energy: </span><span class="si">%.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">E</span><span class="p">)</span>       <span class="c"># Print total energy      </span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">h2o</span><span class="o">.</span><span class="n">get_distance</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Bond length: </span><span class="si">%.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span>        <span class="c"># Print bond length      </span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">h2o</span><span class="o">.</span><span class="n">positions</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">d2</span><span class="p">))</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Bond angle: </span><span class="si">%.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">angle</span><span class="p">)</span>      <span class="c"># Print bond angle</span>
    <span class="n">endtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">walltime</span> <span class="o">=</span> <span class="n">endtime</span> <span class="o">-</span> <span class="n">starttime</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Wall time: </span><span class="si">%.5f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">walltime</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>                                <span class="c"># Make the output more readable      </span>
</pre></div>
</div>
<p>Run the script using three different basis sets: single-Z (SZ),
double-Z (DZ) and double-Z plus polarization (DZP). Run it in
different directories for each basis set, since the run will produce a
large amount of output files. The bases are defined in the script
through these three lines:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">calc</span><span class="o">.</span><span class="n">set_fdf</span><span class="p">(</span><span class="s">&#39;PAO.BasisSize&#39;</span><span class="p">,</span><span class="s">&#39;SZ&#39;</span><span class="p">)</span>
<span class="n">calc</span><span class="o">.</span><span class="n">set_fdf</span><span class="p">(</span><span class="s">&#39;PAO.EnergyShift&#39;</span><span class="p">,</span><span class="n">e_s</span> <span class="o">*</span> <span class="n">eV</span><span class="p">)</span>
<span class="n">calc</span><span class="o">.</span><span class="n">set_fdf</span><span class="p">(</span><span class="s">&#39;PAO.SplitNorm&#39;</span><span class="p">,</span><span class="mf">0.15</span><span class="p">)</span>
</pre></div>
</div>
<p>For each of the basis sets the script will run the relaxation for
different <tt class="docutils literal"><span class="pre">EnergyShift</span></tt> parameters. Look at the results as a
function of basis size and localization radius (or energy shift).</p>
<p>In particular, you should look at:</p>
<ul class="simple">
<li>Total energy</li>
<li>Bond lenghts at the relaxed structure</li>
<li>Bond angles at the relaxed structure</li>
<li>Execution time</li>
<li>Radius of each of the orbitals</li>
<li>Shape of the orbitals</li>
</ul>
<p>The script will print bond lengths and angles, total energy plus the
wall time for each energy shift.  The radii of the orbitals from the
last run can be found in the file <tt class="docutils literal"><span class="pre">h2o.txt</span></tt> along with miscellaneous
other informations.  Orbital shapes from the last run are stored in
the <tt class="docutils literal"><span class="pre">ORB.*</span></tt> files, which contain the value of the orbitals
versus radius. (Note that the standard way to plot the orbitals
is to multiply the orbital by <span class="math">\(r^l\)</span>).</p>
<p>You can visualize both the static atoms and
the relaxation trajectory using the the ASE <tt class="xref py py-mod docutils literal"><span class="pre">gui</span></tt>. For example
you can visualize the relaxation trajectory from the command line by
doing:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ase-gui h2o_0.1.traj
</pre></div>
</div>
<p>Note that you will get a trajectory file <tt class="docutils literal"><span class="pre">.traj</span></tt> for each energy
shift in the loop.</p>
<p>Try to get plots like the following, obtained for a SZ basis:</p>
<p><img alt="en" src="../../_images/ener.png" /> <img alt="dist" src="../../_images/distance.png" /> <img alt="ang" src="../../_images/angle.png" /></p>
<p>Try to answer these questions:</p>
<ol class="arabic simple">
<li>What is the best basis set that you have found? Why?</li>
<li>How do the results compare with experiment?</li>
<li>What do you consider a reasonable basis for the molecule, if you need an accuracy in the geometry of about 1%?</li>
<li>In order to assess convergence with respect to basis set size, should you compare the results with the experimental ones, or with those of a converged basis set calculation?</li>
</ol>
</div>
<div class="section" id="part-2-optimized-basis-sets">
<h2>Part 2: Optimized basis sets<a class="headerlink" href="#part-2-optimized-basis-sets" title="Permalink to this headline">¶</a></h2>
<p>You will now do the same calculations as in Part 1, but now using a
basis set specifically optimized for the H<sub>2</sub>O molecule. Use the
following optimized block instead of the basis-definition lines in
Part1:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">calc</span><span class="o">.</span><span class="n">set_fdf</span><span class="p">(</span><span class="s">&#39;PAO.Basis&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="s">&quot;&quot;&quot;H     2      0.22</span>
<span class="s">                n=1    0    2   E      2.07      0.00</span>
<span class="s">                4.971   1.771</span>
<span class="s">                1.000   1.000</span>
<span class="s">                n=2    1    1   E      0.89      0.01</span>
<span class="s">                4.988</span>
<span class="s">                1.000</span>
<span class="s">                O     3     -0.20</span>
<span class="s">                n=2    0    2   E      0.00      1.31</span>
<span class="s">                5.000   2.581</span>
<span class="s">                1.000   1.000</span>
<span class="s">                n=2    1    2   E      0.00      5.28</span>
<span class="s">                6.500   2.487</span>
<span class="s">                1.000   1.000</span>
<span class="s">                n=3    2    1   E    104.31      0.00</span>
<span class="s">                3.923</span>
<span class="s">                1.000&quot;&quot;&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Compare the parameters with those of the calculations in Part 1.</p>
<p>Do the runs with this basis set, and compare the results with the
previous ones.</p>
</div>
<div class="section" id="tips">
<h2>Tips<a class="headerlink" href="#tips" title="Permalink to this headline">¶</a></h2>
<p>Tip 1: You can see the radii of the orbitals in the output file, just after the line reading:</p>
<div class="highlight-python"><div class="highlight"><pre>printput: Basis input ----------------------------------------------
</pre></div>
</div>
<p>Tip 2: You can look at the shape of the orbitals by plotting the contents of the ORB* files generated by SIESTA.</p>
<p>Tip 3: You will find a lot of information on the run in the <tt class="docutils literal"><span class="pre">.txt</span></tt> output file</p>
<p>Tip 4: In <tt class="docutils literal"><span class="pre">ag</span></tt> you can select <em class="menuselection">View ‣ VMD</em> to start
the VMD viewer. There you can change the atom representation to what
you feel is more convenient. Do that by selecting
<em class="menuselection">Graphics ‣ Representations</em> in the top bar.</p>
<p>Tip 5: SIESTA will store basis functions in <tt class="docutils literal"><span class="pre">ORB.*</span></tt> files.  These files can be plotted using the <strong class="command">xmgrace</strong> command on the GBAR like this:</p>
<div class="highlight-python"><div class="highlight"><pre>$ xmgrace ORB.S1.1.O ORB.S2.1.O
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

          <h3>ASE</h3>
          <ul class="this-page-menu">
            <li><a href="../../overview.html">
              Overview</a></li>
            <li><a href="../../download.html">
              Installation</a></li>
            <li><a href="../../tutorials/tutorials.html">
              Tutorials</em></a></li>
            <li><a href="../../ase/ase.html">
              Documentation</a></li>
            <li><a href="../../faq.html">FAQ</a></li>
            <li><a href="../../mailinglists.html">Mailing lists</a></li>
            <li><a href="../../development/releasenotes.html">Release notes</a></li>
            <li><a href="../../licenseinfo.html">License info</a></li>
           </ul>
           <h3>Development</h3>
           <ul class="this-page-menu">
            <li><a href="../../development/development.html">
              Development</a></li>
            <li><a href="http://wiki.fysik.dtu.dk/ase/epydoc/ase-module.html">
              Epydoc</a></li>
            <li><a href="http://trac.fysik.dtu.dk/projects/ase/browser/trunk/">
              Source code (svn)</a></li>
            <li><a href="../../bugs.html">Bugs!</a></li>
            <li><a href="http://trac.fysik.dtu.dk/projects/ase/report/1">
              Bug Tracker</a></li>
            <li><a href="https://ase-buildbot.fysik.dtu.dk/waterfall">
              BuildBot</a></li>
          </ul>
            <h3>This Page</h3>
            <ul>
<li><a class="reference internal" href="#">Siesta 1: Basis Sets</a><ul>
<li><a class="reference internal" href="#part-1-standard-basis-sets">Part 1: Standard basis sets</a></li>
<li><a class="reference internal" href="#part-2-optimized-basis-sets">Part 2: Optimized basis sets</a></li>
<li><a class="reference internal" href="#tips">Tips</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../exercises.html" title="previous chapter">Exercises</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="../siesta2/siesta2.html" title="next chapter">Siesta 2: Molecular Dynamics</a></p>
            <ul class="this-page-menu">
              <li><a href="../../_sources/exercises/siesta1/siesta1.txt">Show Source</a></li>
            </ul>
            <h3>Quick search</h3>
            <form class="search" action="../../search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>



        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>



        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             accesskey="">modules</a> |</li>
        <a href="../../index.html"><img class="logo" src="../../_static/ase.ico" alt="Logo" align="absmiddle"/></a>
          <li><a href="../../tutorials/tutorials.html" accesskey="U">Tutorials</a> &raquo;</li>
          <li><a href="../exercises.html" accesskey="U">Exercises</a> &raquo;</li>
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2015, CAMd.
      Last updated on Tue, 21 Jul 2015 11:00:40.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>