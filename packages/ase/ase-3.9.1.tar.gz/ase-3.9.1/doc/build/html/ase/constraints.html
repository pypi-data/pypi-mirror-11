<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Constraints &mdash; ASE  documentation</title>
    <link rel="stylesheet" href="../_static/ase.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/ase.ico"/>
    <link rel="contents" title="Global table of contents" href="../contents.html" />
    <link rel="index" title="Global index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="ASE  documentation" href="../index.html" />
    <link rel="up" title="Documentation for modules in ASE" href="ase.html" />
    <link rel="next" title="Nudged elastic band" href="neb.html" />
    <link rel="prev" title="ase_qmmm_manyqm" href="calculators/ase_qmmm_manyqm.html" />
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>



        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>



        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             accesskey="">modules</a> |</li>
        <a href="../index.html"><img class="logo" src="../_static/ase.ico" alt="Logo" align="absmiddle"/></a>
          <li><a href="ase.html" accesskey="U">Documentation for modules in ASE</a> &raquo;</li>
      </ul>
    </div>
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="module-ase.constraints"></span><div class="section" id="constraints">
<h1>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h1>
<p>When performing minimizations or dynamics one may wish to keep some
degrees of freedom in the system fixed. One way of doing this is by
attaching constraint object(s) directly to the atoms object.</p>
<p>Important: setting constraints will freeze the corresponding atom positions.
Changing such atom positions can be achieved:</p>
<ul>
<li><p class="first">by directly setting the <a class="reference internal" href="atoms.html#ase.atoms.Atoms.positions" title="ase.atoms.Atoms.positions"><tt class="xref py py-attr docutils literal"><span class="pre">positions</span></tt></a> attribute
(see example of setting <a class="reference internal" href="atoms.html#atoms-special-attributes"><em>Special attributes</em></a>),</p>
</li>
<li><p class="first">alternatively, by removing the constraints first:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">del</span> <span class="n">atoms</span><span class="o">.</span><span class="n">constraints</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">()</span>
</pre></div>
</div>
<p>and using the <a class="reference internal" href="atoms.html#ase.atoms.Atoms.set_positions" title="ase.atoms.Atoms.set_positions"><tt class="xref py py-meth docutils literal"><span class="pre">set_positions()</span></tt></a> method.</p>
</li>
</ul>
<div class="section" id="the-fixatoms-class">
<h2>The FixAtoms class<a class="headerlink" href="#the-fixatoms-class" title="Permalink to this headline">¶</a></h2>
<p>This class is used for fixing some of the atoms.</p>
<dl class="class">
<dt id="ase.constraints.FixAtoms">
<em class="property">class </em><tt class="descclassname">ase.constraints.</tt><tt class="descname">FixAtoms</tt><big>(</big><em>indices=None</em>, <em>mask=None</em><big>)</big><a class="reference internal" href="../_modules/ase/constraints.html#FixAtoms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ase.constraints.FixAtoms" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>You must supply either the indices of the atoms that should be fixed
or a mask. The mask is a list of booleans, one for each atom, being true
if the atoms should be kept fixed.</p>
<p>For example, to fix the positions of all the Cu atoms in a simulation
with the indices keyword:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">FixAtoms</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s">&#39;Cu&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>or with the mask keyword:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">FixAtoms</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s">&#39;Cu&#39;</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-fixbondlength-class">
<h2>The FixBondLength class<a class="headerlink" href="#the-fixbondlength-class" title="Permalink to this headline">¶</a></h2>
<p>This class is used to fix the distance between two atoms specified by
their indices (<em>a1</em> and <em>a2</em>)</p>
<dl class="class">
<dt id="ase.constraints.FixBondLength">
<em class="property">class </em><tt class="descclassname">ase.constraints.</tt><tt class="descname">FixBondLength</tt><big>(</big><em>a1</em>, <em>a2</em><big>)</big><a class="reference internal" href="../_modules/ase/constraints.html#FixBondLength"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ase.constraints.FixBondLength" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Example of use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">FixBondLength</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example the distance between the atoms
with indices 0 and 1 will be fixed in all following dynamics and/or
minimizations performed on the <em>atoms</em> object.</p>
<p>This constraint is useful for finding minimum energy barriers for
reactions where the path can be described well by a single bond
length (see the <a class="reference internal" href="../tutorials/dissociation.html#mep2"><em>Dissociation tutorial</em></a> tutorial).</p>
<p>Important: If fixing multiple bond lengths, use the FixBondLengths class
below, particularly if the same atom is fixed to multiple partners.</p>
</div>
<div class="section" id="the-fixbondlengths-class">
<h2>The FixBondLengths class<a class="headerlink" href="#the-fixbondlengths-class" title="Permalink to this headline">¶</a></h2>
<p>More than one bond length can be fixed by using this class. Especially
for cases in which more than one bond length constraint is applied on
the same atom. It is done by specifying the indices of the two atoms
forming the bond in pairs.</p>
<dl class="class">
<dt id="ase.constraints.FixBondLengths">
<em class="property">class </em><tt class="descclassname">ase.constraints.</tt><tt class="descname">FixBondLengths</tt><big>(</big><em>pairs</em><big>)</big><a class="reference internal" href="../_modules/ase/constraints.html#FixBondLengths"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ase.constraints.FixBondLengths" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Example of use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">FixBondLengths</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Here the distances between atoms with indices 0 and 1 and atoms with
indices 0 and 2 will be fixed. The constraint is for the same purpose
as the FixBondLength class.</p>
</div>
<div class="section" id="the-fixedline-class">
<h2>The FixedLine class<a class="headerlink" href="#the-fixedline-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ase.constraints.FixedLine">
<em class="property">class </em><tt class="descclassname">ase.constraints.</tt><tt class="descname">FixedLine</tt><big>(</big><em>a</em>, <em>direction</em><big>)</big><a class="reference internal" href="../_modules/ase/constraints.html#FixedLine"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ase.constraints.FixedLine" title="Permalink to this definition">¶</a></dt>
<dd><p>Constrain an atom index <em>a</em> to move on a given line only.</p>
<p>The line is defined by its vector <em>direction</em>.</p>
</dd></dl>

</div>
<div class="section" id="the-fixedplane-class">
<h2>The FixedPlane class<a class="headerlink" href="#the-fixedplane-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ase.constraints.FixedPlane">
<em class="property">class </em><tt class="descclassname">ase.constraints.</tt><tt class="descname">FixedPlane</tt><big>(</big><em>a</em>, <em>direction</em><big>)</big><a class="reference internal" href="../_modules/ase/constraints.html#FixedPlane"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ase.constraints.FixedPlane" title="Permalink to this definition">¶</a></dt>
<dd><p>Constrain an atom index <em>a</em> to move in a given plane only.</p>
<p>The plane is defined by its normal vector <em>direction</em>.</p>
</dd></dl>

<p>Example of use: <a class="reference internal" href="../tutorials/constraints/diffusion.html#constraints-diffusion-tutorial"><em>Diffusion of gold atom on Al(100) surface (constraint)</em></a>.</p>
</div>
<div class="section" id="the-fixedmode-class">
<h2>The FixedMode class<a class="headerlink" href="#the-fixedmode-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ase.constraints.FixedMode">
<em class="property">class </em><tt class="descclassname">ase.constraints.</tt><tt class="descname">FixedMode</tt><big>(</big><em>mode</em><big>)</big><a class="reference internal" href="../_modules/ase/constraints.html#FixedMode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ase.constraints.FixedMode" title="Permalink to this definition">¶</a></dt>
<dd><p>Constrain atoms to move along directions orthogonal to
a given mode only.</p>
</dd></dl>

<p>A mode is a list of vectors specifying a direction for each atom. It often
comes from <a class="reference internal" href="vibrations.html#ase.vibrations.Vibrations.get_mode" title="ase.vibrations.Vibrations.get_mode"><tt class="xref py py-meth docutils literal"><span class="pre">ase.vibrations.Vibrations.get_mode()</span></tt></a>.</p>
</div>
<div class="section" id="the-hookean-class">
<h2>The Hookean class<a class="headerlink" href="#the-hookean-class" title="Permalink to this headline">¶</a></h2>
<p>This class of constraints, based on Hooke&#8217;s Law, is generally used to
conserve molecular identity in optimization schemes and can be used in three
different ways. In the first, it applies a Hookean restorative force between
two atoms if the distance between them exceeds a threshold. This is useful to
maintain the identity of molecules in quenched molecular dynamics, without
changing the degrees of freedom or violating conservation of energy. When the
distance between the two atoms is less than the threshold length, this
constraint is completely inactive.</p>
<p>The below example tethers atoms at indices 3 and 4 together:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Hookean</span><span class="p">(</span><span class="n">a1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">rt</span><span class="o">=</span><span class="mf">1.79</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">5.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, this constraint can tether a single atom to a point in space,
for example to prevent the top layer of a slab from subliming during a
high-temperature MD simulation. An example of tethering atom at index 3 to its
original position:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Hookean</span><span class="p">(</span><span class="n">a1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="n">atoms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">rt</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Reasonable values of the threshold (rt) and spring constant (k) for some
common bonds are below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Bond</td>
<td>rt (Angstroms)</td>
<td>k (eV Angstrom^-2)</td>
</tr>
<tr class="row-even"><td>O-H</td>
<td>1.40</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>C-O</td>
<td>1.79</td>
<td>5</td>
</tr>
<tr class="row-even"><td>C-H</td>
<td>1.59</td>
<td>7</td>
</tr>
<tr class="row-odd"><td>C=O</td>
<td>1.58</td>
<td>10</td>
</tr>
<tr class="row-even"><td>Pt sublimation</td>
<td>0.94</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>Cu sublimation</td>
<td>0.97</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>A third way this constraint can be applied is to apply a restorative force if an atom crosses a plane in space. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Hookean</span><span class="p">(</span><span class="n">a1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>This will apply a restorative force on atom 3 in the downward direction of magnitude k * (atom.z - 7) if the atom&#8217;s vertical position exceeds 7 Angstroms. In other words, if the atom crosses to the (positive) normal side of the plane, the force is applied and directed towards the plane. (The same plane with the normal direction pointing in the -z direction would be given by (0, 0, -1, 7).)</p>
<p>For an example of use, see the <a class="reference internal" href="../tutorials/minimahopping/minimahopping.html#mhtutorial"><em>Constrained minima hopping (global optimization)</em></a> tutorial.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In previous versions of ASE, this was known as the BondSpring constraint.</p>
</div>
</div>
<div class="section" id="the-fixinternals-class">
<h2>The FixInternals class<a class="headerlink" href="#the-fixinternals-class" title="Permalink to this headline">¶</a></h2>
<p>This class allows to fix an arbitrary number of bond lengths, angles
and dihedral angles. The defined constraints are satisfied self
consistently. To define the constraints one needs to specify the
atoms object on which the constraint works (needed for atomic
masses), a list of bond, angle and dihedral constraints.
Those constraint definitions are always list objects containing
the value to be set and a list of atomic indices. The epsilon value
specifies the accuracy to which the constraints are fulfilled.</p>
<dl class="class">
<dt>
<tt class="descname">FixInternals(bonds=[bond1, bond2],</tt></dt>
<dt>
<tt class="descname">angles=[angle1], dihedrals=[dihedral1, dihedral2], epsilon=1.e-7)</tt></dt>
<dd></dd></dl>

<p>Example of use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bond1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.20</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">angle_indices1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dihedral_indices1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">angle1</span> <span class="o">=</span> <span class="p">[</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_angle</span><span class="p">(</span><span class="n">angle_indices1</span><span class="p">),</span> <span class="n">angle_indices1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dihedral1</span> <span class="o">=</span> <span class="p">[</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_dihedral</span><span class="p">(</span><span class="n">dihedral_indices1</span><span class="p">),</span>
<span class="gp">... </span>             <span class="n">dihedral_indices1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">FixInternals</span><span class="p">(</span><span class="n">bonds</span><span class="o">=</span><span class="p">[</span><span class="n">bonds1</span><span class="p">],</span> <span class="n">angles</span><span class="o">=</span><span class="p">[</span><span class="n">angles1</span><span class="p">],</span>
<span class="gp">... </span>                 <span class="n">dihedrals</span><span class="o">=</span><span class="p">[</span><span class="n">dihedral1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>This example defines a bond, an angle and a dihedral angle constraint
to be fixed at the same time.</p>
</div>
<div class="section" id="combining-constraints">
<h2>Combining constraints<a class="headerlink" href="#combining-constraints" title="Permalink to this headline">¶</a></h2>
<p>It is possible to supply several constraints on an atoms object. For
example one may wish to keep the distance between two nitrogen atoms
fixed while relaxing it on a fixed ruthenium surface:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pos</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00000</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">,</span>  <span class="mf">9.17625</span><span class="p">],</span>
<span class="gp">... </span>       <span class="p">[</span><span class="mf">0.00000</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">,</span> <span class="mf">10.27625</span><span class="p">],</span>
<span class="gp">... </span>       <span class="p">[</span><span class="mf">1.37715</span><span class="p">,</span> <span class="mf">0.79510</span><span class="p">,</span>  <span class="mf">5.00000</span><span class="p">],</span>
<span class="gp">... </span>       <span class="p">[</span><span class="mf">0.00000</span><span class="p">,</span> <span class="mf">3.18039</span><span class="p">,</span>  <span class="mf">5.00000</span><span class="p">],</span>
<span class="gp">... </span>       <span class="p">[</span><span class="mf">0.00000</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">,</span>  <span class="mf">7.17625</span><span class="p">],</span>
<span class="gp">... </span>       <span class="p">[</span><span class="mf">1.37715</span><span class="p">,</span> <span class="mf">2.38529</span><span class="p">,</span>  <span class="mf">7.17625</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unitcell</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.5086</span><span class="p">,</span> <span class="mf">4.7706</span><span class="p">,</span> <span class="mf">15.27625</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="n">positions</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">symbols</span><span class="o">=</span><span class="s">&#39;N2Ru4&#39;</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">cell</span><span class="o">=</span><span class="n">unitcell</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">pbc</span><span class="o">=</span><span class="p">[</span><span class="bp">True</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">fa</span> <span class="o">=</span> <span class="n">FixAtoms</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s">&#39;Ru&#39;</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fb</span> <span class="o">=</span> <span class="n">FixBondLength</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">([</span><span class="n">fa</span><span class="p">,</span> <span class="n">fb</span><span class="p">])</span>
</pre></div>
</div>
<p>When applying more than one constraint they are passed as a list in
the <a class="reference internal" href="atoms.html#ase.atoms.Atoms.set_constraint" title="ase.atoms.Atoms.set_constraint"><tt class="xref py py-meth docutils literal"><span class="pre">set_constraint()</span></tt></a> method, and they will be applied
one after the other.</p>
<p>Important: If wanting to fix the length of more than one bond in the
simulation, do not supply a list of <a class="reference internal" href="#ase.constraints.FixBondLength" title="ase.constraints.FixBondLength"><tt class="xref py py-class docutils literal"><span class="pre">FixBondLength</span></tt></a>
instances; instead, use a single instance of
<a class="reference internal" href="#ase.constraints.FixBondLengths" title="ase.constraints.FixBondLengths"><tt class="xref py py-class docutils literal"><span class="pre">FixBondLengths</span></tt></a>.</p>
</div>
<div class="section" id="making-your-own-constraint-class">
<h2>Making your own constraint class<a class="headerlink" href="#making-your-own-constraint-class" title="Permalink to this headline">¶</a></h2>
<p>A constraint class must have these two methods:</p>
<dl class="method">
<dt id="ase.constraints.adjust_positions">
<tt class="descclassname">ase.constraints.</tt><tt class="descname">adjust_positions</tt><big>(</big><em>oldpositions</em>, <em>newpositions</em><big>)</big><a class="headerlink" href="#ase.constraints.adjust_positions" title="Permalink to this definition">¶</a></dt>
<dd><p>Adjust the <em>newpositions</em> array inplace.</p>
</dd></dl>

<dl class="method">
<dt id="ase.constraints.adjust_forces">
<tt class="descclassname">ase.constraints.</tt><tt class="descname">adjust_forces</tt><big>(</big><em>positions</em>, <em>forces</em><big>)</big><a class="headerlink" href="#ase.constraints.adjust_forces" title="Permalink to this definition">¶</a></dt>
<dd><p>Adjust the <em>forces</em> array inplace.</p>
</dd></dl>

<p>A simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">class</span> <span class="nc">MyConstraint</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Constrain an atom to move along a given direction only.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">direction</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">direction</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">adjust_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">newpositions</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">newpositions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">]</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="n">newpositions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span>

    <span class="k">def</span> <span class="nf">adjust_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">forces</span><span class="p">):</span>
        <span class="n">forces</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">forces</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
</pre></div>
</div>
<p>A constraint can optionally have two additional methods, which
will be ignored if missing:</p>
<dl class="method">
<dt id="ase.constraints.adjust_momenta">
<tt class="descclassname">ase.constraints.</tt><tt class="descname">adjust_momenta</tt><big>(</big><em>atoms</em>, <em>momenta</em><big>)</big><a class="headerlink" href="#ase.constraints.adjust_momenta" title="Permalink to this definition">¶</a></dt>
<dd><p>Adjust the <em>momenta</em> array inplace.</p>
</dd></dl>

<dl class="method">
<dt id="ase.constraints.adjust_potential_energy">
<tt class="descclassname">ase.constraints.</tt><tt class="descname">adjust_potential_energy</tt><big>(</big><em>atoms</em>, <em>energy</em><big>)</big><a class="headerlink" href="#ase.constraints.adjust_potential_energy" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide the difference in the <em>potential energy</em> due to the constraint.
(Note that inplace adjustment is not possible for energy, which is a
float.)</p>
</dd></dl>

</div>
<div class="section" id="the-filter-class">
<h2>The Filter class<a class="headerlink" href="#the-filter-class" title="Permalink to this headline">¶</a></h2>
<p>Constraints can also be applied via filters, which acts as a wrapper
around an atoms object. A typical use case will look like this:</p>
<div class="highlight-python"><div class="highlight"><pre> -------       --------       ----------
|       |     |        |     |          |
| Atoms |&lt;----| Filter |&lt;----| Dynamics |
|       |     |        |     |          |
 -------       --------       ----------
</pre></div>
</div>
<p>and in Python this would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">filter</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dyn</span> <span class="o">=</span> <span class="n">Dynamics</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This class hides some of the atoms in an Atoms object.</p>
<dl class="class">
<dt id="ase.constraints.Filter">
<em class="property">class </em><tt class="descclassname">ase.constraints.</tt><tt class="descname">Filter</tt><big>(</big><em>atoms</em>, <em>indices=None</em>, <em>mask=None</em><big>)</big><a class="reference internal" href="../_modules/ase/constraints.html#Filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ase.constraints.Filter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>You must supply either the indices of the atoms that should be kept
visible or a mask. The mask is a list of booleans, one for each atom,
being true if the atom should be kept visible.</p>
<p>Example of use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">Atoms</span><span class="p">,</span> <span class="n">Filter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">=</span><span class="n">Atoms</span><span class="p">(</span><span class="n">positions</span><span class="o">=</span><span class="p">[[</span> <span class="mi">0</span>    <span class="p">,</span> <span class="mi">0</span>    <span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>                       <span class="p">[</span> <span class="mf">0.773</span><span class="p">,</span> <span class="mf">0.600</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>                       <span class="p">[</span><span class="o">-</span><span class="mf">0.773</span><span class="p">,</span> <span class="mf">0.600</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="gp">... </span>            <span class="n">symbols</span><span class="o">=</span><span class="s">&#39;OH2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f2</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f3</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
<span class="go">[[ 0.773  0.6    0.   ]</span>
<span class="go"> [-0.773  0.6    0.   ]]</span>
</pre></div>
</div>
<p>In all three filters only the hydrogen atoms are made
visible.  When asking for the positions only the positions of the
hydrogen atoms are returned.</p>
</div>
<div class="section" id="the-unitcellfilter-class">
<h2>The UnitCellFilter class<a class="headerlink" href="#the-unitcellfilter-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ase.constraints.UnitCellFilter">
<em class="property">class </em><tt class="descclassname">ase.constraints.</tt><tt class="descname">UnitCellFilter</tt><big>(</big><em>atoms</em>, <em>mask=None</em><big>)</big><a class="reference internal" href="../_modules/ase/constraints.html#UnitCellFilter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ase.constraints.UnitCellFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Modify the supercell and the atom positions.</p>
<p>Create a filter that returns the atomic forces and unit cell
stresses together, so they can simultaneously be minimized.</p>
<p>The first argument, atoms, is the atoms object. The optional second
argument, mask, is a list of booleans, indicating which of the six
independent components of the strain are relaxed.</p>
<ul class="simple">
<li>True = relax to zero</li>
<li>False = fixed, ignore this component</li>
</ul>
<p>You can still use constraints on the atoms, e.g. FixAtoms, to control
the relaxation of the atoms.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># this should be equivalent to the StrainFilter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">.</span><span class="n">set_constraint</span><span class="p">(</span><span class="n">FixAtoms</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="bp">True</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ucf</span> <span class="o">=</span> <span class="n">UnitCellFilter</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
</pre></div>
</div>
<p>You should not attach this UnitCellFilter object to a
trajectory. Instead, create a trajectory for the atoms, and
attach it to an optimizer like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ucf</span> <span class="o">=</span> <span class="n">UnitCellFilter</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qn</span> <span class="o">=</span> <span class="n">QuasiNewton</span><span class="p">(</span><span class="n">ucf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span> <span class="o">=</span> <span class="n">Trajectory</span><span class="p">(</span><span class="s">&#39;TiO2.traj&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qn</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
<p>Helpful conversion table:</p>
<ul class="simple">
<li>0.05 eV/A^3   = 8 GPA</li>
<li>0.003 eV/A^3  = 0.48 GPa</li>
<li>0.0006 eV/A^3 = 0.096 GPa</li>
<li>0.0003 eV/A^3 = 0.048 GPa</li>
<li>0.0001 eV/A^3 = 0.02 GPa</li>
</ul>
</dd></dl>

</div>
<div class="section" id="the-strainfilter-class">
<h2>The StrainFilter class<a class="headerlink" href="#the-strainfilter-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ase.constraints.StrainFilter">
<em class="property">class </em><tt class="descclassname">ase.constraints.</tt><tt class="descname">StrainFilter</tt><big>(</big><em>atoms</em>, <em>mask=None</em><big>)</big><a class="reference internal" href="../_modules/ase/constraints.html#StrainFilter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ase.constraints.StrainFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Modify the supercell while keeping the scaled positions fixed.</p>
<p>Presents the strain of the supercell as the generalized positions,
and the global stress tensor (times the volume) as the generalized
force.</p>
<p>This filter can be used to relax the unit cell until the stress is
zero.  If MDMin is used for this, the timestep (dt) to be used
depends on the system size. 0.01/x where x is a typical dimension
seems like a good choice.</p>
<p>The stress and strain are presented as 6-vectors, the order of the
components follow the standard engingeering practice: xx, yy, zz,
yz, xz, xy.</p>
<p>Create a filter applying a homogeneous strain to a list of atoms.</p>
<p>The first argument, atoms, is the atoms object.</p>
<p>The optional second argument, mask, is a list of six booleans,
indicating which of the six independent components of the
strain that are allowed to become non-zero.  It defaults to
[1,1,1,1,1,1].</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

          <h3>ASE</h3>
          <ul class="this-page-menu">
            <li><a href="../overview.html">
              Overview</a></li>
            <li><a href="../download.html">
              Installation</a></li>
            <li><a href="../tutorials/tutorials.html">
              Tutorials</em></a></li>
            <li><a href="ase.html">
              Documentation</a></li>
            <li><a href="../faq.html">FAQ</a></li>
            <li><a href="../mailinglists.html">Mailing lists</a></li>
            <li><a href="../development/releasenotes.html">Release notes</a></li>
            <li><a href="../licenseinfo.html">License info</a></li>
           </ul>
           <h3>Development</h3>
           <ul class="this-page-menu">
            <li><a href="../development/development.html">
              Development</a></li>
            <li><a href="http://wiki.fysik.dtu.dk/ase/epydoc/ase-module.html">
              Epydoc</a></li>
            <li><a href="http://trac.fysik.dtu.dk/projects/ase/browser/trunk/">
              Source code (svn)</a></li>
            <li><a href="../bugs.html">Bugs!</a></li>
            <li><a href="http://trac.fysik.dtu.dk/projects/ase/report/1">
              Bug Tracker</a></li>
            <li><a href="https://ase-buildbot.fysik.dtu.dk/waterfall">
              BuildBot</a></li>
          </ul>
            <h3>This Page</h3>
            <ul>
<li><a class="reference internal" href="#">Constraints</a><ul>
<li><a class="reference internal" href="#the-fixatoms-class">The FixAtoms class</a></li>
<li><a class="reference internal" href="#the-fixbondlength-class">The FixBondLength class</a></li>
<li><a class="reference internal" href="#the-fixbondlengths-class">The FixBondLengths class</a></li>
<li><a class="reference internal" href="#the-fixedline-class">The FixedLine class</a></li>
<li><a class="reference internal" href="#the-fixedplane-class">The FixedPlane class</a></li>
<li><a class="reference internal" href="#the-fixedmode-class">The FixedMode class</a></li>
<li><a class="reference internal" href="#the-hookean-class">The Hookean class</a></li>
<li><a class="reference internal" href="#the-fixinternals-class">The FixInternals class</a></li>
<li><a class="reference internal" href="#combining-constraints">Combining constraints</a></li>
<li><a class="reference internal" href="#making-your-own-constraint-class">Making your own constraint class</a></li>
<li><a class="reference internal" href="#the-filter-class">The Filter class</a></li>
<li><a class="reference internal" href="#the-unitcellfilter-class">The UnitCellFilter class</a></li>
<li><a class="reference internal" href="#the-strainfilter-class">The StrainFilter class</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="calculators/ase_qmmm_manyqm.html" title="previous chapter">ase_qmmm_manyqm</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="neb.html" title="next chapter">Nudged elastic band</a></p>
            <ul class="this-page-menu">
              <li><a href="../_sources/ase/constraints.txt">Show Source</a></li>
            </ul>
            <h3>Quick search</h3>
            <form class="search" action="../search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>



        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>



        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             accesskey="">modules</a> |</li>
        <a href="../index.html"><img class="logo" src="../_static/ase.ico" alt="Logo" align="absmiddle"/></a>
          <li><a href="ase.html" accesskey="U">Documentation for modules in ASE</a> &raquo;</li>
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2015, CAMd.
      Last updated on Tue, 21 Jul 2015 11:00:40.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>