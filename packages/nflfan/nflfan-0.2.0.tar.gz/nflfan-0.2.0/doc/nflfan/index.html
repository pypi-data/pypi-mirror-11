<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>nflfan API documentation</title>
    <meta name="description" content="Module nflfan provides a way to connect your fantasy rosters with
statistical data in nfldb in order..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>


  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#nflfan.builtin_providers">builtin_providers</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#nflfan.cache_path">cache_path</a></li>
    <li class="mono"><a href="#nflfan.load_config">load_config</a></li>
    <li class="mono"><a href="#nflfan.player_search">player_search</a></li>
    <li class="mono"><a href="#nflfan.score_details">score_details</a></li>
    <li class="mono"><a href="#nflfan.score_players">score_players</a></li>
    <li class="mono"><a href="#nflfan.score_roster">score_roster</a></li>
    <li class="mono"><a href="#nflfan.tag_players">tag_players</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#nflfan.ESPN">ESPN</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflfan.ESPN.__init__">__init__</a></li>
    <li class="mono"><a href="#nflfan.ESPN.matchups">matchups</a></li>
    <li class="mono"><a href="#nflfan.ESPN.owners">owners</a></li>
    <li class="mono"><a href="#nflfan.ESPN.roster">roster</a></li>
    <li class="mono"><a href="#nflfan.ESPN.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflfan.League">League</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflfan.League.__init__">__init__</a></li>
    <li class="mono"><a href="#nflfan.League.cache_path">cache_path</a></li>
    <li class="mono"><a href="#nflfan.League.is_me">is_me</a></li>
    <li class="mono"><a href="#nflfan.League.matchup">matchup</a></li>
    <li class="mono"><a href="#nflfan.League.matchups">matchups</a></li>
    <li class="mono"><a href="#nflfan.League.me">me</a></li>
    <li class="mono"><a href="#nflfan.League.owner">owner</a></li>
    <li class="mono"><a href="#nflfan.League.owners">owners</a></li>
    <li class="mono"><a href="#nflfan.League.roster">roster</a></li>
    <li class="mono"><a href="#nflfan.League.rosters">rosters</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflfan.Matchup">Matchup</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflfan.Matchup.other">other</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflfan.Owner">Owner</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflfan.Provider">Provider</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflfan.Provider.__init__">__init__</a></li>
    <li class="mono"><a href="#nflfan.Provider.matchups">matchups</a></li>
    <li class="mono"><a href="#nflfan.Provider.owners">owners</a></li>
    <li class="mono"><a href="#nflfan.Provider.roster">roster</a></li>
    <li class="mono"><a href="#nflfan.Provider.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflfan.Roster">Roster</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflfan.Roster.new_player">new_player</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflfan.RosterPlayer">RosterPlayer</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflfan.ScoreSchema">ScoreSchema</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflfan.Yahoo">Yahoo</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflfan.Yahoo.__init__">__init__</a></li>
    <li class="mono"><a href="#nflfan.Yahoo.matchups">matchups</a></li>
    <li class="mono"><a href="#nflfan.Yahoo.owners">owners</a></li>
    <li class="mono"><a href="#nflfan.Yahoo.roster">roster</a></li>
    <li class="mono"><a href="#nflfan.Yahoo.save">save</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">nflfan</span> module</h1>
  <p>Module nflfan provides a way to connect your fantasy rosters with
statistical data in nfldb in order to perform live scoring. nflfan also
provides a simple web interface that can be used to watch all of your
fantasy games with real time updates. The web server can be started by
running:</p>
<pre><code>#!bash
python -m nflfan.web
</code></pre>
<p>Currently, only Yahoo and ESPN fantasy leagues are supported. But
nflfan is extensible, and it will be easy to add more leagues in the
future.</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan', this);">Show source &equiv;</a></p>
  <div id="source-nflfan" class="source">
    <pre><code>"""
Module nflfan provides a way to connect your fantasy rosters with
statistical data in nfldb in order to perform live scoring. nflfan also
provides a simple web interface that can be used to watch all of your
fantasy games with real time updates. The web server can be started by
running:

    #!bash
    python -m nflfan.web

Currently, only Yahoo and ESPN fantasy leagues are supported. But
nflfan is extensible, and it will be easy to add more leagues in the
future.
"""
from nflfan.config import builtin_providers, load_config, cache_path
from nflfan.provider import __pdoc__ as __provider_pdoc__
from nflfan.provider import player_search
from nflfan.provider import League
from nflfan.provider import Matchup, Owner, Roster, RosterPlayer
from nflfan.provider import Provider, Yahoo, ESPN
from nflfan.score import __pdoc__ as __score_pdoc__
from nflfan.score import score_details, score_roster, score_players
from nflfan.score import tag_players
from nflfan.score import ScoreSchema

__pdoc__ = {}
__pdoc__ = dict(__pdoc__, **__provider_pdoc__)
__pdoc__ = dict(__pdoc__, **__score_pdoc__)

__all__ = [
    # nflfan.config
    'builtin_providers', 'load_config', 'cache_path',

    # nflfan.provider
    'player_search',
    'League',
    'Matchup', 'Owner', 'Roster', 'RosterPlayer',
    'Provider', 'Yahoo', 'ESPN',

    # nflfan.score
    'score_details', 'score_roster', 'score_players', 'tag_players',
    'ScoreSchema',
]
</code></pre>
  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="nflfan.builtin_providers" class="name">var <span class="ident">builtin_providers</span></p>
      
  
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="nflfan.cache_path">
    <p>def <span class="ident">cache_path</span>(</p><p>)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a file path to the cache directory. If a cache directory
does not exist, one is created.</p>
<p>If there is a problem creating a cache directory, an <code>IOError</code>
exception is raised.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.cache_path', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.cache_path" class="source">
    <pre><code>def cache_path():
    """
    Returns a file path to the cache directory. If a cache directory
    does not exist, one is created.

    If there is a problem creating a cache directory, an `IOError`
    exception is raised.
    """
    for fp in _data_paths:
        if os.access(fp, os.R_OK):
            cdir = path.join(fp, 'data')
            if not os.access(cdir, os.R_OK):
                try:
                    os.mkdir(cdir)
                except IOError as e:
                    raise IOError(e + ' (please create a cache directory)')
            return cdir
    raise IOError('could not find or create a cache directory')
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nflfan.load_config">
    <p>def <span class="ident">load_config</span>(</p><p>providers={&#39;yahoo&#39;: &lt;class &#39;nflfan.provider.Yahoo&#39;&gt;, &#39;espn&#39;: &lt;class &#39;nflfan.provider.ESPN&#39;&gt;}, file_path=&#39;&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Reads and loads the configuration file containing fantasy football
league information.</p>
<p>The return value is a dictionary mapping provider name (e.g.,
<code>yahoo</code>) to a list of leagues for that provider. Each league
is guaranteed to have at least a <code>name</code>, <code>season</code>, <code>phase</code>
and <code>scoring</code> attributes filled in as values that are not
<code>None</code>. Providers also have their own specific mandatory fields:</p>
<p>If no configuration file can be found, then an <code>IOError</code> is raised.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.load_config', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.load_config" class="source">
    <pre><code>def load_config(providers=builtin_providers, file_path=''):
    """
    Reads and loads the configuration file containing fantasy football
    league information.

    The return value is a dictionary mapping provider name (e.g.,
    `yahoo`) to a list of leagues for that provider. Each league
    is guaranteed to have at least a `name`, `season`, `phase`
    and `scoring` attributes filled in as values that are not
    `None`. Providers also have their own specific mandatory fields:

    If no configuration file can be found, then an `IOError` is raised.
    """
    def prov_leagues(d):
        return ((k, d[k]) for k in sorted(d.keys()) if isinstance(d[k], dict))

    schema = {
        'all': {
            'req': provider.Provider.conf_required,
            'opt': provider.Provider.conf_optional,
        },
    }
    for prov in providers.values():
        schema[prov.provider_name] = {
            'req': prov.conf_required, 'opt': prov.conf_optional,
        }

    raw = toml.loads(get_data('config.toml', file_path=file_path))
    scoring = merge(raw['scoring'])

    conf = {'leagues': OrderedDict()}
    for pname in sorted(raw.keys()):
        prov = raw[pname]
        if pname == 'scoring':
            continue
        if not isinstance(prov, dict):
            conf[pname] = prov
            continue

        conf['leagues'][pname] = OrderedDict()
        for lg_name, lg in prov_leagues(prov):
            lg['league_name'] = lg_name
            lg['provider_class'] = providers[pname]
            apply_schema(schema, scoring, pname, prov, lg)

            lg = provider.League(lg['season'], lg['phase'], lg['league_id'],
                                 pname, lg_name, lg['scoring'], lg)
            conf['leagues'][pname][lg_name] = lg
    return conf
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nflfan.player_search">
    <p>def <span class="ident">player_search</span>(</p><p>db, full_name, team=None, position=None)</p>
    </div>
    

    
  
    <div class="desc"><p>A thin wrapper around <code>nfldb.player_search</code> that tries searching
with <code>team</code> or <code>position</code> when given, but if no results are found,
then this returns the results of a search with just the full name.</p>
<p>This allows for a slightly out-of-date database to still provide
a match while also disambiguating players with the same name.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.player_search', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.player_search" class="source">
    <pre><code>def player_search(db, full_name, team=None, position=None):
    """
    A thin wrapper around `nfldb.player_search` that tries searching
    with `team` or `position` when given, but if no results are found,
    then this returns the results of a search with just the full name.

    This allows for a slightly out-of-date database to still provide
    a match while also disambiguating players with the same name.
    """
    if position not in nfldb.Enums.player_pos:
        position = None

    p, _ = nfldb.player_search(db, full_name, team=team, position=position)
    if p is None and position is not None:
        p, _ = nfldb.player_search(db, full_name, team=team, position=None)
    if p is None and team is not None:
        p, _ = nfldb.player_search(db, full_name, team=None, position=position)
    if p is None and team is not None and position is not None:
        p, _ = nfldb.player_search(db, full_name, team=None, position=None)
    return p
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nflfan.score_details">
    <p>def <span class="ident">score_details</span>(</p><p>schema, pp, fgs=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Given an nfldb database connection, a <a href="#nflfan.ScoreSchema"><code>ScoreSchema</code></a> and
a <code>nfldb.PlayPlayer</code> object, return a dictionary mapping the name of
a score statistic to a tuple of statistic and total point value
corresponding to the statistics in <code>pp</code>.</p>
<p><code>fgs</code> should be a a list of <code>nfldb.PlayPlayer</code>, where each
describes a <em>single</em> field goal `attempt.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.score_details', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.score_details" class="source">
    <pre><code>def score_details(schema, pp, fgs=None):
    """
    Given an nfldb database connection, a `nflfan.ScoreSchema` and
    a `nfldb.PlayPlayer` object, return a dictionary mapping the name of
    a score statistic to a tuple of statistic and total point value
    corresponding to the statistics in `pp`.

    `fgs` should be a a list of `nfldb.PlayPlayer`, where each
    describes a *single* field goal `attempt.
    """
    fgs = fgs or []
    def add(d, cat, stat, pts):
        if pts == 0:
            return
        if cat in d:
            d[cat] = (stat + d[cat][0], pts + d[cat][1])
        else:
            d[cat] = (stat, pts)

    d = {}
    for cat, v in _pp_stats(pp, lambda cat: not _is_defense_stat(cat)):
        add(d, cat, v, v * schema.settings.get(cat, 0.0))
    for field, pts, start, end in schema._bonuses():
        v = getattr(pp, field, 0.0)
        if start <= v <= end:
            add(d, field, v, pts)
    for pp in fgs:
        for cat, v in _pp_stats(pp, lambda cat: cat.startswith('kicking_fg')):
            if cat in ('kicking_fgm_yds', 'kicking_fgmissed_yds'):
                prefix = re.sub('_yds$', '', cat)
                scat = schema._pick_range_setting(prefix, v)
                if scat is not None:
                    add(d, scat, 1, schema.settings.get(scat, 0.0))
    return d
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nflfan.score_players">
    <p>def <span class="ident">score_players</span>(</p><p>db, schema, players, phase=&lt;season_phase.Regular: 2&gt;)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a database connection, a <a href="#nflfan.ScoreSchema"><code>ScoreSchema</code></a>, and a list of
<a href="#nflfan.RosterPlayer"><code>RosterPlayer</code></a>, return a list of new <a href="#nflfan.RosterPlayer"><code>RosterPlayer</code></a>
objects with the <code>playing</code> and <code>points</code> attributes set.</p>
<p><code>phase</code> may be set to a different phase of the season, but
traditional fantasy sports are only played during the regular
season, which is the default.</p>
<p>N.B. <code>players</code> is a list because of performance reasons. Namely,
scoring can use fewer SQL queries when given a collection of players
to score as opposed to a single player.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.score_players', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.score_players" class="source">
    <pre><code>def score_players(db, schema, players, phase=nfldb.Enums.season_phase.Regular):
    """
    Given a database connection, a `nflfan.ScoreSchema`, and a list of
    `nflfan.RosterPlayer`, return a list of new `nflfan.RosterPlayer`
    objects with the `playing` and `points` attributes set.

    `phase` may be set to a different phase of the season, but
    traditional fantasy sports are only played during the regular
    season, which is the default.

    N.B. `players` is a list because of performance reasons. Namely,
    scoring can use fewer SQL queries when given a collection of players
    to score as opposed to a single player.
    """
    if len(players) == 0:
        return []
    season, week = players[0].season, players[0].week

    def player_query(ids):
        return _game_query(db, players[0], phase=phase).player(player_id=ids)

    def week_games():
        q = _game_query(db, players[0], phase=phase)

        games = {}
        for game in q.as_games():
            games[game.home_team] = game
            games[game.away_team] = game
        return games

    def tag(games, pps, fgs, rp):
        if rp.is_empty:
            return rp

        game = games.get(rp.team, None)
        if rp.is_defense:
            pts = _score_defense_team(schema, db, game, rp, phase)
        else:
            pp = pps.get(rp.player_id, None)
            pp_fgs = fgs.get(rp.player_id, [])
            pts = _score_player(schema, pp, pp_fgs)
        return rp._replace(game=game, points=pts)

    games = week_games()
    pids = [p.player_id for p in players if p.is_player]
    fgs = _pp_field_goals(db, players, phase=phase)
    pps = dict([(p.player_id, p) for p in player_query(pids).as_aggregate()])
    return map(functools.partial(tag, games, pps, fgs), players)
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nflfan.score_roster">
    <p>def <span class="ident">score_roster</span>(</p><p>db, schema, roster, phase=&lt;season_phase.Regular: 2&gt;)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a database connection, a <a href="#nflfan.ScoreSchema"><code>ScoreSchema</code></a>, and
a <a href="#nflfan.Roster"><code>Roster</code></a>, return a new <a href="#nflfan.Roster"><code>Roster</code></a> with
<a href="#nflfan.RosterPlayer"><code>RosterPlayer</code></a> objects with the <code>playing</code> and <code>points</code>
attributes set.</p>
<p><code>phase</code> may be set to a different phase of the season, but
traditional fantasy sports are only played during the regular
season, which is the default.</p>
<p>Each <a href="#nflfan.RosterPlayer"><code>RosterPlayer</code></a> in the roster given will also have the
<a href="#nflfan.RosterPlayer.player"><code>player</code></a> attribute set to its corresponding
<code>nfldb.Player</code> object. (Except for roster players corresponding to
an entire team, e.g., a defense.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.score_roster', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.score_roster" class="source">
    <pre><code>def score_roster(db, schema, roster, phase=nfldb.Enums.season_phase.Regular):
    """
    Given a database connection, a `nflfan.ScoreSchema`, and
    a `nflfan.Roster`, return a new `nflfan.Roster` with
    `nflfan.RosterPlayer` objects with the `playing` and `points`
    attributes set.

    `phase` may be set to a different phase of the season, but
    traditional fantasy sports are only played during the regular
    season, which is the default.

    Each `nflfan.RosterPlayer` in the roster given will also have the
    `nflfan.RosterPlayer.player` attribute set to its corresponding
    `nfldb.Player` object. (Except for roster players corresponding to
    an entire team, e.g., a defense.)
    """
    tagged = tag_players(db, roster.players)
    scored = score_players(db, schema, tagged, phase=phase)
    return roster._replace(players=scored)
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nflfan.tag_players">
    <p>def <span class="ident">tag_players</span>(</p><p>db, players)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a list of <a href="#nflfan.RosterPlayer"><code>RosterPlayer</code></a> objects, set the
<a href="#nflfan.RosterPlayer.player"><code>player</code></a> attribute to its corresponding
<code>nfldb.Player</code> object. (Except for roster players corresponding to
an entire team, e.g., a defense.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.tag_players', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.tag_players" class="source">
    <pre><code>def tag_players(db, players):
    """
    Given a list of `nflfan.RosterPlayer` objects, set the
    `nflfan.RosterPlayer.player` attribute to its corresponding
    `nfldb.Player` object. (Except for roster players corresponding to
    an entire team, e.g., a defense.)
    """
    ids = [p.player_id for p in players if p.is_player]
    q = nfldb.Query(db).player(player_id=ids)
    dbps = dict([(p.player_id, p) for p in q.as_players()])
    return [p._replace(player=dbps.get(p.player_id, None)) for p in players]
</code></pre>
  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="nflfan.ESPN" class="name">class <span class="ident">ESPN</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.ESPN', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.ESPN" class="source">
    <pre><code>class ESPN (Provider):
    provider_name = 'espn'
    conf_required = []
    conf_optional = ['username', 'password']
    _headers = {'User-Agent': _user_agent}
    _login_url = 'http://games.espn.go.com/ffl/signin?_=_'

    def owners(self):
        url = _urls['espn']['owner'].format(
            league_id=self._lg.ident, season_id=self._lg.season)
        soup = BeautifulSoup(self._request(url).text)
        owners = []
        for td in soup.select('tr.ownerRow td.teamName'):
            ident = self._owner_id_from_url(td.a['href'])
            owners.append(Owner(ident, td.text.strip()))
        return owners

    def matchups(self, week):
        owner_id = self._owner_id_from_url

        url = _urls['espn']['matchup'].format(
            league_id=self._lg.ident, season_id=self._lg.season, week=week)
        soup = BeautifulSoup(self._request(url).text)
        matchupDiv = soup.find(id='scoreboardMatchups')
        matchups = []
        for table in matchupDiv.select('table.matchup'):
            t1, t2 = list(table.find_all(class_='name'))
            id1, id2 = owner_id(t1.a['href']), owner_id(t2.a['href'])
            name1, name2 = t1.a.text.strip(), t2.a.text.strip()
            o1, o2 = Owner(id1, name1), Owner(id2, name2)

            matchups.append(Matchup(o1, o2))
        return matchups

    def roster(self, player_search, owner, week):
        def to_pos(row):
            pos = row.find(class_='playerSlot').text.strip().upper()
            if pos == 'BENCH':
                return 'BN'
            return pos

        def to_name(row):
            name = row.find(class_='playertablePlayerName').a.text.strip()

            # If this is the defense, apparently 'D/ST' is included in
            # the name. Wtf?
            return re.sub('\s+D/ST$', '', name)

        def to_team(row):
            tpos = row.find(class_='playertablePlayerName').a.next_sibling
            tpos = tpos.strip(' \r\n\t*,|').upper()

            # This is a little weird because the team name seems to run
            # in with the position. Perhaps a weird encoding quirk?
            if len(tpos) < 2:
                return 'UNK'
            elif len(tpos) == 2:
                return nfldb.standard_team(tpos)
            else:
                team = nfldb.standard_team(tpos[0:3])
                if team == 'UNK':
                    team = nfldb.standard_team(tpos[0:2])
                return team

        def rplayer(r, name, team, pos):
            bench = pos == 'BN'
            name_team = nfldb.standard_team(name)
            if name is None and team is None:
                return r.new_player(pos, None, bench, None)
            elif name_team != 'UNK':
                return r.new_player(pos, name_team, bench, None)
            else:
                player = player_search(name, team=team, position=pos)
                return r.new_player(pos, team, bench, player.player_id)

        url = _urls['espn']['roster'].format(
            league_id=self._lg.ident, season_id=self._lg.season, week=week,
            team_id=owner.ident)
        soup = BeautifulSoup(self._request(url).text)

        roster = Roster(owner, self._lg.season, week, [])
        for tr in soup.select('tr.pncPlayerRow'):
            if tr.get('id', '') == 'pncEmptyRow':
                continue
            pos = to_pos(tr)
            try:
                team, name = to_team(tr), to_name(tr)
                roster.players.append(rplayer(roster, name, team, pos))
            except AttributeError:
                roster.players.append(rplayer(roster, None, None, pos))
        return roster

    def _owner_id_from_url(self, url):
        return re.search('teamId=([0-9]+)', url).group(1)

    def _login(self):
        soup = super(ESPN, self)._login()
        if self._login_form(soup):
            err_msg = []
            for msg in soup.find_all('font', color='#ff0000'):
                err_msg.append(msg.text.strip())
            err_msg = '\n'.join(err_msg) if err_msg else 'Unknown error.'
            raise IOError('Login failed: %s' % err_msg)

    def _login_params(self):
        return {
            'username': self._lg.conf.get('username', ''),
            'password': self._lg.conf.get('password', ''),
            'submit': 'Sign In',
        }

    def _login_form(self, soup):
        return soup.find('form', attrs={'name': 'loginForm'})
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflfan.ESPN">ESPN</a></li>
          <li><a href="#nflfan.Provider">Provider</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="nflfan.ESPN.conf_optional" class="name">var <span class="ident">conf_optional</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.conf_optional">conf_optional</a></code>
    </p>

            
  
    <div class="desc inherited"><p>A list of fields that are optional for every provider.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.ESPN.conf_required" class="name">var <span class="ident">conf_required</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.conf_required">conf_required</a></code>
    </p>

            
  
    <div class="desc inherited"><p>A list of fields required for every provider.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.ESPN.provider_name" class="name">var <span class="ident">provider_name</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.provider_name">provider_name</a></code>
    </p>

            
  
    <div class="desc inherited"><p>The name of the provider used in the configuration file.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflfan.ESPN.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, lg)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.__init__">__init__</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.ESPN.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.ESPN.__init__" class="source">
    <pre><code>def __init__(self, lg):
    self._lg = lg
    self._session = requests.Session()
    self._session.headers.update(getattr(self, '_headers', {}))
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.ESPN.matchups">
    <p>def <span class="ident">matchups</span>(</p><p>self, week)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.matchups">matchups</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Given a week number, this returns a list of <a href="#nflfan.Matchup"><code>Matchup</code></a>
objects describing the head-to-head matchups for <code>week</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.ESPN.matchups', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.ESPN.matchups" class="source">
    <pre><code>def matchups(self, week):
    owner_id = self._owner_id_from_url
    url = _urls['espn']['matchup'].format(
        league_id=self._lg.ident, season_id=self._lg.season, week=week)
    soup = BeautifulSoup(self._request(url).text)
    matchupDiv = soup.find(id='scoreboardMatchups')
    matchups = []
    for table in matchupDiv.select('table.matchup'):
        t1, t2 = list(table.find_all(class_='name'))
        id1, id2 = owner_id(t1.a['href']), owner_id(t2.a['href'])
        name1, name2 = t1.a.text.strip(), t2.a.text.strip()
        o1, o2 = Owner(id1, name1), Owner(id2, name2)
        matchups.append(Matchup(o1, o2))
    return matchups
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.ESPN.owners">
    <p>def <span class="ident">owners</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.owners">owners</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Returns a list of <a href="#nflfan.Owner"><code>Owner</code></a> objects.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.ESPN.owners', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.ESPN.owners" class="source">
    <pre><code>def owners(self):
    url = _urls['espn']['owner'].format(
        league_id=self._lg.ident, season_id=self._lg.season)
    soup = BeautifulSoup(self._request(url).text)
    owners = []
    for td in soup.select('tr.ownerRow td.teamName'):
        ident = self._owner_id_from_url(td.a['href'])
        owners.append(Owner(ident, td.text.strip()))
    return owners
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.ESPN.roster">
    <p>def <span class="ident">roster</span>(</p><p>self, player_search, owner, week)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.roster">roster</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Given a <a href="#nflfan.Owner"><code>Owner</code></a> and a week number, this returns a
<a href="#nflfan.Roster"><code>Roster</code></a> object. The <a href="#nflfan.Roster"><code>Roster</code></a> contains a list of
<code>nfldb.Player</code> objects and their corresponding position on the
roster.</p>
<p><code>player_search</code> should be a function that takes a full
player name and returns the closest matching player as a
<code>nfldb.Player</code> object. It should also optionally take keyword
arguments <code>team</code> and <code>position</code> that allow for extra filtering.</p>
<p>Note that the roster position is a string but the set of
possible values is provider dependent. It is used for display
purposes only.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.ESPN.roster', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.ESPN.roster" class="source">
    <pre><code>def roster(self, player_search, owner, week):
    def to_pos(row):
        pos = row.find(class_='playerSlot').text.strip().upper()
        if pos == 'BENCH':
            return 'BN'
        return pos
    def to_name(row):
        name = row.find(class_='playertablePlayerName').a.text.strip()
        # If this is the defense, apparently 'D/ST' is included in
        # the name. Wtf?
        return re.sub('\s+D/ST$', '', name)
    def to_team(row):
        tpos = row.find(class_='playertablePlayerName').a.next_sibling
        tpos = tpos.strip(' \r\n\t*,|').upper()
        # This is a little weird because the team name seems to run
        # in with the position. Perhaps a weird encoding quirk?
        if len(tpos) < 2:
            return 'UNK'
        elif len(tpos) == 2:
            return nfldb.standard_team(tpos)
        else:
            team = nfldb.standard_team(tpos[0:3])
            if team == 'UNK':
                team = nfldb.standard_team(tpos[0:2])
            return team
    def rplayer(r, name, team, pos):
        bench = pos == 'BN'
        name_team = nfldb.standard_team(name)
        if name is None and team is None:
            return r.new_player(pos, None, bench, None)
        elif name_team != 'UNK':
            return r.new_player(pos, name_team, bench, None)
        else:
            player = player_search(name, team=team, position=pos)
            return r.new_player(pos, team, bench, player.player_id)
    url = _urls['espn']['roster'].format(
        league_id=self._lg.ident, season_id=self._lg.season, week=week,
        team_id=owner.ident)
    soup = BeautifulSoup(self._request(url).text)
    roster = Roster(owner, self._lg.season, week, [])
    for tr in soup.select('tr.pncPlayerRow'):
        if tr.get('id', '') == 'pncEmptyRow':
            continue
        pos = to_pos(tr)
        try:
            team, name = to_team(tr), to_name(tr)
            roster.players.append(rplayer(roster, name, team, pos))
        except AttributeError:
            roster.players.append(rplayer(roster, None, None, pos))
    return roster
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.ESPN.save">
    <p>def <span class="ident">save</span>(</p><p>self, fp, player_search, week)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.save">save</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Writes a JSON encoding of all the owners, matchups and rosters
for the given week to a file at <code>fp</code>.</p>
<p><code>player_search</code> should be a function that takes a full
player name and returns the closest matching player as a
<code>nfldb.Player</code> object. It should also optionally take keyword
arguments <code>team</code> and <code>position</code> that allow for extra filtering.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.ESPN.save', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.ESPN.save" class="source">
    <pre><code>def save(self, fp, player_search, week):
    """
    Writes a JSON encoding of all the owners, matchups and rosters
    for the given week to a file at `fp`.
    `player_search` should be a function that takes a full
    player name and returns the closest matching player as a
    `nfldb.Player` object. It should also optionally take keyword
    arguments `team` and `position` that allow for extra filtering.
    """
    d = {
        'owners': self.owners(),
        'matchups': self.matchups(week),
    }
    # I'm hoping this doesn't hurt custom providers that don't need
    # to do IO to fetch a roster.
    def roster(owner):
        return self.roster(player_search, owner, week)
    # pool = multiprocessing.pool.ThreadPool(3)
    # d['rosters'] = pool.map(roster, d['owners'])
    d['rosters'] = map(roster, d['owners'])
    json.dump(d, open(fp, 'w+'))
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflfan.League" class="name">class <span class="ident">League</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League" class="source">
    <pre><code>class League (namedtuple('League',
                         'season phase ident prov_name name scoring conf')):
    __pdoc__['League.season'] = \
        """The year of the NFL season for this league."""

    __pdoc__['League.phase'] = \
        """The phase of the season: preseason, regular or post."""

    __pdoc__['League.ident'] = \
        """
        A unique identifier for this league. The type and format of
        this value is provider dependent.
        """

    __pdoc__['League.prov_name'] = \
        """The name of the provider for this league."""

    __pdoc__['League.name'] = \
        """The name of this league from the configuration."""

    __pdoc__['League.scoring'] = \
        """The `nflfan.ScoreSchema` for this league."""

    __pdoc__['League.conf'] = \
        """
        A dictionary of configuration settings. The keys and values in
        this dictionary are provider dependent.
        """

    def __init__(self, *args):
        super(League, self).__init__(*args)
        self._cache = {}

    @property
    def full_name(self):
        return '%s.%s' % (self.prov_name, self.name)

    def is_me(self, obj):
        if not self.conf.get('me', None):
            return False

        if isinstance(obj, Roster):
            return self.is_me(obj.owner)
        elif isinstance(obj, Matchup):
            return self.is_me(obj.owner1) or self.is_me(obj.owner2)
        else:
            return self.conf['me'].lower() in obj.name.lower()

    def me(self, objs):
        for obj in objs:
            if self.is_me(obj):
                return obj
        return None

    def owners(self, week):
        return self._cached(week, 'owners')

    def owner(self, week, ident):
        for o in self.owners(week):
            if o.ident == ident:
                return o
        return None

    def matchups(self, week):
        return self._cached(week, 'matchups')

    def matchup(self, week, ident):
        for m in self.matchups(week):
            if m.owner1 is None or m.owner2 is None:
                continue
            if m.owner1.ident == ident or m.owner2.ident == ident:
                return m
        return None

    def rosters(self, week):
        return self._cached(week, 'rosters')

    def roster(self, week, ident):
        for r in self.rosters(week):
            if r.owner.ident == ident:
                return r
        return None

    def cache_path(self, week):
        return os.path.join(nflfan.config.cache_path(),
                            str(self.season), str(self.phase), str(week),
                            self.full_name + '.json')

    def _cached(self, week, key):
        if week not in self._cache:
            self._load(week)
        return self._cache[week][key]

    def _load(self, week):
        raw = None
        fp = self.cache_path(week)
        try:
            with open(fp) as f:
                raw = json.load(f)
        except IOError:
            raise IOError(
                "No cached data for week %d in %s could be found at %s\n"
                "Have you run `nflfan-update --week %d` yet?"
                % (week, self.full_name, fp, week))

        d = {'owners': [], 'matchups': [], 'rosters': []}
        for owner in raw['owners']:
            d['owners'].append(Owner._make(owner))
        for matchup in raw['matchups']:
            o1 = None if matchup[0] is None else Owner._make(matchup[0])
            o2 = None if matchup[1] is None else Owner._make(matchup[1])
            d['matchups'].append(Matchup(o1, o2))
        for roster in raw['rosters']:
            o = Owner._make(roster[0])
            r = Roster(o, roster[1], roster[2], [])
            for rp in roster[3]:
                r.players.append(RosterPlayer._make(rp))
            d['rosters'].append(r)
        self._cache[week] = d

    def __str__(self):
        return self.full_name
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflfan.League">League</a></li>
          <li>nflfan.provider.League</li>
          <li>__builtin__.tuple</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflfan.League.conf" class="name">var <span class="ident">conf</span></p>
            

            
  
    <div class="desc"><p>A dictionary of configuration settings. The keys and values in
this dictionary are provider dependent.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.League.full_name" class="name">var <span class="ident">full_name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.League.ident" class="name">var <span class="ident">ident</span></p>
            

            
  
    <div class="desc"><p>A unique identifier for this league. The type and format of
this value is provider dependent.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.League.name" class="name">var <span class="ident">name</span></p>
            

            
  
    <div class="desc"><p>The name of this league from the configuration.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.League.phase" class="name">var <span class="ident">phase</span></p>
            

            
  
    <div class="desc"><p>The phase of the season: preseason, regular or post.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.League.prov_name" class="name">var <span class="ident">prov_name</span></p>
            

            
  
    <div class="desc"><p>The name of the provider for this league.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.League.scoring" class="name">var <span class="ident">scoring</span></p>
            

            
  
    <div class="desc"><p>The <a href="#nflfan.ScoreSchema"><code>ScoreSchema</code></a> for this league.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.League.season" class="name">var <span class="ident">season</span></p>
            

            
  
    <div class="desc"><p>The year of the NFL season for this league.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflfan.League.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, *args)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.__init__" class="source">
    <pre><code>def __init__(self, *args):
    super(League, self).__init__(*args)
    self._cache = {}
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.League.cache_path">
    <p>def <span class="ident">cache_path</span>(</p><p>self, week)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.cache_path', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.cache_path" class="source">
    <pre><code>def cache_path(self, week):
    return os.path.join(nflfan.config.cache_path(),
                        str(self.season), str(self.phase), str(week),
                        self.full_name + '.json')
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.League.is_me">
    <p>def <span class="ident">is_me</span>(</p><p>self, obj)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.is_me', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.is_me" class="source">
    <pre><code>def is_me(self, obj):
    if not self.conf.get('me', None):
        return False
    if isinstance(obj, Roster):
        return self.is_me(obj.owner)
    elif isinstance(obj, Matchup):
        return self.is_me(obj.owner1) or self.is_me(obj.owner2)
    else:
        return self.conf['me'].lower() in obj.name.lower()
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.League.matchup">
    <p>def <span class="ident">matchup</span>(</p><p>self, week, ident)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.matchup', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.matchup" class="source">
    <pre><code>def matchup(self, week, ident):
    for m in self.matchups(week):
        if m.owner1 is None or m.owner2 is None:
            continue
        if m.owner1.ident == ident or m.owner2.ident == ident:
            return m
    return None
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.League.matchups">
    <p>def <span class="ident">matchups</span>(</p><p>self, week)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.matchups', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.matchups" class="source">
    <pre><code>def matchups(self, week):
    return self._cached(week, 'matchups')
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.League.me">
    <p>def <span class="ident">me</span>(</p><p>self, objs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.me', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.me" class="source">
    <pre><code>def me(self, objs):
    for obj in objs:
        if self.is_me(obj):
            return obj
    return None
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.League.owner">
    <p>def <span class="ident">owner</span>(</p><p>self, week, ident)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.owner', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.owner" class="source">
    <pre><code>def owner(self, week, ident):
    for o in self.owners(week):
        if o.ident == ident:
            return o
    return None
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.League.owners">
    <p>def <span class="ident">owners</span>(</p><p>self, week)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.owners', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.owners" class="source">
    <pre><code>def owners(self, week):
    return self._cached(week, 'owners')
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.League.roster">
    <p>def <span class="ident">roster</span>(</p><p>self, week, ident)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.roster', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.roster" class="source">
    <pre><code>def roster(self, week, ident):
    for r in self.rosters(week):
        if r.owner.ident == ident:
            return r
    return None
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.League.rosters">
    <p>def <span class="ident">rosters</span>(</p><p>self, week)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.League.rosters', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.League.rosters" class="source">
    <pre><code>def rosters(self, week):
    return self._cached(week, 'rosters')
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflfan.Matchup" class="name">class <span class="ident">Matchup</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Matchup', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Matchup" class="source">
    <pre><code>class Matchup (namedtuple('Matchup', 'owner1 owner2')):
    __pdoc__['Matchup.owner1'] = \
        """
        One of the two teams in this matchup represented as an
        `nflfan.Owner` object.
        """

    __pdoc__['Matchup.owner2'] = \
        """
        One of the two teams in this matchup represented as an
        `nflfan.Owner` object.
        """

    def other(self, ident):
        """
        Given an identifier for one of the owner's in this matchup,
        return the `nflfan.Owner` of the other owner.
        """
        assert ident in (self.owner1.ident, self.owner2.ident)
        if ident == self.owner1.ident:
            return self.owner2
        else:
            return self.owner1

    def __str__(self):
        return '%s vs. %s' % (self.owner1, self.owner2)
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflfan.Matchup">Matchup</a></li>
          <li>nflfan.provider.Matchup</li>
          <li>__builtin__.tuple</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflfan.Matchup.owner1" class="name">var <span class="ident">owner1</span></p>
            

            
  
    <div class="desc"><p>One of the two teams in this matchup represented as an
<a href="#nflfan.Owner"><code>Owner</code></a> object.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Matchup.owner2" class="name">var <span class="ident">owner2</span></p>
            

            
  
    <div class="desc"><p>One of the two teams in this matchup represented as an
<a href="#nflfan.Owner"><code>Owner</code></a> object.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflfan.Matchup.other">
    <p>def <span class="ident">other</span>(</p><p>self, ident)</p>
    </div>
    

    
  
    <div class="desc"><p>Given an identifier for one of the owner's in this matchup,
return the <a href="#nflfan.Owner"><code>Owner</code></a> of the other owner.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Matchup.other', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Matchup.other" class="source">
    <pre><code>def other(self, ident):
    """
    Given an identifier for one of the owner's in this matchup,
    return the `nflfan.Owner` of the other owner.
    """
    assert ident in (self.owner1.ident, self.owner2.ident)
    if ident == self.owner1.ident:
        return self.owner2
    else:
        return self.owner1
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflfan.Owner" class="name">class <span class="ident">Owner</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Owner', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Owner" class="source">
    <pre><code>class Owner (namedtuple('Owner', 'ident name')):
    __pdoc__['Owner.ident'] = \
        """
        A unique identifier corresponding to this owner. The type
        of this value is provider-dependent.
        """

    __pdoc__['Owner.name'] = \
        """A string representing the name of this owner."""

    def __str__(self):
        return self.name
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflfan.Owner">Owner</a></li>
          <li>nflfan.provider.Owner</li>
          <li>__builtin__.tuple</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflfan.Owner.ident" class="name">var <span class="ident">ident</span></p>
            

            
  
    <div class="desc"><p>A unique identifier corresponding to this owner. The type
of this value is provider-dependent.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Owner.name" class="name">var <span class="ident">name</span></p>
            

            
  
    <div class="desc"><p>A string representing the name of this owner.</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="nflfan.Provider" class="name">class <span class="ident">Provider</span></p>
      
  
    <div class="desc"><p>This class describes the interface that each fantasy football
provider must implement so that it can work with nflfan. In other
words, this is an abstract base class that should <strong>not</strong> be
instantiated directly.</p>
<p>All public members of this class must also be defined in each
provider implementation, including the class variables.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Provider', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Provider" class="source">
    <pre><code>class Provider (object):
    """
    This class describes the interface that each fantasy football
    provider must implement so that it can work with nflfan. In other
    words, this is an abstract base class that should **not** be
    instantiated directly.

    All public members of this class must also be defined in each
    provider implementation, including the class variables.
    """

    provider_name = None
    """The name of the provider used in the configuration file."""

    conf_required = ['scoring', 'league_name', 'season', 'phase', 'league_id']
    """A list of fields required for every provider."""

    conf_optional = ['me']
    """A list of fields that are optional for every provider."""

    def __init__(self, lg):
        self._lg = lg
        self._session = requests.Session()
        self._session.headers.update(getattr(self, '_headers', {}))

    def owners(self):
        """Returns a list of `nflfan.Owner` objects."""
        assert False, 'subclass responsibility'

    def matchups(self, week):
        """
        Given a week number, this returns a list of `nflfan.Matchup`
        objects describing the head-to-head matchups for `week`.
        """
        assert False, 'subclass responsibility'

    def roster(self, player_search, owner, week):
        """
        Given a `nflfan.Owner` and a week number, this returns a
        `nflfan.Roster` object. The `nflfan.Roster` contains a list of
        `nfldb.Player` objects and their corresponding position on the
        roster.

        `player_search` should be a function that takes a full
        player name and returns the closest matching player as a
        `nfldb.Player` object. It should also optionally take keyword
        arguments `team` and `position` that allow for extra filtering.

        Note that the roster position is a string but the set of
        possible values is provider dependent. It is used for display
        purposes only.
        """
        assert False, 'subclass responsibility'

    def save(self, fp, player_search, week):
        """
        Writes a JSON encoding of all the owners, matchups and rosters
        for the given week to a file at `fp`.

        `player_search` should be a function that takes a full
        player name and returns the closest matching player as a
        `nfldb.Player` object. It should also optionally take keyword
        arguments `team` and `position` that allow for extra filtering.
        """
        d = {
            'owners': self.owners(),
            'matchups': self.matchups(week),
        }

        # I'm hoping this doesn't hurt custom providers that don't need
        # to do IO to fetch a roster.
        def roster(owner):
            return self.roster(player_search, owner, week)

        # pool = multiprocessing.pool.ThreadPool(3)
        # d['rosters'] = pool.map(roster, d['owners'])
        d['rosters'] = map(roster, d['owners'])
        json.dump(d, open(fp, 'w+'))

    def _request(self, url):
        eprint('download %s' % url)
        r = self._session.get(url)
        soup = BeautifulSoup(r.text)
        if self._login_form(soup):
            self._login()

            r = self._session.get(url)
            soup = BeautifulSoup(r.text)
            if self._login_form(soup):
                raise IOError("Authentication failure.")
        return r

    def _login(self):
        assert self._login_url is not None
        soup = BeautifulSoup(self._session.get(self._login_url).text)

        if not self._login_form(soup):
            # Already logged in!
            return

        form = self._login_form(soup)
        params = self._login_params()
        for inp in form.find_all('input', type='hidden'):
            params[inp['name']] = inp['value']
        r = self._session.post(form['action'], params=params)
        return BeautifulSoup(r.text)

    def _login_params(self):
        assert False, 'subclass responsibility'

    def _login_form(self, soup):
        assert False, 'subclass responsibility'

    def __str__(self):
        return self.__class__.provider_name
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflfan.Provider">Provider</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="nflfan.Provider.conf_optional" class="name">var <span class="ident">conf_optional</span></p>
            

            
  
    <div class="desc"><p>A list of fields that are optional for every provider.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Provider.conf_required" class="name">var <span class="ident">conf_required</span></p>
            

            
  
    <div class="desc"><p>A list of fields required for every provider.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Provider.provider_name" class="name">var <span class="ident">provider_name</span></p>
            

            
  
    <div class="desc"><p>The name of the provider used in the configuration file.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflfan.Provider.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, lg)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Provider.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Provider.__init__" class="source">
    <pre><code>def __init__(self, lg):
    self._lg = lg
    self._session = requests.Session()
    self._session.headers.update(getattr(self, '_headers', {}))
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.Provider.matchups">
    <p>def <span class="ident">matchups</span>(</p><p>self, week)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a week number, this returns a list of <a href="#nflfan.Matchup"><code>Matchup</code></a>
objects describing the head-to-head matchups for <code>week</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Provider.matchups', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Provider.matchups" class="source">
    <pre><code>def matchups(self, week):
    """
    Given a week number, this returns a list of `nflfan.Matchup`
    objects describing the head-to-head matchups for `week`.
    """
    assert False, 'subclass responsibility'
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.Provider.owners">
    <p>def <span class="ident">owners</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of <a href="#nflfan.Owner"><code>Owner</code></a> objects.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Provider.owners', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Provider.owners" class="source">
    <pre><code>def owners(self):
    """Returns a list of `nflfan.Owner` objects."""
    assert False, 'subclass responsibility'
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.Provider.roster">
    <p>def <span class="ident">roster</span>(</p><p>self, player_search, owner, week)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a <a href="#nflfan.Owner"><code>Owner</code></a> and a week number, this returns a
<a href="#nflfan.Roster"><code>Roster</code></a> object. The <a href="#nflfan.Roster"><code>Roster</code></a> contains a list of
<code>nfldb.Player</code> objects and their corresponding position on the
roster.</p>
<p><code>player_search</code> should be a function that takes a full
player name and returns the closest matching player as a
<code>nfldb.Player</code> object. It should also optionally take keyword
arguments <code>team</code> and <code>position</code> that allow for extra filtering.</p>
<p>Note that the roster position is a string but the set of
possible values is provider dependent. It is used for display
purposes only.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Provider.roster', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Provider.roster" class="source">
    <pre><code>def roster(self, player_search, owner, week):
    """
    Given a `nflfan.Owner` and a week number, this returns a
    `nflfan.Roster` object. The `nflfan.Roster` contains a list of
    `nfldb.Player` objects and their corresponding position on the
    roster.
    `player_search` should be a function that takes a full
    player name and returns the closest matching player as a
    `nfldb.Player` object. It should also optionally take keyword
    arguments `team` and `position` that allow for extra filtering.
    Note that the roster position is a string but the set of
    possible values is provider dependent. It is used for display
    purposes only.
    """
    assert False, 'subclass responsibility'
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.Provider.save">
    <p>def <span class="ident">save</span>(</p><p>self, fp, player_search, week)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes a JSON encoding of all the owners, matchups and rosters
for the given week to a file at <code>fp</code>.</p>
<p><code>player_search</code> should be a function that takes a full
player name and returns the closest matching player as a
<code>nfldb.Player</code> object. It should also optionally take keyword
arguments <code>team</code> and <code>position</code> that allow for extra filtering.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Provider.save', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Provider.save" class="source">
    <pre><code>def save(self, fp, player_search, week):
    """
    Writes a JSON encoding of all the owners, matchups and rosters
    for the given week to a file at `fp`.
    `player_search` should be a function that takes a full
    player name and returns the closest matching player as a
    `nfldb.Player` object. It should also optionally take keyword
    arguments `team` and `position` that allow for extra filtering.
    """
    d = {
        'owners': self.owners(),
        'matchups': self.matchups(week),
    }
    # I'm hoping this doesn't hurt custom providers that don't need
    # to do IO to fetch a roster.
    def roster(owner):
        return self.roster(player_search, owner, week)
    # pool = multiprocessing.pool.ThreadPool(3)
    # d['rosters'] = pool.map(roster, d['owners'])
    d['rosters'] = map(roster, d['owners'])
    json.dump(d, open(fp, 'w+'))
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflfan.Roster" class="name">class <span class="ident">Roster</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Roster', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Roster" class="source">
    <pre><code>class Roster (namedtuple('Roster', 'owner season week players')):
    __pdoc__['Roster.owner'] = \
        """
        A `nflfan.Owner` object corresponding to the owner of this
        roster.
        """

    __pdoc__['Roster.players'] = \
        """
        A list of `nflfan.RosterPlayer` objects corresponding to the
        set of players on this roster.
        """

    def new_player(self, pos, team, bench, player_id):
        """
        A convenience method for creating a new `nflfan.RosterPlayer`
        given the current roster.
        """
        return RosterPlayer(pos, team, bench, self.season, self.week,
                            None, 0.0, None, player_id)

    @property
    def active(self):
        return filter(lambda rp: not rp.bench, self.players)

    @property
    def benched(self):
        return filter(lambda rp: rp.bench, self.players)

    @property
    def points(self):
        """Returns the total number of points for non-benched players."""
        return sum(p.points for p in self.players if not p.bench)

    def __str__(self):
        s = []
        for rp in self.players:
            s.append(str(rp))
        return '\n'.join(s)
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflfan.Roster">Roster</a></li>
          <li>nflfan.provider.Roster</li>
          <li>__builtin__.tuple</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflfan.Roster.active" class="name">var <span class="ident">active</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Roster.benched" class="name">var <span class="ident">benched</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Roster.owner" class="name">var <span class="ident">owner</span></p>
            

            
  
    <div class="desc"><p>A <a href="#nflfan.Owner"><code>Owner</code></a> object corresponding to the owner of this
roster.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Roster.players" class="name">var <span class="ident">players</span></p>
            

            
  
    <div class="desc"><p>A list of <a href="#nflfan.RosterPlayer"><code>RosterPlayer</code></a> objects corresponding to the
set of players on this roster.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Roster.points" class="name">var <span class="ident">points</span></p>
            

            
  
    <div class="desc"><p>Returns the total number of points for non-benched players.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Roster.season" class="name">var <span class="ident">season</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 1</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Roster.week" class="name">var <span class="ident">week</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 2</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflfan.Roster.new_player">
    <p>def <span class="ident">new_player</span>(</p><p>self, pos, team, bench, player_id)</p>
    </div>
    

    
  
    <div class="desc"><p>A convenience method for creating a new <a href="#nflfan.RosterPlayer"><code>RosterPlayer</code></a>
given the current roster.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Roster.new_player', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Roster.new_player" class="source">
    <pre><code>def new_player(self, pos, team, bench, player_id):
    """
    A convenience method for creating a new `nflfan.RosterPlayer`
    given the current roster.
    """
    return RosterPlayer(pos, team, bench, self.season, self.week,
                        None, 0.0, None, player_id)
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflfan.RosterPlayer" class="name">class <span class="ident">RosterPlayer</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.RosterPlayer', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.RosterPlayer" class="source">
    <pre><code>class RosterPlayer (
    namedtuple('RosterPlayer',
               'position team bench season week '
               'game points player player_id')):
    __pdoc__['RosterPlayer.position'] = \
        """
        A string corresponding to the position of the roster spot
        occupied by this player. The possible values of this string are
        provider dependent.
        """

    __pdoc__['RosterPlayer.team'] = \
        """
        A team abbreviation that this player belongs to. It must be a
        valid nfldb team abbreviation and *cannot* be `UNK`.
        """

    __pdoc__['RosterPlayer.bench'] = \
        """A boolean indicating whether this is a bench position or not."""

    __pdoc__['RosterPlayer.season'] = \
        """The year of the corresponding NFL season."""

    __pdoc__['RosterPlayer.week'] = \
        """The week number in which this roster was set."""

    __pdoc__['RosterPlayer.game'] = \
        """
        The `nfldb.Game` object for the game that this player played
        in. If this roster position corresponds to a bye week, then
        this attribute is set to `None`.
        """

    __pdoc__['RosterPlayer.points'] = \
        """The total fantasy points for this roster player."""

    __pdoc__['RosterPlayer.player'] = \
        """
        A `nfldb.Player` object corresponding to this roster player.

        This attribute is `None` by default, and is always `None` for
        roster players corresponding to entire teams (e.g., defense).
        """

    __pdoc__['RosterPlayer.player_id'] = \
        """
        A player id string corresponding to the player in this roster
        position and a player in nfldb. This may be `None` when the
        roster player corresponds to an entire team. (e.g., A defense.)
        """

    @property
    def is_empty(self):
        return self.team is None and self.player_id is None

    @property
    def is_defense(self):
        return self.team is not None and self.player_id is None

    @property
    def is_player(self):
        return self.player_id is not None

    @property
    def id(self):
        if self.is_empty:
            return 'Empty'
        elif self.is_defense:
            return self.team
        else:
            return self.player_id

    @property
    def name(self):
        return self.id if not self.player else self.player.full_name

    def __str__(self):
        if self.game is not None and self.game.is_playing:
            playing = '*'
        else:
            playing = ' '
        return '%-6s %-4s %-20s %s%0.2f' \
               % (self.position, self.team, self.name, playing, self.points)
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflfan.RosterPlayer">RosterPlayer</a></li>
          <li>nflfan.provider.RosterPlayer</li>
          <li>__builtin__.tuple</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflfan.RosterPlayer.bench" class="name">var <span class="ident">bench</span></p>
            

            
  
    <div class="desc"><p>A boolean indicating whether this is a bench position or not.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.game" class="name">var <span class="ident">game</span></p>
            

            
  
    <div class="desc"><p>The <code>nfldb.Game</code> object for the game that this player played
in. If this roster position corresponds to a bye week, then
this attribute is set to <code>None</code>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.id" class="name">var <span class="ident">id</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.is_defense" class="name">var <span class="ident">is_defense</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.is_empty" class="name">var <span class="ident">is_empty</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.is_player" class="name">var <span class="ident">is_player</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.name" class="name">var <span class="ident">name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.player" class="name">var <span class="ident">player</span></p>
            

            
  
    <div class="desc"><p>A <code>nfldb.Player</code> object corresponding to this roster player.</p>
<p>This attribute is <code>None</code> by default, and is always <code>None</code> for
roster players corresponding to entire teams (e.g., defense).</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.player_id" class="name">var <span class="ident">player_id</span></p>
            

            
  
    <div class="desc"><p>A player id string corresponding to the player in this roster
position and a player in nfldb. This may be <code>None</code> when the
roster player corresponds to an entire team. (e.g., A defense.)</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.points" class="name">var <span class="ident">points</span></p>
            

            
  
    <div class="desc"><p>The total fantasy points for this roster player.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.position" class="name">var <span class="ident">position</span></p>
            

            
  
    <div class="desc"><p>A string corresponding to the position of the roster spot
occupied by this player. The possible values of this string are
provider dependent.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.season" class="name">var <span class="ident">season</span></p>
            

            
  
    <div class="desc"><p>The year of the corresponding NFL season.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.team" class="name">var <span class="ident">team</span></p>
            

            
  
    <div class="desc"><p>A team abbreviation that this player belongs to. It must be a
valid nfldb team abbreviation and <em>cannot</em> be <code>UNK</code>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.RosterPlayer.week" class="name">var <span class="ident">week</span></p>
            

            
  
    <div class="desc"><p>The week number in which this roster was set.</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="nflfan.ScoreSchema" class="name">class <span class="ident">ScoreSchema</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.ScoreSchema', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.ScoreSchema" class="source">
    <pre><code>class ScoreSchema (namedtuple('ScoreSchema', 'name settings')):
    __pdoc__['ScoreSchema.name'] = \
        """The name given to this schema in the configuration."""

    __pdoc__['ScoreSchema.settings'] = \
        """
        A dictionary mapping a scoring category to its point value. The
        interpretation of the point value depends on the scoring
        category.
        """

    def _pick_range_setting(self, prefix, v):
        match = re.compile('%s_([0-9]+)_([0-9]+)' % prefix)
        for cat in self.settings.keys():
            m = match.match(cat)
            if not m:
                continue
            start, end = int(m.group(1)), int(m.group(2))
            if start <= v <= end:
                return cat
        return None

    def _bonuses(self):
        match = re.compile('^bonus_(.+)_([0-9]+)_([0-9]+)$')
        for cat, pts in self.settings.items():
            m = match.match(cat)
            if not m:
                continue
            field, start, end = m.group(1), int(m.group(2)), int(m.group(3))
            yield field, pts, start, end
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflfan.ScoreSchema">ScoreSchema</a></li>
          <li>nflfan.score.ScoreSchema</li>
          <li>__builtin__.tuple</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflfan.ScoreSchema.name" class="name">var <span class="ident">name</span></p>
            

            
  
    <div class="desc"><p>The name given to this schema in the configuration.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.ScoreSchema.settings" class="name">var <span class="ident">settings</span></p>
            

            
  
    <div class="desc"><p>A dictionary mapping a scoring category to its point value. The
interpretation of the point value depends on the scoring
category.</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="nflfan.Yahoo" class="name">class <span class="ident">Yahoo</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Yahoo', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Yahoo" class="source">
    <pre><code>class Yahoo (Provider):
    provider_name = 'yahoo'
    conf_required = []
    conf_optional = ['username', 'password']
    _headers = {'User-Agent': _user_agent}
    _login_url = 'https://login.yahoo.com/config/login'

    def __init__(self, lg):
        super(Yahoo, self).__init__(lg)
        _, _, self._league_num = self._lg.ident.split('.')

    def owners(self):
        match_owner_link = re.compile('team-[0-9]+-name')

        url = _urls['yahoo']['owner'] % self._league_num
        soup = BeautifulSoup(self._request(url).text)
        owners = []
        for link in soup.find_all(id=match_owner_link):
            ident = self._owner_id_from_url(link['href'])
            owners.append(Owner(ident, link.text.strip()))
        return owners

    def matchups(self, week):
        mk_owner = lambda div: Owner(owner_id(div.a['href']), div.text.strip())
        owner_id = self._owner_id_from_url

        url = _urls['yahoo']['matchup'] % (self._league_num, week)
        rjson = self._request(url).json()
        soup = BeautifulSoup(rjson['content'])
        matchups = []
        for matchup in soup.find('ul').children:
            pair = list(matchup.find_all('div', class_='Fz-sm'))
            if len(pair) == 1:
                matchups.append(Matchup(mk_owner(pair[0]), None))
            else:
                matchups.append(Matchup(mk_owner(pair[0]), mk_owner(pair[1])))
        return matchups

    def roster(self, player_search, owner, week):
        def to_pos(row):
            return row.td.find(class_='pos-label')['data-pos'].strip().upper()

        def to_name(row):
            return row.find(class_='ysf-player-name').a.text.strip()

        def to_team(row):
            team_pos = row.find(class_='ysf-player-name').span.text.strip()
            return nfldb.standard_team(re.search('^\S+', team_pos).group(0))

        def rplayer(r, name, team, pos):
            bench = pos == 'BN'
            if name is None and team is None:
                return r.new_player(pos, None, bench, None)
            elif nfldb.standard_team(name) != 'UNK':
                return r.new_player(pos, team, bench, None)
            else:
                player = player_search(name, team=team, position=pos)
                return r.new_player(pos, team, bench, player.player_id)

        match_table_id = re.compile('^statTable[0-9]+$')

        url = _urls['yahoo']['roster'] % (self._league_num, owner.ident, week)
        soup = BeautifulSoup(self._request(url).text)

        roster = Roster(owner, self._lg.season, week, [])
        for table in soup.find_all(id=match_table_id):
            for row in table.tbody.find_all('tr', recursive=False):
                pos = to_pos(row)
                try:
                    team, name = to_team(row), to_name(row)
                    roster.players.append(rplayer(roster, name, team, pos))
                except AttributeError:
                    roster.players.append(rplayer(roster, None, None, pos))
        return roster

    def _owner_id_from_url(self, url):
        return re.search('%s/([0-9]+)' % self._league_num, url).group(1)

    def _login(self):
        soup = super(Yahoo, self)._login()
        if self._login_form(soup):
            err_div = soup.find('div', class_='yregertxt')
            err_msg = 'Unknown error.'
            if err_div:
                err_msg = err_div.text.strip()
            raise IOError('Login failed: %s' % err_msg)

    def _login_params(self):
        return {
            'login': self._lg.conf.get('username', ''),
            'passwd': self._lg.conf.get('password', ''),
            '.save': 'Sign In',
        }

    def _login_form(self, soup):
        return soup.find(id='login_form')
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflfan.Yahoo">Yahoo</a></li>
          <li><a href="#nflfan.Provider">Provider</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="nflfan.Yahoo.conf_optional" class="name">var <span class="ident">conf_optional</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.conf_optional">conf_optional</a></code>
    </p>

            
  
    <div class="desc inherited"><p>A list of fields that are optional for every provider.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Yahoo.conf_required" class="name">var <span class="ident">conf_required</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.conf_required">conf_required</a></code>
    </p>

            
  
    <div class="desc inherited"><p>A list of fields required for every provider.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflfan.Yahoo.provider_name" class="name">var <span class="ident">provider_name</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.provider_name">provider_name</a></code>
    </p>

            
  
    <div class="desc inherited"><p>The name of the provider used in the configuration file.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflfan.Yahoo.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, lg)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.__init__">__init__</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Yahoo.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Yahoo.__init__" class="source">
    <pre><code>def __init__(self, lg):
    super(Yahoo, self).__init__(lg)
    _, _, self._league_num = self._lg.ident.split('.')
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.Yahoo.matchups">
    <p>def <span class="ident">matchups</span>(</p><p>self, week)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.matchups">matchups</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Given a week number, this returns a list of <a href="#nflfan.Matchup"><code>Matchup</code></a>
objects describing the head-to-head matchups for <code>week</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Yahoo.matchups', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Yahoo.matchups" class="source">
    <pre><code>def matchups(self, week):
    mk_owner = lambda div: Owner(owner_id(div.a['href']), div.text.strip())
    owner_id = self._owner_id_from_url
    url = _urls['yahoo']['matchup'] % (self._league_num, week)
    rjson = self._request(url).json()
    soup = BeautifulSoup(rjson['content'])
    matchups = []
    for matchup in soup.find('ul').children:
        pair = list(matchup.find_all('div', class_='Fz-sm'))
        if len(pair) == 1:
            matchups.append(Matchup(mk_owner(pair[0]), None))
        else:
            matchups.append(Matchup(mk_owner(pair[0]), mk_owner(pair[1])))
    return matchups
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.Yahoo.owners">
    <p>def <span class="ident">owners</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.owners">owners</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Returns a list of <a href="#nflfan.Owner"><code>Owner</code></a> objects.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Yahoo.owners', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Yahoo.owners" class="source">
    <pre><code>def owners(self):
    match_owner_link = re.compile('team-[0-9]+-name')
    url = _urls['yahoo']['owner'] % self._league_num
    soup = BeautifulSoup(self._request(url).text)
    owners = []
    for link in soup.find_all(id=match_owner_link):
        ident = self._owner_id_from_url(link['href'])
        owners.append(Owner(ident, link.text.strip()))
    return owners
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.Yahoo.roster">
    <p>def <span class="ident">roster</span>(</p><p>self, player_search, owner, week)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.roster">roster</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Given a <a href="#nflfan.Owner"><code>Owner</code></a> and a week number, this returns a
<a href="#nflfan.Roster"><code>Roster</code></a> object. The <a href="#nflfan.Roster"><code>Roster</code></a> contains a list of
<code>nfldb.Player</code> objects and their corresponding position on the
roster.</p>
<p><code>player_search</code> should be a function that takes a full
player name and returns the closest matching player as a
<code>nfldb.Player</code> object. It should also optionally take keyword
arguments <code>team</code> and <code>position</code> that allow for extra filtering.</p>
<p>Note that the roster position is a string but the set of
possible values is provider dependent. It is used for display
purposes only.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Yahoo.roster', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Yahoo.roster" class="source">
    <pre><code>def roster(self, player_search, owner, week):
    def to_pos(row):
        return row.td.find(class_='pos-label')['data-pos'].strip().upper()
    def to_name(row):
        return row.find(class_='ysf-player-name').a.text.strip()
    def to_team(row):
        team_pos = row.find(class_='ysf-player-name').span.text.strip()
        return nfldb.standard_team(re.search('^\S+', team_pos).group(0))
    def rplayer(r, name, team, pos):
        bench = pos == 'BN'
        if name is None and team is None:
            return r.new_player(pos, None, bench, None)
        elif nfldb.standard_team(name) != 'UNK':
            return r.new_player(pos, team, bench, None)
        else:
            player = player_search(name, team=team, position=pos)
            return r.new_player(pos, team, bench, player.player_id)
    match_table_id = re.compile('^statTable[0-9]+$')
    url = _urls['yahoo']['roster'] % (self._league_num, owner.ident, week)
    soup = BeautifulSoup(self._request(url).text)
    roster = Roster(owner, self._lg.season, week, [])
    for table in soup.find_all(id=match_table_id):
        for row in table.tbody.find_all('tr', recursive=False):
            pos = to_pos(row)
            try:
                team, name = to_team(row), to_name(row)
                roster.players.append(rplayer(roster, name, team, pos))
            except AttributeError:
                roster.players.append(rplayer(roster, None, None, pos))
    return roster
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflfan.Yahoo.save">
    <p>def <span class="ident">save</span>(</p><p>self, fp, player_search, week)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#nflfan.Provider">Provider</a></code>.<code><a href="#nflfan.Provider.save">save</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Writes a JSON encoding of all the owners, matchups and rosters
for the given week to a file at <code>fp</code>.</p>
<p><code>player_search</code> should be a function that takes a full
player name and returns the closest matching player as a
<code>nfldb.Player</code> object. It should also optionally take keyword
arguments <code>team</code> and <code>position</code> that allow for extra filtering.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflfan.Yahoo.save', this);">Show source &equiv;</a></p>
  <div id="source-nflfan.Yahoo.save" class="source">
    <pre><code>def save(self, fp, player_search, week):
    """
    Writes a JSON encoding of all the owners, matchups and rosters
    for the given week to a file at `fp`.
    `player_search` should be a function that takes a full
    player name and returns the closest matching player as a
    `nfldb.Player` object. It should also optionally take keyword
    arguments `team` and `position` that allow for extra filtering.
    """
    d = {
        'owners': self.owners(),
        'matchups': self.matchups(week),
    }
    # I'm hoping this doesn't hurt custom providers that don't need
    # to do IO to fetch a roster.
    def roster(owner):
        return self.roster(player_search, owner, week)
    # pool = multiprocessing.pool.ThreadPool(3)
    # d['rosters'] = pool.map(roster, d['owners'])
    d['rosters'] = map(roster, d['owners'])
    json.dump(d, open(fp, 'w+'))
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
