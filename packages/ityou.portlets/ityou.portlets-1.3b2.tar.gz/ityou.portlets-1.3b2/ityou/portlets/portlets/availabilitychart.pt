<dl class="portlet portletavailabilitychart"
    i18n:domain="ityou.portlets">

    <dt class="portletHeader">
        <span class="portletTopLeft"></span>
        <span i18n:translate="chart_availability_of_content">
           Availability of Content
        </span>
        <span class="portletTopRight"></span>
    </dt>

    <dd class="portletItem odd">
            <input type="checkbox" id="cb-selectedcontext" name="availability-context"><span i18n:translate="entire_site_search">search entire site</span>
            <div id="availability-chart"></div>

    </dd>

    <dd class="portletFooter">
        <span class="portletBottomLeft"></span>
        <span>
           
        </span>
        <span class="portletBottomRight"></span>
    </dd>

 <!--   <script type="text/javascript" src="++resource++ityou.portlets.resources/vendors/d3/d3pie/d3pie.min.js"/> -->
    <script type="text/javascript">

$(document).ready(function(){ 
    loading_chart_availability();

    function loading_chart_availability(){
    
        var selectedcontext;
        
        if(localStorage.getItem("selectedcontext") == "undefined") {
            selectedcontext = "local";
        }
        else {
            selectedcontext = localStorage.getItem("selectedcontext");
            if (selectedcontext == "global") { 
                document.getElementById("cb-selectedcontext").checked = true; 
            }
        }
                    
        $.getJSON('@@ajax-datadigger', {"data":'availability','chart':'d3pie','selectedcontext':selectedcontext},function(json) {   
                d3pie_chart(json)            
            }
        );
        
        $("#cb-selectedcontext").on( "click", function() {
            
            var selectedcontext;
            if(document.getElementById("cb-selectedcontext").checked  == true) { 
                localStorage.setItem("selectedcontext","global"); 
                selectedcontext = localStorage.getItem("selectedcontext");
            }
            if(document.getElementById("cb-selectedcontext").checked  == false) { 
                localStorage.setItem("selectedcontext","local"); 
                selectedcontext = localStorage.getItem("selectedcontext");
            }
            
            $.getJSON('@@ajax-datadigger', {"data":'availability','chart':'d3pie','selectedcontext':selectedcontext},function(json) {   
                console.log(json);
                d3pie_chart_redraw(json);            
            });
        
        });
    }
    
    function d3pie_chart_redraw(jdata){
        
        availability_pie.updateProp("data.content",jdata);
    }                
    function d3pie_chart(jdata){
        
        //console.log(jdata);
        var portletwidth = $("#availability-chart").width();
        
        availability_pie = new d3pie("#availability-chart", {
      	    header: {
	            title:{ text:    "", color:    "#333333", fontSize: 18, font:     "arial"},
	            subtitle: { color:    "#666666", fontSize: 14, font:     "arial"},
	            location: "top-center",
	            titleSubtitlePadding: 8
        	},
            footer: {
	            text: 	  "",
	            color:    "#666666",
	            fontSize: 14,
	            font:     "arial",
	            location: "left"
            },
            size: {
	            canvasHeight: portletwidth,
	            canvasWidth: portletwidth,
	            pieInnerRadius: 0,
	            pieOuterRadius: portletwidth/4.5
            },
            data: {
	            sortOrder: "none",
	           
	            content: jdata
            },
            labels: {
	            outer: {
		            format: "label-percentage2",
		            hideWhenLessThanPercentage: 5,
		            pieDistance: null
	            },
	            inner: {
		            format: null,
		            hideWhenLessThanPercentage: 5
	            },
	            mainLabel: {
		            color: "#333333",
		            font: "arial",
		            fontSize: 12
	            },
	            percentage: {
		            color: "#dddddd",
		            font: "arial",
		            fontSize: 10,
		            decimalPlaces: 0
	            },
	            value: {
		            color: "#cccc44",
		            font: "arial",
		            fontSize: 10
	            },
	            lines: {
		            enabled: true,
		            style: "curved",
		            color: "segment" // "segment" or a hex color
	            }
            },
            tooltips: {
	            enabled: false,
	            type: "placeholder", // caption|placeholder
	            string: "",
	            placeholderParser: null,
            },
            misc: {
	            colors: {
		            background: null, // transparent
		            segmentStroke: "#ffffff"
	            },
	            gradient: {
		            enabled: false,
		            percentage: 85,
		           
	            },
	            canvasPadding: {
		            top: 1,
		            right: 1,
		            bottom: 1,
		            left: 1
	            },
	            pieCenterOffset: {
		            x: 0,
		            y: 0
	            },
	            cssPrefix: null
            },
            callbacks: {
	            onload: null,
	            onMouseoverSegment: null,
	            onMouseoutSegment: null,
	            onClickSegment: null
            }
        });  
   }

    
});
    </script> 
</dl>


